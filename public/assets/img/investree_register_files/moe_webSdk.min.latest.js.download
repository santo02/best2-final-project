/*! For license information please see sdk.js.LICENSE.txt */
(()=>{var e={9483:(e,t,n)=>{e.exports=function e(t,n,r){function a(o,s){if(!n[o]){if(!t[o]){if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}u=n[o]={exports:{}},t[o][0].call(u.exports,(function(e){return a(t[o][1][e]||e)}),u,u.exports,e,t,n,r)}return n[o].exports}for(var i=void 0,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,t,r){(function(e){"use strict";var n,r,a,i,o=e.MutationObserver||e.WebKitMutationObserver,s=o?(n=0,o=new o(l),r=e.document.createTextNode(""),o.observe(r,{characterData:!0}),function(){r.data=n=++n%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)}:((a=new e.MessageChannel).port1.onmessage=l,function(){a.port2.postMessage(0)}),u=[];function l(){var e,t;i=!0;for(var n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}i=!1}t.exports=function(e){1!==u.push(e)||i||s()}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function a(){}var i={},o=["REJECTED"],s=["FULFILLED"],u=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==a&&g(this,e)}function c(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function f(e,t,n){r((function(){var r;try{r=t(n)}catch(r){return i.reject(e,r)}r===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,r)}))}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function g(e,t){var n=!1;function r(t){n||(n=!0,i.reject(e,t))}function a(t){n||(n=!0,i.resolve(e,t))}var o=p((function(){t(a,r)}));"error"===o.status&&r(o.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=l).prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(a);return this.state!==u?f(n,this.state===s?e:t,this.outcome):this.queue.push(new c(n,e,t)),n},c.prototype.callFulfilled=function(e){i.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){f(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){i.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){f(this.promise,this.onRejected,e)},i.resolve=function(e,t){var n=p(d,t);if("error"===n.status)return i.reject(e,n.value);if(n=n.value)g(e,n);else{e.state=s,e.outcome=t;for(var r=-1,a=e.queue.length;++r<a;)e.queue[r].callFulfilled(t)}return e},i.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:i.resolve(new this(a),e)},l.reject=function(e){var t=new this(a);return i.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),s=0,u=-1,l=new this(a);++u<n;)!function(e,a){t.resolve(e).then((function(e){o[a]=e,++s!==n||r||(r=!0,i.resolve(l,o))}),(function(e){r||(r=!0,i.reject(l,e))}))}(e[u],u);return l},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=-1,s=new this(a);++o<n;)!function(e){t.resolve(e).then((function(e){r||(r=!0,i.resolve(s,e))}),(function(e){r||(r=!0,i.reject(s,e))}))}(e[o]);return s}},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function i(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if("TypeError"!==a.name)throw a;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var o=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function u(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function c(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var f="local-forage-detect-blob-support",d=void 0,g={},p=Object.prototype.toString,S="readonly",h="readwrite";function E(e){return"boolean"==typeof d?o.resolve(d):(t=e,new o((function(e){var n=t.transaction(f,h),r=i([""]);n.objectStore(f).put(r,"key"),n.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},n.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||43<=parseInt(t[1],10))}})).catch((function(){return!1})).then((function(e){return d=e})));var t}function T(e){e=g[e.name];var t={};t.promise=new o((function(e,n){t.resolve=e,t.reject=n})),e.deferredOperations.push(t),e.dbReady?e.dbReady=e.dbReady.then((function(){return t.promise})):e.dbReady=t.promise}function m(e){return(e=g[e.name].deferredOperations.pop())&&(e.resolve(),e.promise)}function _(e,t){if(e=g[e.name].deferredOperations.pop())return e.reject(t),e.promise}function v(e,t){return new o((function(n,r){if(g[e.name]=g[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);T(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var o=a.open.apply(a,i);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(f)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),r(o.error)},o.onsuccess=function(){n(o.result),m(e)}}))}function y(e){return v(e,!1)}function A(e){return v(e,!0)}function I(e,t){if(!e.db)return 1;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,a=e.version>e.db.version;return r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),(a||n)&&(!n||(n=e.db.version+1)>e.version&&(e.version=n),1)}function b(e){return i([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),a=0;a<t;a++)r[a]=e.charCodeAt(a);return n}(atob(e.data))],{type:e.type})}function O(e){return e&&e.__local_forage_encoded_blob}function N(e){var t=this,n=t._initReady().then((function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return u(n,e,e),n}function P(e,t,n,r){void 0===r&&(r=1);try{var a=e.db.transaction(e.storeName,t);n(null,a)}catch(a){if(0<r&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return o.resolve().then((function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),A(e)})).then((function(){return function(e){T(e);for(var t=g[e.name],n=t.forages,r=0;r<n.length;r++){var a=n[r];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,y(e).then((function(t){return e.db=t,I(e)?A(e):t})).then((function(r){e.db=t.db=r;for(var a=0;a<n.length;a++)n[a]._dbInfo.db=r})).catch((function(t){throw _(e,t),t}))}(e).then((function(){P(e,t,n,r-1)}))})).catch(n);n(a)}}var w={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var a=g[n.name];a||(a={forages:[],db:null,dbReady:null,deferredOperations:[]},g[n.name]=a),a.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=N);var i=[];function s(){return o.resolve()}for(var u=0;u<a.forages.length;u++){var l=a.forages[u];l!==t&&i.push(l._initReady().catch(s))}var c=a.forages.slice(0);return o.all(i).then((function(){return n.db=a.db,y(n)})).then((function(e){return n.db=e,I(n,t._defaultConfig.version)?A(n):e})).then((function(e){n.db=a.db=e,t._dbInfo=n;for(var r=0;r<c.length;r++){var i=c[r];i!==t&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}}))},_support:function(){try{if(!a)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){P(n._dbInfo,S,(function(a,i){if(a)return r(a);try{var o=i.objectStore(n._dbInfo.storeName).openCursor(),s=1;o.onsuccess=function(){var n,r=o.result;r?(O(n=r.value)&&(n=b(n)),void 0!==(n=e(n,r.key,s++))?t(n):r.continue()):t()},o.onerror=function(){r(o.error)}}catch(a){r(a)}}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new o((function(t,r){n.ready().then((function(){P(n._dbInfo,S,(function(a,i){if(a)return r(a);try{var o=i.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;O(e=void 0===e?null:e)&&(e=b(e)),t(e)},o.onerror=function(){r(o.error)}}catch(a){r(a)}}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var a=new o((function(n,a){var i;r.ready().then((function(){return i=r._dbInfo,"[object Blob]"===p.call(t)?E(i.db).then((function(e){return e?t:(n=t,new o((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){t=btoa(t.target.result||""),e({__local_forage_encoded_blob:!0,data:t,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){P(r._dbInfo,h,(function(i,o){if(i)return a(i);try{var s=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var u=s.put(t,e);o.oncomplete=function(){n(t=void 0===t?null:t)},o.onabort=o.onerror=function(){var e=u.error||u.transaction.error;a(e)}}catch(i){a(i)}}))})).catch(a)}));return s(a,n),a},removeItem:function(e,t){var n=this;e=l(e);var r=new o((function(t,r){n.ready().then((function(){P(n._dbInfo,h,(function(a,i){if(a)return r(a);try{var o=i.objectStore(n._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){r(o.error)},i.onabort=function(){var e=o.error||o.transaction.error;r(e)}}catch(a){r(a)}}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){P(t._dbInfo,h,(function(r,a){if(r)return n(r);try{var i=a.objectStore(t._dbInfo.storeName).clear();a.oncomplete=function(){e()},a.onabort=a.onerror=function(){var e=i.error||i.transaction.error;n(e)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){P(t._dbInfo,S,(function(r,a){if(r)return n(r);try{var i=a.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){n(i.error)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new o((function(t,r){e<0?t(null):n.ready().then((function(){P(n._dbInfo,S,(function(a,i){if(a)return r(a);try{var o=i.objectStore(n._dbInfo.storeName),s=!1,u=o.openCursor();u.onsuccess=function(){var n=u.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},u.onerror=function(){r(u.error)}}catch(a){r(a)}}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){P(t._dbInfo,S,(function(r,a){if(r)return n(r);try{var i=a.objectStore(t._dbInfo.storeName).openCursor(),o=[];i.onsuccess=function(){var t=i.result;t?(o.push(t.key),t.continue()):e(o)},i.onerror=function(){n(i.error)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=c.apply(this,arguments);var n,r=this.config();return(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),s(n=e.name?(n=e.name===r.name&&this._dbInfo.db?o.resolve(this._dbInfo.db):y(e).then((function(t){var n=g[e.name],r=n.forages;n.db=t;for(var a=0;a<r.length;a++)r[a]._dbInfo.db=t;return t})),e.storeName?n.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;T(e);var r=g[e.name],i=r.forages;t.close();for(var s=0;s<i.length;s++){var u=i[s];u._dbInfo.db=null,u._dbInfo.version=n}return new o((function(t,r){var i=a.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,m(n._dbInfo)}})).catch((function(t){throw(_(e,t)||o.resolve()).catch((function(){})),t}))}})):n.then((function(t){T(e);var n=g[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;return new o((function(t,n){var r=a.deleteDatabase(e.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),n(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)m(r[t]._dbInfo)})).catch((function(t){throw(_(e,t)||o.resolve()).catch((function(){})),t}))}))):o.reject("Invalid arguments"),t),n}},R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",C=/^~~local_forage_type~([^~]+)~/,M="__lfsc__:",D=M.length,L="arbf",k="blob",B=D+L.length,U=Object.prototype.toString;function x(e){var t,n,r,a,i=.75*e.length,o=e.length,s=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--),i=new ArrayBuffer(i);for(var u=new Uint8Array(i),l=0;l<o;l+=4)t=R.indexOf(e[l]),n=R.indexOf(e[l+1]),r=R.indexOf(e[l+2]),a=R.indexOf(e[l+3]),u[s++]=t<<2|n>>4,u[s++]=(15&n)<<4|r>>2,u[s++]=(3&r)<<6|63&a;return i}function W(e){for(var t=new Uint8Array(e),n="",r=0;r<t.length;r+=3)n+=R[t[r]>>2],n+=R[(3&t[r])<<4|t[r+1]>>4],n+=R[(15&t[r+1])<<2|t[r+2]>>6],n+=R[63&t[r+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var H={serialize:function(e,t){var n="";if(e&&(n=U.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===U.call(e.buffer))){var r,a=M;e instanceof ArrayBuffer?(r=e,a+=L):(r=e.buffer,"[object Int8Array]"===n?a+="si08":"[object Uint8Array]"===n?a+="ui08":"[object Uint8ClampedArray]"===n?a+="uic8":"[object Int16Array]"===n?a+="si16":"[object Uint16Array]"===n?a+="ur16":"[object Int32Array]"===n?a+="si32":"[object Uint32Array]"===n?a+="ui32":"[object Float32Array]"===n?a+="fl32":"[object Float64Array]"===n?a+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(a+W(r))}else if("[object Blob]"===n)(n=new FileReader).onload=function(){var n="~~local_forage_type~"+e.type+"~"+W(this.result);t(M+k+n)},n.readAsArrayBuffer(e);else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,D)!==M)return JSON.parse(e);var t,n=e.substring(B),r=e.substring(D,B);r===k&&C.test(n)&&(t=(e=n.match(C))[1],n=n.substring(e[0].length));var a=x(n);switch(r){case L:return a;case k:return i([a],{type:t});case"si08":return new Int8Array(a);case"ui08":return new Uint8Array(a);case"uic8":return new Uint8ClampedArray(a);case"si16":return new Int16Array(a);case"ur16":return new Uint16Array(a);case"si32":return new Int32Array(a);case"ui32":return new Uint32Array(a);case"fl32":return new Float32Array(a);case"fl64":return new Float64Array(a);default:throw new Error("Unkown type: "+r)}},stringToBuffer:x,bufferToString:W};function G(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function F(e,t,n,r,a,i){e.executeSql(n,r,a,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?i(e,o):G(e,t,(function(){e.executeSql(n,r,a,i)}),i)}),i):i(e,o)}),i)}function j(e,t,n,r){var a=this;e=l(e);var i=new o((function(i,o){a.ready().then((function(){var s=t=void 0===t?null:t,u=a._dbInfo;u.serializer.serialize(t,(function(t,l){l?o(l):u.db.transaction((function(n){F(n,u,"INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){i(s)}),(function(e,t){o(t)}))}),(function(t){t.code===t.QUOTA_ERR&&(0<r?i(j.apply(a,[e,s,n,r-1])):o(t))}))}))})).catch(o)}));return s(i,n),i}var K={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var a=new o((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(a){G(a,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=H,a},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){F(n,a,"SELECT * FROM "+a.storeName,[],(function(n,r){for(var i=r.rows,o=i.length,s=0;s<o;s++){var u=i.item(s),l=(l=u.value)&&a.serializer.deserialize(l);if(void 0!==(l=e(l,u.key,s+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new o((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){F(n,a,"SELECT * FROM "+a.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){n=(n=n.rows.length?n.rows.item(0).value:null)&&a.serializer.deserialize(n),t(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){return j.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=l(e);var r=new o((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){F(n,a,"DELETE FROM "+a.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){F(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){F(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){n=n.rows.item(0).c,e(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){F(n,a,"SELECT key FROM "+a.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){n=n.rows.length?n.rows.item(0).key:null,t(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){F(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],a=0;a<n.rows.length;a++)r.push(n.rows.item(a).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=c.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r=this,a=e.name?new o((function(t){var a,i=e.name===n.name?r._dbInfo.db:openDatabase(e.name,"","",0);e.storeName?t({db:i,storeNames:[e.storeName]}):t((a=i,new o((function(e,t){a.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).name);e({db:a,storeNames:r})}),(function(e,n){t(n)}))}),(function(e){t(e)}))}))))})).then((function(e){return new o((function(t,n){e.db.transaction((function(r){for(var a=[],i=0,s=e.storeNames.length;i<s;i++)a.push(function(e){return new o((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}(e.storeNames[i]));o.all(a).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):o.reject("Invalid arguments");return s(a,t),a}};function V(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Y(e,t){for(var n,r,a=e.length,i=0;i<a;){if((n=e[i])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return 1;i++}}e={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=V(e,this._defaultConfig),!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),void localStorage.removeItem(e)}catch(e){return 1}}()||0<localStorage.length?((this._dbInfo=t).serializer=H,o.resolve()):o.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,a=r.length,i=localStorage.length,o=1,s=0;s<i;s++){var u=localStorage.key(s);if(0===u.indexOf(r)){var l=(l=localStorage.getItem(u))&&t.serializer.deserialize(l);if(void 0!==(l=e(l,u.substring(a),o++)))return l}}}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&t.serializer.deserialize(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var a=r.ready().then((function(){var n=t=void 0===t?null:t;return new o((function(a,i){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)i(r);else try{localStorage.setItem(o.keyPrefix+e,t),a(n)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||i(t),i(t)}}))}))}));return s(a,n),a},removeItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;0<=n;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return s(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(r){t=null}return t&&t.substring(r.keyPrefix.length)}));return s(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],a=0;a<n;a++){var i=localStorage.key(a);0===i.indexOf(e.keyPrefix)&&r.push(i.substring(e.keyPrefix.length))}return r}));return s(n,e),n},dropInstance:function(e,t){t=c.apply(this,arguments),(e="function"!=typeof e&&e||{}).name||(r=this.config(),e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n=this,r=e.name?new o((function(t){e.storeName?t(V(e,n._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):o.reject("Invalid arguments");return s(r,t),r}};var q=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},z={},X={},Q={INDEXEDDB:w,WEBSQL:K,LOCALSTORAGE:e},J=(e=[Q.INDEXEDDB._driver,Q.WEBSQL._driver,Q.LOCALSTORAGE._driver],["dropInstance"]),Z=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(J),$={description:"",driver:e.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ee(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var r in n)n.hasOwnProperty(r)&&(q(n[r])?e[r]=n[r].slice():e[r]=n[r])}return e}function te(e){for(var t in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,te),Q){var n,r;Q.hasOwnProperty(t)&&(r=(n=Q[t])._driver,this[t]=r,z[r]||this.defineDriver(n))}this._defaultConfig=ee({},$),this._config=ee({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}e=new(te.prototype.config=function(e){if("object"!==(void 0===e?"undefined":r(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},te.prototype.defineDriver=function(e,t,n){var r=new o((function(t,n){try{var r=e._driver,a=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(a);for(var i=Z.concat("_initStorage"),u=0,l=i.length;u<l;u++){var c=i[u];if((!Y(J,c)||e[c])&&"function"!=typeof e[c])return void n(a)}!function(){for(var t=0,n=J.length;t<n;t++){var r=J[t];e[r]||(e[r]=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver");return s(t=o.reject(t),arguments[arguments.length-1]),t}}(r))}}();var f=function(n){z[r]&&console.info("Redefining LocalForage driver: "+r),z[r]=e,X[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(f,n):f(!!e._support):f(!0)}catch(a){n(a)}}));return u(r,t,n),r},te.prototype.driver=function(){return this._driver||null},te.prototype.getDriver=function(e,t,n){return u(e=z[e]?o.resolve(z[e]):o.reject(new Error("Driver not found.")),t,n),e},te.prototype.getSerializer=function(e){var t=o.resolve(H);return u(t,e),t},te.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return u(n,e,e),n},te.prototype.setDriver=function(e,t,n){var r=this;q(e)||(e=[e]);var a=this._getSupportedDrivers(e);function i(){r._config.driver=r.driver()}function s(e){return r._extend(e),i(),r._ready=r._initStorage(r._config),r._ready}return e=null!==this._driverSet?this._driverSet.catch((function(){return o.resolve()})):o.resolve(),this._driverSet=e.then((function(){var e=a[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,i(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var a=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(a).then(s).catch(n)}i();var u=new Error("No available storage method found.");return r._driverSet=o.reject(u),r._driverSet}()}}(a)}))})).catch((function(){i();var e=new Error("No available storage method found.");return r._driverSet=o.reject(e),r._driverSet})),u(this._driverSet,t,n),this._driverSet},te.prototype.supports=function(e){return!!X[e]},te.prototype._extend=function(e){ee(this,e)},te.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n];this.supports(a)&&t.push(a)}return t},te.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=Z.length;e<t;e++)!function(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}(this,Z[e])},te.prototype.createInstance=function(e){return new te(e)},te),t.exports=e},{3:3}]},{},[4])(4)},4375:(e,t,n)=>{let r;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:n.g):e=>(r=r||Promise.resolve()).then(e).catch((e=>setTimeout((()=>{throw e}),0)))},9967:(e,t,n)=>{e.exports=function(e,t,n){if("number"!=typeof t)throw new Error("second argument must be a Number");let a,i,o,s,u,l,c=!0;function f(e){function t(){n&&n(e,a),n=null}c?r(t):t()}function d(t,n,r){if(a[t]=r,n&&(u=!0),0==--o||n)f(n);else if(!u&&l<i){let t;s?(t=s[l],l+=1,e[t]((function(e,n){d(t,e,n)}))):(t=l,l+=1,e[t]((function(e,n){d(t,e,n)})))}}o=i=Array.isArray(e)?(a=[],e.length):(s=Object.keys(e),a={},s.length),l=t,o?s?s.some((function(n,r){return e[n]((function(e,t){d(n,e,t)})),r===t-1})):e.some((function(e,n){return e((function(e,t){d(n,e,t)})),n===t-1})):f(null),c=!1};const r=n(4375)},3072:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6756);function a(){}a.isTokenValid=function(e,t){return new Promise((function(n,i){null!=e&&null!=t?r.default.get("https://iid.googleapis.com/iid/info/"+e+"?details=true",{headers:{authorization:"key="+t}}).then((function(e){200===e.status?n(!0):n(!1)})).catch((function(r){0===r.code?setTimeout((function(){n(a.isTokenValid(e,t))}),3e3):n(!1)})):n(!1)}))},n=a,t.default=n},7016:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var u=n(5601),l=n(9483),c=n(6756),f=n(3358),d=n(3571),g=n(8611),p=n(1586),S=n(85),h=n(8553),E=n(3546),T=n(6801),m=n(4846),_=n(2983),v=n(464),y=n(1385),A=n(855),I=n(5877),b=n(8032),O=n(5511);function N(){}N.deviceAdd=function(){return new Promise((function(e,t){var n=T.default.get();return N.collectGetParams().then((function(r){c.default.post(n.baseDomainName+"v2/device/add",{queryParams:r}).then((function(){v.default.get().then((function(t){t.deviceAdded=!0,t.save().then((function(){S.default.startPeriodicClear(u.default.PERSISTENT_STORAGE.Q.REPORT),N.onDeviceAdd.res(),e(!0)}))}))})).catch((function(e){d.default.enqueue(u.default.PERSISTENT_STORAGE.Q.DEVICE,!0),t(!1)}))}))}))},N.reportAdd=function(e,t){var n=this,r=N.baseLogTag+".reportAdd";return new Promise((function(a,i){return t=!!t,N.getWebSDKSettings().then((function(i){i.isPushSubBilling?v.default.get().then((function(i){i.deviceAdded?N.reportAddInternal(e,t).then((function(){n.sendBroadcast(e),a(!0)})):(d.default.enqueue(u.default.PERSISTENT_STORAGE.Q.REPORT,e),f.default.log(1,r,"Report added to queue as device not added yet:",e.event.name),f.default.log(2,r,"Event Queued:",e.event.name),e.type===m.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&(N.isPushSubAttributeAccepted(e.event.attributes[0].key)?(f.default.log(1,r,"Attribute accepted for push sub billing."),N.deviceAdd()):f.default.log(2,r,"Attribute NOT accepted for push sub billing.")),a(!0))})):N.reportAddInternal(e,t).then((function(){n.sendBroadcast(e),a(!0)}))}))}))},N.sendBroadcast=function(e){u.AUTOMATED_EVENTS.NAMES.includes(e.event.name)&&O.default.broadcastToWindow({topic:u.AUTOMATED_EVENTS.TOPIC,name:e.event.name,data:e.event.attributes})},N.getSegmentId=function(){var e=window.analytics;if(e&&e.user)return e.user().anonymousId()},N.getBatchRequestOptions=function(e){return new Promise((function(t){N.collectGetParams().then((function(n){var r=N.getSegmentId()||"",a=v.default.getSync(),i=new p.default,u={session_id:i.getSessionKey(),start_time:i.getSessionStartTime(),background_initiated:0},l=[],c=i.getActiveSource();c&&(i.setCurrentSource(c),l.push(c)),l={query_params:n,identifiers:{moe_user_id:a.getAttribute("id")||"",segment_id:r},meta:{bid:(0,I.v4)(),request_time:(new Date).toISOString(),session:u,source:l.length?l:void 0},viewsCount:e.length,viewsInfo:s([],o(e),!1)},t(l)}))}))},N.addReportsToOfflineDB=function(e,t){return a(this,void 0,void 0,(function(){var n,r;return i(this,(function(a){switch(a.label){case 0:return n=N.baseLogTag+".addReportsToOfflineDB",[4,N.getBatchRequestOptions([])];case 1:return r=a.sent(),[4,y.default.offlineDataStore.setItem(t||"report_add_".concat((new Date).getTime()),e)];case 2:return a.sent(),[4,y.default.offlineDataStore.setItem("requestMetaData",r)];case 3:return a.sent(),navigator.serviceWorker&&navigator.serviceWorker.ready.then((function(e){e.sync?e.sync.register(u.OFFLINE.OFFLINE_SYNC_EVENT).then((function(){f.default.log(2,n,"offline sync event registered")})).catch((function(e){f.default.error(1,n,"Service worker sync error",e)})):f.default.log(2,n,"Service worker sync unavailable")})),[2]}}))}))},N.sendBatchOfReports=function(e){var t=N.baseLogTag+".sendBatchOfReports";return new Promise((function(n){N.getBatchRequestOptions(e).then((function(r){var a=(a=T.default.get()).baseDomainName+u.BATCH.API.REPORT_ADD+a.appId;c.default.post(a,{postData:r}).then((function(){f.default.log(1,t,"Batch sent to MoEngage successfully"),n(!0)})).catch((function(r){f.default.error(1,t,"Batch Report add API failed",r),N.addReportsToOfflineDB(e).then((function(){f.default.log(2,t,"Network offline: Batch added to offline db")})),n(!0)}))}))}))},N.reportAddInternal=function(e,t){var n=N.baseLogTag+".reportAddInternal";return new Promise((function(r,a){N.getWebSDKSettings().then((function(a){E.default.getInstance().then((function(i){if("allowed"===a.s_e_b_e&&i.name!==E.default.BROWSER_NAMES.SAFARI&&i.name!==E.default.BROWSER_NAMES.FIREFOX&&navigator.sendBeacon&&!t)A.default.addReport(e,a.e_b_c),f.default.log(1,n,"Event batched successfully:",e.event),N.eventStore.setItem(e.event.name,e.event),r(!0);else{var o,s=N.getUpdatedPushDetails();for(o in s)!s.hasOwnProperty(o)||e.event.name===u.default.EVENT_NAMES.UNSUBSCRIBED&&"push_id"===o||(e.getParams[o]=s[o]);var l={queryParams:e.getParams};e.postData.nie?(delete(g=Object.assign({},e)).postData.meta.source,delete g.postData.meta.session,l.postData=g.postData):l.postData=e.postData;var g=T.default.get().baseDomainName;c.default.post(g+=t?"v2/device/add":"v2/report/add",l).then((function(){e.type===m.default.REPORT_ADD_TYPE.EVENT?(f.default.log(1,n,"Event tracked successfully:",e.event),N.eventStore.setItem(e.event.name,e.event)):e.type===m.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&f.default.log(1,n,"User attribute added successfully:",e.event.attributes),N.addReportApiRetries=1,r(!0)})).catch((function(r){var o;"allowed"===a.s_e_b_e&&i.name!==E.default.BROWSER_NAMES.SAFARI&&i.name!==E.default.BROWSER_NAMES.FIREFOX&&navigator.sendBeacon?(f.default.error(1,n,"Add Report API failed, adding reports to offline db",r),t?d.default.enqueue(u.default.PERSISTENT_STORAGE.Q.DEVICE,e):(o=new b.ReportView(e),N.offlineEvents.push(o),N.addReportsToOfflineDB(N.offlineEvents,"report_add").then((function(){f.default.log(2,n,"Network offline: Batch added to offline db")})))):(f.default.error(1,n,"Add Report API failed",r),e.type===m.default.REPORT_ADD_TYPE.EVENT?f.default.log(1,n,"Queueing unsuccessful event tracking:",e.event):e.type===m.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&f.default.log(1,n,"Queueing unsuccessful user attribute add:",e.event.attributes),N.addReportApiRetries<u.default.ADD_REPORT_API_MAX_RETRIES&&setTimeout((function(){N.addReportApiRetries++,d.default.enqueue(u.default.PERSISTENT_STORAGE.Q.REPORT,e),S.default.startPeriodicClear(u.default.PERSISTENT_STORAGE.Q.REPORT)}),3e3*N.addReportApiRetries))}))}}))}))}))},N.checkIfTokenValid=function(e){var t=T.default.get().baseDomainName+"v2/device/token-check",n=T.default.get();return new Promise((function(r){e?v.default.get().then((function(a){a={queryParams:{app_id:n.appId,unique_id:a.deviceUuid,push_id:e}},c.default.post(t,a).then((function(e){200===e.status?r(!0):r(!1)})).catch((function(e){r(!1)}))})):r(!1)}))},N.getWebSDKSettings=function(){return new Promise((function(e,t){var n,r,a=T.default.get();null!=a&&null!=a.appId||(a=new T.default(h.default.get(u.default.PERSISTENT_STORAGE.INIT_DATA))),N.sdkSettings?e(N.sdkSettings):(n=(new Date).getTime(),null==(r=h.default.get(u.default.PERSISTENT_STORAGE.SETUP_TIME))||0<a.debugLevel?N.getAndPersistWebSettings(a).then((function(t){e(t)})).catch((function(e){t(!1)})):864e5<n-r?N.getAndPersistWebSettings(a).then((function(t){e(t)})):h.default.get(u.default.PERSISTENT_STORAGE.WEB_SETTINGS)?(N.sdkSettings=h.default.get(u.default.PERSISTENT_STORAGE.WEB_SETTINGS),e(N.sdkSettings)):N.getAndPersistWebSettings(a).then((function(t){e(t)})))}))},N.getAndPersistWebSettings=function(e){var t=this,n=N.baseLogTag+".getAndPersistWebSettings";return new Promise((function(o,s){return a(t,void 0,void 0,(function(){var t,a,l,d,p;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),null==e.appId&&(e=new T.default(h.default.get(u.default.PERSISTENT_STORAGE.INIT_DATA))),t={queryParams:{app_id:e.appId}},f.default.log(1,n,"Fetching latest web sdk settings for",e.appId),[4,c.default.get(e.baseDomainName+"websdksettings",t)];case 1:l=i.sent(),f.default.log(1,n,"Fetching config settings for",e.appId),"string"==typeof(a=l.responseText)&&(a=JSON.parse(a)),d=(0,g.isMobile)()?"mweb":"web",l=e.baseDomainName+u.default.CONFIG.API.META+d+"/"+e.appId,i.label=2;case 2:return i.trys.push([2,4,,5]),[4,c.default.get(l)];case 3:return d=i.sent(),f.default.log(1,n,"Fetched latest web and config settings"),200===d.status&&(d=d.responseText,d=JSON.parse(d),a.webData=r(r({},a.webData),d)),[3,5];case 4:return i.sent(),f.default.error(1,n,"Config API failed"),[3,5];case 5:return p=(new Date).getTime(),a=_.default.parseOldSettings(a),h.default.set(u.default.PERSISTENT_STORAGE.WEB_SETTINGS,a),h.default.set(u.default.PERSISTENT_STORAGE.SETUP_TIME,p),o(N.sdkSettings=a),[3,7];case 6:return p=i.sent(),f.default.error(1,n,"Settings APi Failed: ",p),N.webSdkApiRetries<u.default.WEB_SDK_API_MAX_RETRIES?setTimeout((function(){N.webSdkApiRetries++,o(N.getAndPersistWebSettings(e))}),3e3*N.webSdkApiRetries):s(!1),[3,7];case 7:return[2]}}))}))}))},N.collectGetParams=function(){var e=this;return new Promise((function(t,n){v.default.get().then((function(n){var r=T.default.get();null!=r&&null!=r.appId||(r=new T.default(h.default.get(u.default.PERSISTENT_STORAGE.INIT_DATA)));var a=new Date,i=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds());E.default.getInstance().then((function(a){var o={os:a.os,os_platform:a.osPlatform,is_incognito:a.isIncognito,app_id:r.appId,os_ver:a.name,sdk_ver:"2.8.27",model:a.name,app_ver:"1.0",device_ts:Number(i),device_tz_offset:(-6e4*(new Date).getTimezoneOffset()).toString(),unique_id:n.deviceUuid,device_tz:(new Date).getTimezoneOffset().toString()},s=h.default.get(u.default.PERSISTENT_STORAGE.PUSH_TOKEN);null!=s&&"NA"!==s&&""!==s&&"null"!==s&&(o.push_id=s),a.isChromeLike()&&((0,g.isVapid)(e.sdkSettings.platformSettings,a)?(o.subscription_type="vapid",o.vapid_public=(0,g.getVapidPublicKey)(e.sdkSettings.platformSettings,a)):o.subscription_type="normal",o.sender_id=e.sdkSettings.platformSettings.chrome.projectNumber),null!=r.environment&&(o.environment=r.environment),a.name===E.default.BROWSER_NAMES.SAFARI&&(o.websitePushId=e.sdkSettings.platformSettings.safari.websitePushId);var l=h.default.get(u.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS);if(null!=l&&null!=l.keys){for(var c in l.keys)o["keys_"+c]=encodeURI(l.keys[c]);null!=l.endpoint&&(o.endpoint=encodeURI(l.endpoint)),o.expirationTime=l.expirationTime}t(o)}))}))}))},N.getUpdatedPushDetails=function(){var e={},t=h.default.get(u.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS);if(null!=t){var n=h.default.get(u.default.PERSISTENT_STORAGE.PUSH_TOKEN);if(null!=n&&"NA"!==n&&""!==n&&"null"!==n&&(e.push_id=n),t.keys){for(var r in t.keys)e["keys_"+r]=encodeURI(t.keys[r]);null!=t.endpoint&&(e.endpoint=encodeURI(t.endpoint)),e.expirationTime=t.expirationTime}}return e},N.isPushSubAttributeAccepted=function(e){return e===u.default.ATTRIBUTE_NAMES.EMAIL||e===u.default.ATTRIBUTE_NAMES.MOBILE},N.sendBeacon=function(e){N.getBatchRequestOptions(e).then((function(e){var t=(t=T.default.get()).baseDomainName+u.BATCH.API.REPORT_ADD+t.appId+"?"+(new Date).getTime();navigator.sendBeacon(t,JSON.stringify(e))}))},N.baseLogTag="MoeApi",N.onDeviceAdd=new g.PromiseObject,N.webSdkApiRetries=1,N.offlineEvents=[],N.addReportApiRetries=1,N.eventStore=l.createInstance({driver:[l.INDEXEDDB,l.WEBSQL,l.LOCALSTORAGE],name:u.default.EVENTS.DATABASE_NAME,storeName:u.default.EVENTS.STORE_NAME}),l=N,t.default=l},7408:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(8611),s=n(6756),u=n(5601),l=n(8553),c=n(3358),f=n(9483),d=n(1520),g=n(1481);function p(e,t){this.appId=e,this.store=f.createInstance({driver:[f.INDEXEDDB,f.WEBSQL,f.LOCALSTORAGE],name:u.INAPP_CONSTANTS.DATABASE_NAME,storeName:u.INAPP_CONSTANTS.STORES.SERVICE_META.NAME}),this.host=u.INAPP_CONSTANTS.HOST_1,null!=t&&null!=t.host&&(this.host=t.host)}p.prototype.getCampaignsMeta=function(e){return a(this,void 0,void 0,(function(){var t,n,a,l,f,d;return i(this,(function(i){switch(i.label){case 0:t=p.baseLogTag+".getCampaignsMeta",i.label=1;case 1:return i.trys.push([1,4,,5]),n=this.getRequestOptions(),a=void 0,[4,this.store.getItem(u.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_META_CALL_TIME)];case 2:return null!=(l=i.sent())&&(a=l.toISOString()),[4,s.default.post(this.host+u.INAPP_CONSTANTS.API.META,r(r({},n),{postData:{campaign_ids:e},last_fetch_time:a}))];case 3:return d=i.sent(),this.store.setItem(u.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_META_CALL_TIME,new Date),this.store.setItem(u.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.UNIQUE_ID,n.queryParams.unique_id),d=JSON.parse(d.responseText),f=[],d.campaigns.forEach((function(e){g.default.isValidMetaJSON(e)&&f.push(new g.default(e))})),[2,{campaignsMeta:f,globalDelayBetweenInapps:(0,o.getProp)(d,"min_delay_btw_inapps",0)}];case 4:throw d=i.sent(),c.default.error(1,t,"Error getting meta for inapp: ",d),new Error("Could not get meta payload");case 5:return[2]}}))}))},p.prototype.getCampaignPayload=function(e,t){return a(this,void 0,void 0,(function(){var n,r,a,o,l;return i(this,(function(i){switch(i.label){case 0:n=p.baseLogTag+".getCampaignPayload",i.label=1;case 1:if(i.trys.push([1,6,,7]),!t)return[3,3];for(a={},o=0;o<t.attributes.length;o++)a[t.attributes[o].key]=t.attributes[o].value;return l={event:{name:t.name,attributes:a,time:(new Date).toISOString()},contexts:["string"],campaign_context:e.campaignContext},[4,s.default.post(this.host+u.INAPP_CONSTANTS.API.CAMPAIGN_PAYLOAD+e.campaignId,this.getRequestOptions(l))];case 2:return r=i.sent(),[3,5];case 3:return[4,s.default.post(this.host+u.INAPP_CONSTANTS.API.CAMPAIGN_PAYLOAD+e.campaignId,this.getRequestOptions())];case 4:r=i.sent(),i.label=5;case 5:return(r=JSON.parse(r.responseText)).code===u.INAPP_CONSTANTS.GCG_ERROR_CODE&&(r={payload:r}),[2,new d.default(r)];case 6:throw l=i.sent(),c.default.error(1,n,"Error geting payload",l),new Error("Could not get payload for "+e.campaignId);case 7:return[2]}}))}))},p.prototype.getDraftCampaign=function(e){return a(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(a){switch(a.label){case 0:t=p.baseLogTag+".getDraftCampaign",a.label=1;case 1:return a.trys.push([1,3,,4]),(n=this.getRequestOptions()).queryParams=Object.assign({},n.queryParams,{locale:e.locale,variation:e.variation}),[4,s.default.get(this.host+u.INAPP_CONSTANTS.API.DRAFT_CAMPAIGN_PAYLOAD+e.draftId,n)];case 2:return r=a.sent(),"JSON"===(r=JSON.parse(r.responseText)).payload_type&&(r.payload=JSON.parse(r.payload)),[2,new d.default(r)];case 3:return r=a.sent(),c.default.error(1,t,"Error geting test campaign payload",r),[2,null];case 4:return[2]}}))}))},p.prototype.getRequestOptions=function(e){var t=(0,o.getMoeWindowVar)(),n=l.default.get(u.default.PERSISTENT_STORAGE.USER_DATA).deviceUuid;if(!n)throw new Error("device_unique_id not found in localStorage.");return{headers:{"Content-Type":"application/json","MOE-APPKEY":this.appId},queryParams:{sdk_ver:t.getSdkVersion(),os:(0,o.isMobile)()?"mweb":"web",unique_id:n},postData:e||{}}},p.baseLogTag="OnsiteApi",n=p,t.default=n},5601:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AUTOMATED_EVENTS=t.PAGE_LIFE_CYCLE=t.DATA_TYPES=t.BATCH=t.OFFLINE=t.SESSION_SOURCE_STATUS=t.SDK_MODULES=t.INAPP_CONSTANTS=t.WINDOW_OBJECTS=void 0;var n,r=(a.EPHEMERAL_STORAGE={INIT_DATA:"initData",BROWSER_DETAILS:"browserDetails",UNIFIED_LOGS:"unifiedLogs"},a.PERSISTENT_STORAGE={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails",SESSION:"SESSION"},a.COOKIE_STORAGE={SESSION_COOKIE:{EXPIRY_YEARS:2}},a.EVENT_NAMES={USER_ATTRIBUTE:"EVENT_ACTION_USER_ATTRIBUTE",UNSUBSCRIBED:"MOE_WEB_UNSUBSCRIBED",WEB_SESSION_START:"EVENT_ACTION_WEB_SESSION_START",PAGE_VIEWED:"MOE_PAGE_VIEWED",WEB_OPTIN_BANNER_LOAD:"MOE_WEB_OPTIN_BANNER_LOAD",WEB_OPTIN_CLOSED:"MOE_WEB_OPTIN_CLOSED",WEB_OPTIN_ACCEPTED:"MOE_WEB_OPTIN_ACCEPTED",USER_SUBSCRIBED:"MOE_USER_SUBSCRIBED",OPT_IN_SHOWN:"MOE_OPT_IN_SHOWN",OPT_IN_ALLOWED:"MOE_OPT_IN_ALLOWED",OPT_IN_DISMISSED:"MOE_OPT_IN_DISMISSED",OPT_IN_BLOCKED:"MOE_OPT_IN_BLOCKED",LOGOUT:"MOE_LOGOUT",UPDATE_DEVICE_ATTRIBUTE:"EVENT_ACTION_DEVICE_ATTRIBUTE"},a.EVENT_ATTRIBUTES_NAMES={URL:"URL",LOGGED_IN_STATUS:"moe_logged_in_status",FIRST_VISIT:"moe_first_visit"},a.ATTRIBUTE_NAMES={ID:"USER_ATTRIBUTE_UNIQUE_ID",EMAIL:"USER_ATTRIBUTE_USER_EMAIL",NAME:"USER_ATTRIBUTE_USER_NAME",FIRST_NAME:"USER_ATTRIBUTE_USER_FIRST_NAME",LAST_NAME:"USER_ATTRIBUTE_USER_LAST_NAME",MOBILE:"USER_ATTRIBUTE_USER_MOBILE",GENDER:"USER_ATTRIBUTE_USER_GENDER",BDAY:"USER_ATTRIBUTE_USER_BDAY",ID_MODIFIED:"USER_ID_MODIFIED_FROM"},a.SDK_FEATURES={WEB_PUSH:"WEB_PUSH"},a.BROADCAST_TOPICS={MOE_LIFECYCLE:{TOPIC_NAME:"MOE_LIFECYCLE",EVENT_NAMES:{MOE_INIT:"SDK_INITIALIZED",SETTINGS_FETCHED:"SETTINGS_FETCHED"}},OPT_IN_LIFECYCLE:{TOPIC_NAME:"MOE_OPT_IN",EVENT_NAMES:{HARD_ASK_SHOWN:"HARD_ASK_SHOWN",HARD_ASK_DISMISSED:"HARD_ASK_DISMISSED",HARD_ASK_ALLOWED:"HARD_ASK_ALLOWED",HARD_ASK_DENIED:"HARD_ASK_DENIED",SOFT_ASK_SHOWN:"SOFT_ASK_SHOWN",SOFT_ASK_DISMISSED:"SOFT_ASK_DISMISSED",SOFT_ASK_ALLOWED:"SOFT_ASK_ALLOWED"}},INAPP_LIFECYCLE:{TOPIC_NAME:"INAPP_LIFECYCLE",EVENT_NAMES:{MODULE_LOADED:"MODULE_LOADED"}}},a.ERRORS={WEB_PUSH_NOT_SUPPORTED:{code:1e3,reason:"Web push not supported in current browser environment"},SERVICE_WORKER_REGISTRATION_FAILED:{code:1001,reason:"Registering the service worker failed"},WEB_PUSH_NOT_CONFIGURED:{code:1002,reason:"Web push settings not configured"},NOTIFICATION_MANAGER_NOT_CONFIGURED:{code:1003,reason:"Could not configure a notification manager for the current browser and settings"},PERMISSION_DISMISSED_TOO_MANY_TIMES:{code:1004,reason:"Hard ask was dismissed to many times"},SERVICE_WORKER_NOT_IN_CORRECT_SCOPE:{code:1005,reason:"Service worker can not be registered on this page due to scope issues"}},a.HTML_COMM={CHANNEL:{MAIN:"moe",SUBD:"moe-subd"},TOPICS:{PERSISTENT_STORAGE:"STORAGE",EPHEMERAL_STORAGE:"EPHEMERAL_STORAGE",PERMISSION_STATE:"PERMISSION_STATE",CONFIG:"CONFIG",HARD_ASK_RESULT:"HARD_ASK_RESULT",SHOW_NOTIF:"SHOW_NOTIF"}},a.GIFS={AMAZED:"https://media.giphy.com/media/90F8aUepslB84/giphy.gif",SAD:"https://media.giphy.com/media/KDRv3QggAjyo/giphy.gif"},a.DEPRECATED_CLUSTERS={dc_1:"us",dc_2:"eu",dc_3:"in"},a.CLUSTERS={dc_1:"DC_1",dc_2:"DC_2",dc_3:"DC_3",dc_4:"DC_4"},a.CLUSTER_ENVIRONMENT_MAP={DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com",eu:"sdk-02.moengage.com",in:"sdk-03.moengage.com"},a.LINKS={MOE_DASHBOARD:"https://app.moengage.com",MIGRATION_DOCS:"https://docs.moengage.com/docs/web-sdk-integration",WEBSDK_DOCS:"https://docs.moengage.com/docs/web-sdk-integration",SELF_HANDLED_DOCS:"https://docs.moengage.com/docs/self-handled-opt-ins"},a.WEB_SDK_API_MAX_RETRIES=3,a.ADD_REPORT_API_MAX_RETRIES=3,a.PUSH_SETTINGS_PAGE_LINK="Dashboard --\x3e Settings --\x3e Channel --\x3e Push",a.SESSION_SOURCE={SESSION:"SESSION",SESSION_KEY:"sessionKey",SESSION_START_TIME:"sessionStartTime",SESSION_EXPIRY_TIME:"sessionExpiryTime",SESSION_MAX_TIME:"sessionMaxTime",SESSION_ENABLED:"sessionEnabled",CUSTOM_IDENTIFIERS_TO_TRACK:"customIdentifiersToTrack",CURRENT_SOURCE:"currentSource",NUMBER_OF_SESSIONS:"numberOfSessions"},a.CONFIG={HOST:"https://apiv2.moengage.com/",API:{META:"v3/sdkconfig/"}},a.EVENTS={DATABASE_NAME:"moe_tracking",STORE_NAME:"events"},a.AMP={UUID:"moe_uuid"},a.BRANCH="master",a.SEGMENT_CLUSTER="moe_segment_cluster",a.SEGMENT_SW_PATH="moe_segment_sw_path",a.SEGMENT_SW_SCOPE="moe_segment_sw_scope",a);function a(){}t.default=r,t.WINDOW_OBJECTS={PageEventHistoryManager:"MoengagePageEventHistoryManager"},t.INAPP_CONSTANTS={HOST_1:"https://sdk-01.moengage.com/",HOST_2:"https://sdk-02.moengage.com/",HOST_3:"https://sdk-03.moengage.com/",HOST_4:"https://sdk-04.moengage.com/",API:{META:"v3/campaigns/inapp/live",CAMPAIGN_PAYLOAD:"v3/campaigns/inapp/live/",DRAFT_CAMPAIGN_PAYLOAD:"v3/campaigns/inapp/test/"},DRAFT_CAMPAIGN_TPYES:{WEB_PERSONALIZATON:"web_personalization",ONSITE_MESSAGING:"onsite_messaging"},META_REFRESH_TIME:9e5,DATABASE_NAME:"moe_onsite",STORES:{CAMPAIGNS_META:{NAME:"campaigns_meta"},CAMPAIGNS_TAGS:{NAME:"campaigns_tags"},CAMPAIGNS_STATS:{NAME:"campaigns_stats"},TEST_CAMPAIGN_STORE:{NAME:"test_campaign"},EXIT_INTENT_CAMPAIGN_STORE:{NAME:"exit_intent"},SERVICE_META:{NAME:"service_meta",KEYS:{LAST_META_CALL_TIME:"last_meta_call_time",GLOBAL_DELAY:"global_delay_between_inapps",LAST_INAPP_SHOWN_TIME:"last_inapp_shown",LAST_FETCH_SDK_VERSION:"last_fetch_sdk_version",UNIQUE_ID:"unique_id"}}},EVENT_NAMES:{OSM:{CLICK:"MOE_ONSITE_MESSAGE_CLICKED",IMPRESSION:"MOE_ONSITE_MESSAGE_SHOWN",DISMISS:"MOE_ONSITE_MESSAGE_DISMISSED",AUTO_DISMIS:"MOE_ONSITE_MESSAGE_AUTO_DISMISS",TYPE:"onsite"},WP:{CLICK:"MOE_WEBP_MESSAGE_CLICKED",IMPRESSION:"MOE_WEBP_MESSAGE_SHOWN",DISMISS:"MOE_WEBP_MESSAGE_DISMISSED",DELIVERED:"MOE_WEBP_MESSAGE_DELIVERED",TYPE:"webp"}},WEB_HELPER_IFRAME_URL:"https://cdn.moengage.com/webpush/beta/webpushhelper.html",IFRAME_CHANNEL:"inapp_helper",IFRAME_TOPICS:{COOKIE_STORAGE:"COOKIE_STORAGE"},COOKIE_STORAGE:{TEST_DRAFT_TYPE:"moe_inapp_draft_type",TEST_DRAFT_ID:"moe_inapp_draft_id",TEST_DRAFT_TAG:"moe_inapp_draft_tag",TEST_CAMPAIGN_META:"test_campaign_meta",TEST_TEMPLATE_TYPE:"test_template_type",TEST_VARIATION:"moe_inapp_draft_variation",TEST_LOCALE:"moe_inapp_draft_locale"},CSS_SELECTORS:{CLICK_INAPP:"moe-inapp-click",DISMISS_INAPP:"moe-inapp-close"},EXIT_INTENT:{CONFIG:{SCROLL_DOWN_THRESHOLD:50,SCROLL_UP_THRESHOLD:5,SCROLL_INTERVAL:1e3}},POSITIONED_TEMPLATE:'data-editor-type="MOE_EDITOR"',SIDE_BANNER:'data-template-type="SIDE_BANNER"',GCG_ERROR_CODE:"E001",SCROLL_CAMPAIGN_THROTTLING_TIME:1500},t.SDK_MODULES={INAPP:{name:"INAPP",src:"https://cdn.moengage.com/webpush/modules/inapp.js",windowLocation:"moeOnsite"}},(n=t.SESSION_SOURCE_STATUS||(t.SESSION_SOURCE_STATUS={})).BLOCKED="blocked",n.ALLOWED="allowed",t.OFFLINE={DATABASE_NAME:"moe_database",OFFLINE_SYNC_EVENT:"moe_offline_data_sync",STORES:{OFFLINE_DATA:{NAME:"offline_data"}}},t.BATCH={API:{REPORT_ADD:"v2/sdk/report/"},CONFIG:{TIME_BETWEEN_BATCHES:15e3}},t.DATA_TYPES={NUMBER:"number"},t.PAGE_LIFE_CYCLE={FIRST_SEEN_SESSIONS:1},t.AUTOMATED_EVENTS={TOPIC:"MOE_AUTOMATED_EVENTS",NAMES:[r.EVENT_NAMES.UNSUBSCRIBED,r.EVENT_NAMES.WEB_SESSION_START,r.EVENT_NAMES.PAGE_VIEWED,r.EVENT_NAMES.WEB_OPTIN_BANNER_LOAD,r.EVENT_NAMES.WEB_OPTIN_CLOSED,r.EVENT_NAMES.WEB_OPTIN_ACCEPTED,r.EVENT_NAMES.USER_SUBSCRIBED,r.EVENT_NAMES.OPT_IN_SHOWN,r.EVENT_NAMES.OPT_IN_ALLOWED,r.EVENT_NAMES.OPT_IN_DISMISSED,r.EVENT_NAMES.OPT_IN_BLOCKED,r.EVENT_NAMES.LOGOUT,t.INAPP_CONSTANTS.EVENT_NAMES.OSM.CLICK,t.INAPP_CONSTANTS.EVENT_NAMES.OSM.IMPRESSION,t.INAPP_CONSTANTS.EVENT_NAMES.OSM.DISMISS,t.INAPP_CONSTANTS.EVENT_NAMES.OSM.AUTO_DISMIS]}},9611:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.dismissActiveOsm=t.regex=t.validateMessagingCampaigns=t.filterAndSortCampaigns=t.CampaignUtils=t.sendDeliveredEvent=t.sendDismissEvent=t.getImpressionTracker=t.getClickTracker=void 0;var o=n(1481),s=n(5601),u=n(8611),l=n(1151),c=n(3358),f=n(8611);t.getClickTracker=function(e,t,n){return null==e.campaignId?function(){}:function(){return l.default.campaingsStatsStore.getItem(e.campaignId).then((function(t){t=null!=t?r(r({},t),{clicks:(0,u.getProp)(t,"clicks",0)+1}):{clicks:1},l.default.campaingsStatsStore.setItem(e.campaignId,t)})),null==n&&(n={}),d().track_event(s.INAPP_CONSTANTS.EVENT_NAMES[t].CLICK,r(r({campaign_id:e.campaignId,campaign_name:e.campaignName,type:s.INAPP_CONSTANTS.EVENT_NAMES[t].TYPE},n),e.campaignContext))}},t.getImpressionTracker=function(e,t,n){return void 0===n&&(n=!1),null==e.campaignId?function(){}:function(){if(l.default.initialize().then((function(){l.default.campaingsStatsStore.getItem(e.campaignId).then((function(t){t=null!=t?r(r({},t),{impressions:(0,u.getProp)(t,"impressions",0)+1,lastImpression:new Date}):{impressions:1,lastImpression:new Date},l.default.campaingsStatsStore.setItem(e.campaignId,t)}))})),!n)return d().track_event(s.INAPP_CONSTANTS.EVENT_NAMES[t].IMPRESSION,r({campaign_id:e.campaignId,campaign_name:e.campaignName,type:s.INAPP_CONSTANTS.EVENT_NAMES[t].TYPE,templateType:e.templateType},e.campaignContext))}},t.sendDismissEvent=function(e,t,n){n=n?s.INAPP_CONSTANTS.EVENT_NAMES[t].AUTO_DISMIS:s.INAPP_CONSTANTS.EVENT_NAMES[t].DISMISS,d().track_event(n,r({campaign_id:e.campaignId,campaign_name:e.campaignName,type:s.INAPP_CONSTANTS.EVENT_NAMES[t].TYPE},e.campaignContext))},t.sendDeliveredEvent=function(e,t){d().track_event(s.INAPP_CONSTANTS.EVENT_NAMES[t].DELIVERED,r({campaign_id:e.campaignId,campaign_name:e.campaignName,type:s.INAPP_CONSTANTS.EVENT_NAMES[t].TYPE},e.campaignContext))};var d=function(){return window.Moengage},g=(p.isValid=function(e,t){return!p.isCampaignExpired(e)&&p.isCampaignActive(e)&&p.isUserInCampaignSegment(e)&&p.isCampaignWithinFC(e,t)},p.isValidMessagingCampaign=function(e,t,n,r,a){return p.canCampaignBeRenderedOverExisting(e,a)&&p.hasCampaignClearedSelfDelay(e,t)&&p.hasCampaignClearedGlobalDelay(e,n,r)},p.isCampaignExpired=function(e){return(new Date).getTime>e.expiryTime.getTime&&(c.default.warn(1,p.baseLogTag+".isValid","Campaign ".concat(e.campaignId," : Expired")),!0)},p.isCampaignActive=function(e){return e.status===o.OnsiteCampaignStatus.ACTIVE||(c.default.warn(1,p.baseLogTag+".isValid","Campaign ".concat(e.campaignId," : Status is ").concat(e.status)),!1)},p.isUserInCampaignSegment=function(e){return!!e.userInSegment||(c.default.warn(1,p.baseLogTag+".isValid","Campaign ".concat(e.campaignId," : User is not in segment")),!1)},p.isCampaignWithinFC=function(e,t){var n=p.baseLogTag+".isValid";if([o.TEMPLATE_TYPE.SELF_HANDLED].indexOf(e.templateType)<0){var r=(0,u.getProp)(e,"delivery.fc_meta.count",0);if(0<r){var a=(0,u.getProp)(t,"impressions",0);if(null!=t)return!(r<=a&&(c.default.warn(1,n,"Campaign ".concat(e.campaignId," : FC reached. ").concat(t.impressions," times shown")),1))}}return!0},p.canCampaignBeRenderedOverExisting=function(e,t){return!(0<(t&&t.length)&&!e.display.config.showOverOtherCampaigns&&(c.default.warn(1,p.baseLogTag+".isValid","Can not show ".concat(e.campaignId," over other existing campaigns")),1))},p.hasCampaignClearedSelfDelay=function(e,t){var n=p.baseLogTag+".isValid",r=(0,u.getProp)(e,"delivery.fc_meta.delay",0);try{if(0<r&&null!=t){var a=t.lastImpression,i=((new Date).getTime()-a.getTime())/1e3;if(i<=(0,u.getProp)(e,"delivery.fc_meta.delay",0))return c.default.warn(1,n,"Can't render ".concat(e.campaignId," as it was rendered ").concat(i," seconds ago.")),!1}}catch(t){return c.default.error(1,n,"Can't check self delay for ".concat(e.campaignId),t),!1}return!0},p.hasCampaignClearedGlobalDelay=function(e,t,n){var r=p.baseLogTag+".isValid",a=(0,u.getProp)(e,"delivery.fc_meta.ignore_global_delay",!1);try{if(!a){var i=new Date;if(n){var o=(i.getTime()-n.getTime())/1e3;if(t&&o<=t)return c.default.log(1,r,"Can't render ".concat(e.campaignId," as last global campaign was rendered ").concat(o," seconds ago.")),!1}}}catch(e){return c.default.error(1,r,"Error checking global delay:",e),!1}return!0},p.comparator=function(e,t){return t.delivery.priority>e.delivery.priority||!(t.delivery.priority<e.delivery.priority)&&t.updatedTime>e.updatedTime?1:-1},p.baseLogTag="CampaignUtils",p);function p(){}function S(){}t.CampaignUtils=g,t.filterAndSortCampaigns=function(e){return a(void 0,void 0,void 0,(function(){var t,n,r,a;return i(this,(function(i){switch(i.label){case 0:t="filterAndSortCampaigns",n=e.map((function(e){return l.default.campaingsStatsStore.getItem(e.campaignId)})),r=[],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.all(n)];case 2:return r=i.sent(),[2,e.filter((function(e,t){return g.isValid(e,r[t])})).sort(g.comparator)];case 3:return a=i.sent(),c.default.error(1,t,"Error filtering and sorting campaigns: ",a),[2,[]];case 4:return[2]}}))}))},t.validateMessagingCampaigns=function(e,t){return a(void 0,void 0,void 0,(function(){var n,r,a,o,u,f;return i(this,(function(i){switch(i.label){case 0:return n="validateMessagingCampaigns",r=e.map((function(e){return l.default.campaingsStatsStore.getItem(e.campaignId)})),[4,l.default.serviceMetaStore.getItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.GLOBAL_DELAY)];case 1:return a=i.sent(),[4,l.default.serviceMetaStore.getItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_INAPP_SHOWN_TIME)];case 2:o=i.sent(),u=[],i.label=3;case 3:return i.trys.push([3,5,,6]),[4,Promise.all(r)];case 4:return u=i.sent(),[2,e.filter((function(e,n){return g.isValidMessagingCampaign(e,u[n],a,o,t)}))];case 5:return f=i.sent(),c.default.error(1,n,"Error vaildating messaging campaigns: ",f),[2,[]];case 6:return[2]}}))}))},S.REMOVE_TRAIL_CHARS=/[^\w\s]+$/gi,n=S,t.regex=n,t.dismissActiveOsm=function(){var e,t,n=window.Moengage;n.onsite.displayManager&&(n.onsite.triggerManager&&n.onsite.triggerManager.eventNameCampaignHash.MOE_PAGE_SCROLL&&(window.removeEventListener("scroll",n.onsite.triggerManager.getScrollListenerCallback()),n.onsite.triggerManager.setScrollListenerCallback(n.onsite.triggerManager.getWindowEventManager().onScroll(n.onsite.triggerManager.onScroll))),e=n.onsite.displayManager,t=Object.keys(e.campaignRenderMap),n.onsite.triggerManager.scrollCampaignTriggered=!1,t.forEach((function(t){document.getElementById("moe-onsite-campaign-".concat(t))&&document.getElementById("moe-onsite-campaign-".concat(t)).remove(),e.campaignRenderMap[t].isActive()&&e.dismissInapp(t),clearTimeout(e.campaignRenderMap[t].delayTimer),delete e.campaignRenderMap[t],e.campaignRenderOrder=e.campaignRenderOrder.filter((function(e){return e!==t}))})),(0,f.isMobile)()&&n.onsite.triggerManager.windowEventManager.isPopStateEventBound&&setTimeout((function(){n.onsite.triggerManager.windowEventManager.setHistoryState(),n.onsite.triggerManager.windowEventManager.isExitIntentShown=!1}),0))}},4126:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.MoeOnsite=void 0;var o=n(3358),s=n(5601),u=n(1481),l=n(8553),c=n(6513),f=n(8611),d=n(7408),g=n(2965),p=n(7676),S=n(9611),h=n(1151),E=n(1633);function T(e){this.initializationPomise=null,this.testDraftInfo=null,this.triggerManager=null,this.displayManager=null,this.globalDelay=0,this.onsiteSelfHandledTriggerListeners={},this.appId=e.appId,o.default.setLogLevel(e.debugLevel),this.config={host:s.INAPP_CONSTANTS.HOST_1},e.cluster===s.default.CLUSTERS.dc_2||e.cluster===s.default.DEPRECATED_CLUSTERS.dc_2?this.config.host=s.INAPP_CONSTANTS.HOST_2:e.cluster===s.default.CLUSTERS.dc_3||e.cluster===s.default.DEPRECATED_CLUSTERS.dc_3?this.config.host=s.INAPP_CONSTANTS.HOST_3:e.cluster===s.default.CLUSTERS.dc_4&&(this.config.host=s.INAPP_CONSTANTS.HOST_4),e.inapp&&e.inapp.host&&(this.config.host=e.inapp.host),this.OnsiteApiClient=new d.default(this.appId,this.config),this.iframeHelper=new c.default}T.prototype.setLogLevel=function(e){o.default.setLogLevel(e,!1)},T.prototype.initialize=function(){var e=this,t=T.baseLogTag+".initialize";return null==this.initializationPomise&&(this.initializationPomise=new Promise((function(n){return r(e,void 0,void 0,(function(){var e,i,l,c,f=this;return a(this,(function(d){switch(d.label){case 0:return d.trys.push([0,13,,14]),[4,h.default.initialize()];case 1:return d.sent(),[4,this.checkForTestCampaign()];case 2:return d.sent(),[4,this.syncCampaigns()];case 3:return d.sent(),[4,this.getCampaignsFromDB()];case 4:return e=d.sent(),(l=this.isExitIntentCampaignFound(e)).length?[4,this.prefetchExitIntentCampaigns(l)]:[3,6];case 5:d.sent(),d.label=6;case 6:if(i=e.filter((function(e){return null!=e.triggerData})),this.displayManager=new p.default,this.displayManager.onRender((function(e){o.default.log(1,t,"Campaign rendered: ".concat(e.campaignId)),h.default.serviceMetaStore.setItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_INAPP_SHOWN_TIME,new Date)})),null==this.testDraftInfo||this.testDraftInfo.draftType!==s.INAPP_CONSTANTS.DRAFT_CAMPAIGN_TPYES.ONSITE_MESSAGING)return[3,11];o.default.log(1,t,"Test campaigns present, will be showing only the test campaign."),o.default.log(1,t,"No live campaign will be shown till draft campaign expires from cookies (15 mins)"),d.label=7;case 7:return d.trys.push([7,9,,10]),o.default.log(1,t,"Trying to render draft campaign with id ".concat(this.testDraftInfo.draftId)),[4,this.OnsiteApiClient.getDraftCampaign(this.testDraftInfo)];case 8:return l=d.sent(),o.default.log(1,t,"Test campaign payload: ",l),this.displayManager.queueDraftCampaign(this.testDraftInfo,l),[3,10];case 9:return c=d.sent(),o.default.error(1,t,"Error fetching data for test campaign ".concat(this.testDraftInfo.draftId,": "),c),[3,10];case 10:return[3,12];case 11:this.triggerManager=new g.default(i),this.triggerManager.onTrigger((function(e,n){return r(f,void 0,void 0,(function(){var r,i;return a(this,(function(a){switch(a.label){case 0:return[4,(0,S.filterAndSortCampaigns)(n)];case 1:return n=a.sent(),o.default.log(1,t,"Triggered for: ",e.name,n),r=n.filter((function(e){return e.templateType===u.TEMPLATE_TYPE.SELF_HANDLED})),[4,(0,S.validateMessagingCampaigns)(n,this.displayManager.getActiveCampaigns())];case 2:return i=(i=a.sent()).filter((function(e){return e.templateType!==u.TEMPLATE_TYPE.SELF_HANDLED})),this.handlePersonalizationCampagins(r,e),i.length&&this.handleMessagingCampaigns(i,e),[2]}}))}))})),this.triggerManager.startWatching(),d.label=12;case 12:return n(!0),[3,14];case 13:return c=d.sent(),o.default.error(1,t,c),[3,14];case 14:return[2]}}))}))}))),this.initializationPomise},T.prototype.handleMessagingCampaigns=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,s;return a(this,(function(a){switch(a.label){case 0:n="".concat(T.baseLogTag,".handleMessagingCampaigns"),a.label=1;case 1:return a.trys.push([1,6,,7]),r=void 0,i=e[0],this.isExitIntentCampaign(i)?[4,this.isCampaignPrefetched(i)]:[3,3];case 2:r=a.sent(),a.label=3;case 3:return r?[3,5]:[4,this.OnsiteApiClient.getCampaignPayload(i,t)];case 4:r=a.sent(),a.label=5;case 5:return o.default.log(1,n,"Campaign triggered: ".concat(i.campaignId)),o.default.log(1,n,"Payload for campaign:",r),this.displayManager.queueLiveCampaign(i,r),[3,7];case 6:return s=a.sent(),o.default.error(1,n,"Error getting campaign data for messaging campaign",s),[3,7];case 7:return[2]}}))}))},T.prototype.handlePersonalizationCampagins=function(e,t){return r(this,void 0,void 0,(function(){var n,i,s,u=this;return a(this,(function(l){n="".concat(T.baseLogTag,".handlePersonalizationCampagins");try{o.default.log(1,n,"Going to Trigger: ",e),i={},s=[],e.forEach((function(e){null!=e.tag&&null!=u.onsiteSelfHandledTriggerListeners[e.tag]&&(s.indexOf(e.tag)<0&&s.push(e.tag),null==i[e.tag]&&(i[e.tag]=[]),i[e.tag].push(e))})),s.forEach((function(e){return r(u,void 0,void 0,(function(){var r,s,u,l,c=this;return a(this,(function(f){switch(f.label){case 0:if(f.trys.push([0,5,,6]),null==i[e])return[3,4];r=function(n){var r;return a(this,(function(a){switch(a.label){case 0:return[4,s.OnsiteApiClient.getCampaignPayload(i[e][n],t)];case 1:return r=a.sent(),s.onsiteSelfHandledTriggerListeners[e].forEach((function(t){c.handleSelfHandledCallback(i[e][n],r,t)})),[2,"break"]}}))},s=this,u=0,f.label=1;case 1:return u<i[e].length?[5,r(u)]:[3,4];case 2:if("break"===f.sent())return[3,4];f.label=3;case 3:return u++,[3,1];case 4:return[3,6];case 5:return l=f.sent(),o.default.error(1,n,"Error in triggered web personalization campaign: ",l),[3,6];case 6:return[2]}}))}))}))}catch(l){o.default.error(1,n,"Error handling trigger for self handled web personalization campaign: ",l)}return[2]}))}))},T.prototype.logout=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return e="".concat(T.baseLogTag,".logout"),o.default.log(1,e,"Starting module logout"),this.initializationPomise=null,this.displayManager&&(Object.keys(this.displayManager.campaignRenderMap).forEach((function(e){(e=document.getElementById("moe-onsite-campaign-".concat(e)))&&e.remove()})),this.displayManager.destroy()),this.triggerManager&&this.triggerManager.destory(),this.displayManager=null,[4,h.default.clear()];case 1:return t.sent(),o.default.log(1,e,"Starting module logout complete"),[2]}}))}))},T.prototype.getCampaignsFromDB=function(){var e=this;return new Promise((function(t){setTimeout((function(){return r(e,void 0,void 0,(function(){var e,n,r,o,s,u,l,c,f;return a(this,(function(a){switch(a.label){case 0:return[4,h.default.campaingsMetaStore.keys()];case 1:e=a.sent(),n=[],a.label=2;case 2:a.trys.push([2,7,8,9]),r=i(e),o=r.next(),a.label=3;case 3:return o.done?[3,6]:(s=o.value,l=(u=n).push,[4,this.getCampaignById(s)]);case 4:l.apply(u,[a.sent()]),a.label=5;case 5:return o=r.next(),[3,3];case 6:return[3,9];case 7:return c={error:c=a.sent()},[3,9];case 8:try{o&&!o.done&&(f=r.return)&&f.call(r)}finally{if(c)throw c.error}return[7];case 9:return t(n),[2]}}))}))}),0)}))},T.prototype.checkForTestCampaign=function(){return r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:e=T.baseLogTag+".checkForTestCampaign",n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.iframeHelper.getDraftCampaignInfo()];case 2:return null==(t=n.sent())?(o.default.log(1,e,"No draft campaign found"),this.testDraftInfo=null):(o.default.log(1,e,"Found draft campaign: ",t),this.testDraftInfo=t,null==this.testDraftInfo.draftId&&(this.testDraftInfo.draftType=s.INAPP_CONSTANTS.DRAFT_CAMPAIGN_TPYES.WEB_PERSONALIZATON)),[3,4];case 3:return t=n.sent(),o.default.error(1,e,"Error getting test campaign",t),[3,4];case 4:return[2]}}))}))},T.prototype.getCampaignById=function(e){return r(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:t=T.baseLogTag+".getCampaignById",r.label=1;case 1:return r.trys.push([1,3,,4]),[4,h.default.campaingsMetaStore.getItem(e)];case 2:return[2,r.sent()];case 3:return n=r.sent(),o.default.error(1,t,"Error getting campaign from stroe: ",n),[2,null];case 4:return[2]}}))}))},T.prototype.getData=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,u,l,c,f,d=this;return a(this,(function(a){switch(a.label){case 0:n="".concat(T.baseLogTag,".getData"),null==t&&(o.default.warn(1,n,"Moengage.onsite.getData called without a providing a callback."),t=function(){}),a.label=1;case 1:return a.trys.push([1,15,,16]),[4,this.initializationPomise];case 2:return a.sent(),null==this.testDraftInfo?[3,5]:(o.default.log(1,n,"Fetching test campaign: ",this.testDraftInfo),this.testDraftInfo.draftType!==s.INAPP_CONSTANTS.DRAFT_CAMPAIGN_TPYES.WEB_PERSONALIZATON?[3,4]:[4,this.OnsiteApiClient.getDraftCampaign(this.testDraftInfo)]);case 3:c=a.sent(),t(null,{payload:c.payload,click:function(){o.default.log(1,n,"This is a test campaign")},imp:function(){o.default.log(1,n,"This is a test campaign")}}),a.label=4;case 4:return[3,14];case 5:return[4,h.default.campaingsTagsStore.getItem(e)];case 6:return(r=a.sent())?[4,Promise.all(r.map((function(e){return d.getCampaignById(e)})))]:[3,13];case 7:return f=(f=a.sent()).filter((function(e){return null==e.triggerData})),[4,(0,S.filterAndSortCampaigns)(f)];case 8:i=a.sent(),o.default.log(1,n,"Eligible campaigns with tag ",e,"are",i),u=0,a.label=9;case 9:return u<i.length?(l=i[0],c=null,o.default.log(1,n,"Campaign with highest priority for tag",e,"is",l.campaignId),[4,this.OnsiteApiClient.getCampaignPayload(l)]):[3,12];case 10:return c=a.sent(),this.handleSelfHandledCallback(l,c,t),[3,12];case 11:return u++,[3,9];case 12:return[3,14];case 13:o.default.warn(1,n,"Could not find any eligible campaign for tag",e),t({message:"Could not find any eligible campaign for tag "+e},null),a.label=14;case 14:return[3,16];case 15:return f=a.sent(),o.default.error(1,n,"Error getting campaign",f),t({message:"There was an error fetching data for this tag"},null),[3,16];case 16:return[2]}}))}))},T.prototype.registerCallback=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return a(this,(function(a){switch(a.label){case 0:n="".concat(T.baseLogTag,".registerCallback"),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.initializationPomise];case 2:return a.sent(),null==this.onsiteSelfHandledTriggerListeners[e]?this.onsiteSelfHandledTriggerListeners[e]=[t]:this.onsiteSelfHandledTriggerListeners[e].push(t),[3,4];case 3:return r=a.sent(),o.default.error(1,n,"Error setting callback for tag",e),o.default.error(1,n,"Error stack:",r),[3,4];case 4:return[2]}}))}))},T.prototype.handleSelfHandledCallback=function(e,t,n){return r(this,void 0,void 0,(function(){var r,i,s;return a(this,(function(a){if(r="".concat(T.baseLogTag,".handleSelfHandledCallback"),e.campaignContext=t.campaignContext,"JSON"===t.payloadType)try{t.payload=JSON.parse(t.payload),i=(0,f.getProp)(e,"triggerData.trigger_delay.delayInSeconds",0)||0,setTimeout((function(){(0,S.sendDeliveredEvent)(e,"WP"),n(null,{payload:t.payload,click:function(t){(0,S.getClickTracker)(e,"WP",t)()},imp:(0,S.getImpressionTracker)(e,"WP")})}),1e3*i)}catch(a){s="Payload for campaign_id ".concat(e.campaignId," is not a valid JSON"),o.default.error(1,r,s),o.default.error(1,r,"Payload provided:",t.payload),n({message:s},null)}else(0,S.sendDeliveredEvent)(e,"WP"),n(null,{payload:t.payload,click:function(t){(0,S.getClickTracker)(e,"WP",t)()},imp:(0,S.getImpressionTracker)(e,"WP")});return[2]}))}))},T.prototype.syncCampaigns=function(){return r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:e=T.baseLogTag+".syncCampaigns",n.label=1;case 1:return n.trys.push([1,9,,10]),[4,this.shouldClearMetaStorage()];case 2:return n.sent()?[4,h.default.campaingsMetaStore.clear()]:[3,5];case 3:return n.sent(),[4,this.rebuildTagStore()];case 4:n.sent(),n.label=5;case 5:return[4,this.shouldSaveRemoteCampaigns()];case 6:return n.sent()?[4,this.saveRemoteCampaigns()]:[3,8];case 7:n.sent(),n.label=8;case 8:return[3,10];case 9:return t=n.sent(),o.default.error(1,e,"Error getting remote campaigns: ",t),[3,10];case 10:return[2]}}))}))},T.prototype.shouldClearMetaStorage=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,h.default.serviceMetaStore.getItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_FETCH_SDK_VERSION)];case 1:return[2,e.sent()!==(0,f.getMoeWindowVar)().getSdkVersion()]}}))}))},T.prototype.shouldSaveRemoteCampaigns=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return a(this,(function(a){switch(a.label){case 0:return e=T.baseLogTag+".shouldSaveRemoteCampaigns",[4,h.default.serviceMetaStore.getItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_FETCH_SDK_VERSION)];case 1:return t=a.sent(),[4,h.default.serviceMetaStore.getItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_META_CALL_TIME)];case 2:return r=a.sent(),n=(new Date).getTime(),null==r||n-r>s.INAPP_CONSTANTS.META_REFRESH_TIME?[2,!0]:(o.default.log(1,e,"Last fetch was less than 15 mins ago at ",r),t!==(0,f.getMoeWindowVar)().getSdkVersion()?(o.default.log(1,e,"Version change detected. Will proceed to fetch latest campaigns"),[2,!0]):[4,h.default.serviceMetaStore.getItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.UNIQUE_ID)]);case 3:return(n=a.sent())&&(r=l.default.get(s.default.PERSISTENT_STORAGE.USER_DATA).deviceUuid,n!==r)?(o.default.log(1,e,"Unique device id change detected. Will proceed to fetch latest campaigns"),[2,!0]):[2,!1]}}))}))},T.prototype.saveRemoteCampaigns=function(){return r(this,void 0,void 0,(function(){var e,t,n;return a(this,(function(r){switch(r.label){case 0:return e=T.baseLogTag+".saveRemoteCampaigns",[4,h.default.campaingsMetaStore.keys()];case 1:return t=r.sent()||[],[4,this.OnsiteApiClient.getCampaignsMeta(t)];case 2:return null==(n=r.sent())?[3,4]:[4,this.addCampaignsToDB(n.campaignsMeta)];case 3:r.sent(),o.default.log(1,e,"Inapp campaigns meta saved!"),r.label=4;case 4:return[4,h.default.serviceMetaStore.setItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.GLOBAL_DELAY,n.globalDelayBetweenInapps)];case 5:return r.sent(),[4,h.default.serviceMetaStore.setItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_FETCH_SDK_VERSION,(0,f.getMoeWindowVar)().getSdkVersion())];case 6:return r.sent(),[2]}}))}))},T.prototype.addCampaignsToDB=function(e){return r(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:t=T.baseLogTag+".addCampaignsToDB",o.default.log(1,t,"Adding/Updating ".concat(e.length," campaigns in DB"),e.map((function(e){return e.campaignId}))),r.label=1;case 1:return r.trys.push([1,4,,5]),[4,Promise.all(e.map((function(e){return h.default.campaingsMetaStore.setItem(e.campaignId,e)})))];case 2:return r.sent(),[4,this.rebuildTagStore()];case 3:return r.sent(),[3,5];case 4:return n=r.sent(),o.default.error(1,t,"Error saving remote campaigns:",n),[3,5];case 5:return[2]}}))}))},T.prototype.rebuildTagStore=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,s,u,l,c,f,d;return a(this,(function(a){switch(a.label){case 0:e=T.baseLogTag+".rebuildTagStore",a.label=1;case 1:return a.trys.push([1,6,,7]),[4,h.default.campaingsTagsStore.clear()];case 2:return a.sent(),[4,this.getCampaignsFromDB()];case 3:c=a.sent(),t={};try{for(n=i(c),r=n.next();!r.done;r=n.next())null!=(s=r.value).tag&&(null==t[s.tag]&&(t[s.tag]=[]),t[s.tag].push(s.campaignId))}catch(a){f={error:a}}finally{try{r&&!r.done&&(d=n.return)&&d.call(n)}finally{if(f)throw f.error}}return u=[],[4,h.default.campaingsTagsStore.clear()];case 4:for(l in a.sent(),t)t.hasOwnProperty(l)&&u.push(h.default.campaingsTagsStore.setItem(l,t[l]));return[4,Promise.all(u)];case 5:return a.sent(),[3,7];case 6:return c=a.sent(),o.default.error(1,e,"Error updating tags store:",c),[3,7];case 7:return[2]}}))}))},T.prototype.isExitIntentCampaignFound=function(e){var t=this;return e.filter((function(e){return e.templateType!==u.TEMPLATE_TYPE.SELF_HANDLED&&t.isExitIntentCampaign(e)}))},T.prototype.isExitIntentCampaign=function(e){return"MOE_PAGE_EXIT"===(0,f.getProp)(e,"triggerData.primary_condition.action_name",null)},T.prototype.prefetchExitIntentCampaigns=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,s;return a(this,(function(a){switch(a.label){case 0:return t=T.baseLogTag+".prefetchExitIntentCampaigns",[4,E.default.createEvent("MOE_EXIT",[])];case 1:return n=a.sent(),[4,(0,S.filterAndSortCampaigns)(e)];case 2:return(r=(r=a.sent()).filter((function(e){return u.default.getFilterResult(n,e)})))&&r.length?[4,this.isCampaignPrefetched(r[0])]:[3,6];case 3:return(s=a.sent())&&s.updatedTime.getTime()===r[0].updatedTime.getTime()?[2]:(i=r[0].campaignId,[4,this.OnsiteApiClient.getCampaignPayload(r[0])]);case 4:return(s=a.sent()).updatedTime=r[0].updatedTime,[4,h.default.exitIntentCampaignStore.setItem(i,s)];case 5:return a.sent(),o.default.log(1,t,"Exit intent campaign prefetched: ".concat(i)),[2];case 6:return o.default.log(1,t,"Exit intent campaign not eligible to prefetch"),[2,!1]}}))}))},T.prototype.isCampaignPrefetched=function(e){return r(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return t=T.baseLogTag+".isCampaignPrefetched",[4,h.default.exitIntentCampaignStore.getItem(e.campaignId)];case 1:return(n=r.sent())?(o.default.log(1,t,"Prefetched exit intent campaign found: ".concat(e.campaignId)),[2,n]):[2,!1]}}))}))},T.baseLogTag="MoeOnsite",n=T,t.MoeOnsite=n,window[s.SDK_MODULES.INAPP.windowLocation]=n},7676:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3358),s=n(1481),u=n(8611),l=n(1151),c=n(5601),f=n(9611),d=n(9434),g=n(2253);function p(){var e=this;this.renderListener=null,this.initializationPromiseObject=null,this.campaignRenderOrder=[],this.campaignRenderMap={},this.dismissTestInapp=function(t){e.initialInlineBodyStyle?document.body.setAttribute("style",e.initialInlineBodyStyle):document.body.removeAttribute("style"),e.moeInappPusher.style.height="0",setTimeout((function(){return document.getElementById("moe-onsite-campaign-".concat(t)).remove()}),0)},this.dismissInapp=function(t){var n;0!==e.getActiveCampaigns().length?(n=e.getActiveCampaigns(),setTimeout((function(){n.forEach((function(e){e.campaignMeta.campaignId===t&&e.iframe.remove()}))}),0),e.campaignRenderMap[t].setIsActive(!1),clearInterval(e.campaignRenderMap[t].dismissInterval),e.renderAllActiveCampaigns()):e.dismissTestInapp(t)},this.startInitialization(),this.initialInlineBodyStyle=document.body.getAttribute("style"),window.addEventListener("resize",(function(){e.renderAllActiveCampaigns()}))}p.prototype.startInitialization=function(){return r(this,void 0,void 0,(function(){var e,t,n;return a(this,(function(r){e="".concat(p.baseLogTag,".startInitialization");try{null==this.initializationPromiseObject&&(this.initializationPromiseObject=new u.PromiseObject),this.moeInappPusher=document.createElement("div"),this.moeInappPusher.style.setProperty("display","block","important"),this.moeInappPusher.style.height="0px","FRAMESET"===document.body.nodeName?(t=document.head).parentNode.insertBefore(this.moeInappPusher,t):(n=document.body.firstChild).parentNode.insertBefore(this.moeInappPusher,n),this.initializationPromiseObject.res()}catch(r){o.default.error(1,e,"Error initializing display managaer:",r)}return[2]}))}))},p.getIframeId=function(e){return"moe-onsite-campaign-".concat(e)},p.prototype.queueDraftCampaign=function(e,t){return r(this,void 0,void 0,(function(){var n,r,s,u=this;return a(this,(function(a){switch(a.label){case 0:n="".concat(p.baseLogTag,".queueDraftCampaign"),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.initializationPromiseObject.p];case 2:return a.sent(),e.position=t.position,this.testCampaign=e,r=p.createDefaultIframe(this.testCampaign.draftId,t.payload),o.default.warn(1,n,"Going to render test campaign ".concat(e.draftId)),(s="FRAMESET"===document.body.nodeName?this.moeInappPusher:document.body.firstChild).parentNode.insertBefore(r,s),r.onload=function(){var a,s,l,f,d,g;function p(e){return Array.prototype.slice.call(e)}r.contentWindow.postMessage({campaignId:e.draftId},"*");var S=p(r.contentDocument.getElementsByClassName(c.INAPP_CONSTANTS.CSS_SELECTORS.DISMISS_INAPP)),h=p(r.contentDocument.getElementsByClassName(c.INAPP_CONSTANTS.CSS_SELECTORS.CLICK_INAPP)),E=p(r.contentDocument.getElementsByTagName("a"));if(0===S.length&&o.default.warn(1,n,"No dismiss class items present in this template"),0===h.length&&o.default.warn(1,n,"No click class items present in this template"),-1<t.payload.indexOf("TEXT_INPUT")||-1<t.payload.indexOf('dynamic-listeners="true"'))r.contentDocument.body.addEventListener("click",(function(t){t.target&&t.target.classList.contains(c.INAPP_CONSTANTS.CSS_SELECTORS.CLICK_INAPP)&&o.default.log(1,n,"Clicked on test campaign element. No data will be sent to BE right now. We'll start sending the click events once the campaign is live"),t.target&&t.target.classList.contains(c.INAPP_CONSTANTS.CSS_SELECTORS.DISMISS_INAPP)&&u.dismissTestInapp(e.draftId)}));else{try{for(var T=i(h),m=T.next();!m.done;m=T.next())(y=m.value).addEventListener("click",(function(e){o.default.log(1,n,"Clicked on test campaign element. No data will be sent to BE right now. We'll start sending the click events once the campaign is live")}))}catch(s){a={error:s}}finally{try{m&&!m.done&&(s=T.return)&&s.call(T)}finally{if(a)throw a.error}}try{for(var _=i(S),v=_.next();!v.done;v=_.next())(y=v.value).addEventListener("click",(function(){u.dismissTestInapp(e.draftId)}))}catch(s){l={error:s}}finally{try{v&&!v.done&&(f=_.return)&&f.call(_)}finally{if(l)throw l.error}}}try{for(var y,A=i(E),I=A.next();!I.done;I=A.next())"_blank"!==(y=I.value).getAttribute("target")&&y.setAttribute("target","_parent")}catch(s){d={error:s}}finally{try{I&&!I.done&&(g=A.return)&&g.call(A)}finally{if(d)throw d.error}}u.renderTestCampaign(e,r)},[3,4];case 3:return s=a.sent(),o.default.error(1,n,"Error queueing draft campaign",s),[3,4];case 4:return[2]}}))}))},p.prototype.renderTestCampaign=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return a(this,(function(a){return t.style.display="block",t.style.zIndex="2147483647",e.displaySettings.config.blocking?(t.style.height="".concat(window.innerHeight,"px"),t.style.width="100%"):(t.style.height=getComputedStyle(t.contentDocument.body).height,t.style.width=getComputedStyle(t.contentDocument.body).width,e.templateType===s.TEMPLATE_TYPE.POP_UP&&(t.style.margin="0px auto"),-1<t.srcdoc.indexOf(c.INAPP_CONSTANTS.POSITIONED_TEMPLATE)&&(r=-1<t.srcdoc.indexOf(c.INAPP_CONSTANTS.SIDE_BANNER),this.adjustPositionOfCampaign(t.style,e.position,r))),e.templateType===s.TEMPLATE_TYPE.BANNER?e.displaySettings.config.sticky?t.style.position="fixed":t.style.position="absolute":e.templateType===s.TEMPLATE_TYPE.POP_UP&&(t.style.position="fixed",t.style.backgroundColor="rgba(99, 99, 99, 0.21)"),e.displaySettings.config.scrollable||(document.body.style.overflow="hidden"),e.templateType===s.TEMPLATE_TYPE.BANNER&&(n=parseInt(getComputedStyle(t.contentDocument.body).height),r=-1<t.srcdoc.indexOf(c.INAPP_CONSTANTS.POSITIONED_TEMPLATE),e.displaySettings.config.pushPage&&(r&&"TOP"===e.position||!r)&&(this.moeInappPusher.style.height=n.toString()+"px")),[2]}))}))},p.prototype.queueLiveCampaign=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return a(this,(function(a){switch(a.label){case 0:n="".concat(p.baseLogTag,".queueLiveCampaign"),e.campaignContext=t.campaignContext,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,this.initializationPromiseObject.p];case 2:return a.sent(),null!=this.campaignRenderMap[e.campaignId]?[3,5]:(this.campaignRenderOrder.push(e.campaignId),this.campaignRenderMap[e.campaignId]=new d.default(e,t),r=p.createDefaultIframe(e.campaignId,this.campaignRenderMap[e.campaignId].data.payload),this.campaignRenderMap[e.campaignId].iframe=r,[4,this.campaignRenderMap[e.campaignId].waitForDelay]);case 3:return a.sent(),[4,this.canCampaignBeRendered(e)];case 4:if(a.sent()){if(o.default.warn(1,n,"Going to render ".concat(e.campaignId)),this.campaignRenderMap[e.campaignId].setIsActive(!0),t.payload.code===c.INAPP_CONSTANTS.GCG_ERROR_CODE)return o.default.warn(1,n,"Can not render ".concat(e.campaignId," as it falls under Control Group.")),(0,f.getImpressionTracker)(e,"OSM",!0)(),[2];(0,f.getImpressionTracker)(e,"OSM")(),null!=this.renderListener&&this.renderListener(e),this.renderAllActiveCampaigns()}else o.default.warn(1,n,"Can not render ".concat(e.campaignId));return[3,6];case 5:o.default.warn(1,n,"Can not render ".concat(e.campaignId,", as it already being displayed or has been displayed once on this page already.")),a.label=6;case 6:return[3,8];case 7:return r=a.sent(),o.default.error(1,n,"Error queuing campaign ".concat(e.campaignId),r),[3,8];case 8:return[2]}}))}))},p.prototype.renderAllActiveCampaigns=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,l,d,g,h,E,T=this;return a(this,(function(m){switch(m.label){case 0:if(e="".concat(p.baseLogTag,".renderAllActiveCampaigns"),t=this.getActiveCampaigns(),this.restoreBodyStyle(),!(0<t.length))return[3,5];n=function(n){var l,d;return a(this,(function(a){switch(a.label){case 0:return null==document.getElementById(p.getIframeId(t[n].campaignMeta.campaignId))&&((l="FRAMESET"===document.body.nodeName?r.moeInappPusher:document.body.firstChild).parentNode.insertBefore(t[n].iframe,l),t[n].iframe.onload=function(){var r,a,s,u,l,d;function g(e){return Array.prototype.slice.call(e)}S.setScrollState(t),t[n].iframe.contentWindow.postMessage({campaignId:t[n].campaignMeta.campaignId},"*");var p=t[n].iframe,h=g(p.contentDocument.getElementsByClassName(c.INAPP_CONSTANTS.CSS_SELECTORS.DISMISS_INAPP)),E=g(p.contentDocument.getElementsByClassName(c.INAPP_CONSTANTS.CSS_SELECTORS.CLICK_INAPP)),m=g(p.contentDocument.getElementsByTagName("a"));if(0===h.length&&o.default.warn(1,e,"No dismiss class items present in this template"),0===E.length&&o.default.warn(1,e,"No click class items present in this template"),t[n].data.payload&&(-1<t[n].data.payload.indexOf("TEXT_INPUT")||-1<t[n].data.payload.indexOf('dynamic-listeners="true"')))p.contentDocument.body.addEventListener("click",(function(e){var r;e.target&&e.target.classList.contains(c.INAPP_CONSTANTS.CSS_SELECTORS.CLICK_INAPP)&&(r=e.target.dataset.id,(0,f.getClickTracker)(t[n].campaignMeta,"OSM",{widget_id:r})()),e.target&&e.target.classList.contains(c.INAPP_CONSTANTS.CSS_SELECTORS.DISMISS_INAPP)&&(T.dismissInapp(t[n].campaignMeta.campaignId),e.target.classList.contains(c.INAPP_CONSTANTS.CSS_SELECTORS.CLICK_INAPP)||(0,f.sendDismissEvent)(t[n].campaignMeta,"OSM"))}));else{try{for(var _=(r=void 0,i(E)),v=_.next();!v.done;v=_.next())(I=v.value).addEventListener("click",(function(e){e=e.target.dataset.id,(0,f.getClickTracker)(t[n].campaignMeta,"OSM",{widget_id:e})()}))}catch(a){r={error:a}}finally{try{v&&!v.done&&(a=_.return)&&a.call(_)}finally{if(r)throw r.error}}try{for(var y=(s=void 0,i(h)),A=y.next();!A.done;A=y.next())!function(e){e.addEventListener("click",(function(){T.dismissInapp(t[n].campaignMeta.campaignId),e.classList.contains(c.INAPP_CONSTANTS.CSS_SELECTORS.CLICK_INAPP)||(0,f.sendDismissEvent)(t[n].campaignMeta,"OSM")}))}(I=A.value)}catch(a){s={error:a}}finally{try{A&&!A.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}}try{for(var I,b=(l=void 0,i(m)),O=b.next();!O.done;O=b.next())"_blank"!==(I=O.value).getAttribute("target")&&I.setAttribute("target","_parent")}catch(a){l={error:a}}finally{try{O&&!O.done&&(d=b.return)&&d.call(b)}finally{if(l)throw l.error}}t[n].onFrameLoad.res()}),[4,t[n].onFrameLoad.p];case 1:return a.sent(),t[n].iframe.style.display="block",o.default.log(1,e,"zindex for ".concat(t[n].campaignMeta.campaignId),2147483647..toString()),t[n].iframe.style.zIndex=(2147483647-(t.length-n-1)).toString(),t[n].iframe.style.margin="0",t[n].campaignMeta.display.config.blocking?(t[n].iframe.style.height="".concat(window.innerHeight,"px"),t[n].iframe.style.width="100%"):(setTimeout((function(){t[n].iframe.style.height=getComputedStyle(t[n].iframe.contentDocument.body).height,t[n].iframe.style.padding.includes("10px")?t[n].iframe.style.width=parseInt(getComputedStyle(t[n].iframe.contentDocument.body).width)+20+"px":t[n].iframe.style.width=getComputedStyle(t[n].iframe.contentDocument.body).width}),0),t[n].campaignMeta.templateType===s.TEMPLATE_TYPE.POP_UP&&(t[n].iframe.style.margin="0px auto"),t[n].data.payload&&-1<t[n].data.payload.indexOf(c.INAPP_CONSTANTS.POSITIONED_TEMPLATE)&&(l=-1<t[n].data.payload.indexOf(c.INAPP_CONSTANTS.SIDE_BANNER),r.adjustPositionOfCampaign(t[n].iframe.style,t[n].data.position,l))),t[n].campaignMeta.templateType===s.TEMPLATE_TYPE.BANNER?t[n].campaignMeta.display.config.sticky?t[n].iframe.style.position="fixed":t[n].iframe.style.position="absolute":t[n].campaignMeta.templateType===s.TEMPLATE_TYPE.POP_UP&&(t[n].iframe.style.position="fixed",t[n].iframe.style.backgroundColor="rgba(99, 99, 99, 0.21)"),null==t[n].dismissInterval&&0<(d=1e3*(0,u.getProp)(t[n].campaignMeta,"delivery.dismiss_interval",0))&&(t[n].dismissInterval=setTimeout((function(){T.campaignRenderMap[t[n].campaignMeta.campaignId].isActive()&&(T.dismissInapp(t[n].campaignMeta.campaignId),(0,f.sendDismissEvent)(t[n].campaignMeta,"OSM",!0))}),d)),[2]}}))},r=this,g=0,m.label=1;case 1:return g<t.length?[5,n(g)]:[3,4];case 2:m.sent(),m.label=3;case 3:return g++,[3,1];case 4:for(l=t.filter((function(e){return e.campaignMeta.templateType===s.TEMPLATE_TYPE.BANNER})),d=0,g=l.length-1;0<=g;g--)h=parseInt(getComputedStyle(t[g].iframe.contentDocument.body).height),E=t[g].data.payload&&-1<t[g].data.payload.indexOf(c.INAPP_CONSTANTS.POSITIONED_TEMPLATE),t[g].campaignMeta.display.config.pushPage&&(E&&"TOP"===t[g].data.position||!E)&&(d+=h);this.moeInappPusher.style.height=d.toString()+"px",m.label=5;case 5:return[2]}}))}))},p.prototype.restoreBodyStyle=function(){var e=this;this.moeInappPusher.style.height="0px";var t=0;Object.keys(this.campaignRenderMap).forEach((function(n){e.campaignRenderMap[n].campaignMeta.templateType===s.TEMPLATE_TYPE.POP_UP&&e.campaignRenderMap[n].isActive()&&t++})),1<=t||(this.initialInlineBodyStyle?document.body.setAttribute("style",this.initialInlineBodyStyle):document.body.removeAttribute("style"))},p.prototype.canCampaignBeRendered=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i;return a(this,(function(a){switch(a.label){case 0:t="".concat(p.baseLogTag,".queueLiveCampaign"),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,l.default.campaingsStatsStore.getItem(e.campaignId)];case 2:return n=a.sent(),[4,l.default.serviceMetaStore.getItem(c.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.GLOBAL_DELAY)];case 3:return r=a.sent(),[4,l.default.serviceMetaStore.getItem(c.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_INAPP_SHOWN_TIME)];case 4:return i=a.sent(),[2,f.CampaignUtils.isValid(e,n)&&f.CampaignUtils.isValidMessagingCampaign(e,n,r,i,this.getActiveCampaigns())&&s.default.getURLFilterResult(e)];case 5:return i=a.sent(),o.default.error(1,t,"Error checking if campaign ".concat(e.campaignId," can be rendered:"),i),[3,6];case 6:return[2,!1]}}))}))},p.createDefaultIframe=function(e,t){"".concat(p.baseLogTag,".createDefaultIframe");var n=p.getIframeId(e);return(e=document.createElement("iframe")).setAttribute("id",n),e.style.left="0px",e.style.top="0px",e.style.bottom="0px",e.style.right="0px",e.style.border="0px none",e.style.height="100%",e.style.width=window.innerWidth.toString()+"px",e.style.padding="0",e.style.overflow="hidden",e.style.overflowY="hidden",e.style.zIndex="999999",e.style.display="none",e.style.position="fixed",e.setAttribute("srcdoc",t),e},p.prototype.onRender=function(e){this.renderListener=e},p.prototype.getActiveCampaigns=function(){var e=this;return this.campaignRenderOrder.map((function(t){return e.campaignRenderMap[t]})).filter((function(e){return e.isActive()}))},p.prototype.destroy=function(){this.getActiveCampaigns().forEach((function(e){e.setIsActive(!1)})),this.renderAllActiveCampaigns(),this.campaignRenderOrder=[],this.campaignRenderMap={}},p.prototype.adjustPositionOfCampaign=function(e,t,n){t&&(Object.assign(e,g.CAMPAIGN_POSITIONS[t]),(0,u.isMobile)()&&n&&this.addMarginInMweb(e,t))},p.prototype.addMarginInMweb=function(e,t){var n={paddingLeft:"10px",paddingRight:"10px",marginTop:"0",marginBottom:"0"};"TOP"===t&&(n.marginTop="10px"),"BOTTOM"===t&&(n.marginBottom="10px"),Object.assign(e,n)},p.baseLogTag="MessagingDisplayManager",n=p,t.default=n;var S=(h.setScrollState=function(e){for(var t=!0,n=0;n<e.length;n++)t=t&&e[n].campaignMeta.display.config.scrollable;t||(document.body.style.overflow="hidden")},h);function h(){}},2965:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1481),o=n(5601),s=n(8611),u=n(1633),l=n(3358),c=n(9611),f=n(2702),d=n(4039);function g(e){var t=this;this.eventNameCampaignHash={},this.messagingCampaigns=[],this.scrollCampaigns=[],this.scrollCampaignTriggered=!1,this.exitIntentCampaigns=[],this.exitCampaignTriggered=!1,this.listener=null,this.historyManager=window[o.WINDOW_OBJECTS.PageEventHistoryManager],this.onEvent=function(e){return r(t,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:t=g.baseLogTag+".onEvent",r.label=1;case 1:return r.trys.push([1,4,,5]),null==this.eventNameCampaignHash[e.name]?[3,3]:[4,(0,c.filterAndSortCampaigns)(this.eventNameCampaignHash[e.name])];case 2:n=(n=r.sent()).filter((function(t){return i.default.getFilterResult(e,t)})),l.default.log(1,t,"Campaigns triggered for event ".concat(e.name,": ").concat(n.length)),this.trigger(e,n),r.label=3;case 3:return[3,5];case 4:return n=r.sent(),l.default.error(1,t,"Error occurred during check event trigger campaigns: ",n),[3,5];case 5:return[2]}}))}))},this.onScroll=function(e){return r(t,void 0,void 0,(function(){var t,n,o=this;return a(this,(function(s){switch(s.label){case 0:t=g.baseLogTag+".onScroll",s.label=1;case 1:return s.trys.push([1,4,,5]),this.scrollCampaigns&&0<this.scrollCampaigns.length&&!this.scrollCampaignTriggered?[4,(0,c.filterAndSortCampaigns)(this.eventNameCampaignHash.MOE_PAGE_SCROLL)]:[3,3];case 2:s.sent().map((function(n){return r(o,void 0,void 0,(function(){var r;return a(this,(function(a){switch(a.label){case 0:return r=n.triggerData.primary_condition.attributes.filters[0],r=new d.default(r.name,r.value),[4,u.default.createEvent("MOE_PAGE_SCROLL",[r])];case 1:return r=a.sent(),i.default.getFilterResult(r,n)&&e>n.triggerData.primary_condition.attributes.filters[0].value&&!this.scrollCampaignTriggered&&(this.scrollCampaignTriggered=!0,window.removeEventListener("scroll",this.scrollListenerCallback),l.default.log(1,t,"Triggered Scroll campaign"),this.trigger(r,[n])),[2]}}))}))})),s.label=3;case 3:return[3,5];case 4:return n=s.sent(),l.default.error(1,t,"Error occurred in triggering scroll campaigns ",n),[3,5];case 5:return[2]}}))}))},this.onExit=function(e){return r(t,void 0,void 0,(function(){var t,n,r;return a(this,(function(a){switch(a.label){case 0:t=g.baseLogTag+".onExit",a.label=1;case 1:return a.trys.push([1,5,,6]),0<this.exitIntentCampaigns.length&&!this.exitCampaignTriggered?[4,u.default.createEvent("MOE_EXIT",[])]:[3,4];case 2:return n=a.sent(),[4,(0,c.filterAndSortCampaigns)(this.eventNameCampaignHash.MOE_PAGE_EXIT)];case 3:(r=(r=a.sent()).filter((function(e){return i.default.getFilterResult(n,e)}))).length?(l.default.log(1,t,"Triggered Exit Intent campaign: ",r),this.trigger(n,r)):("onBackClick"===e&&window.history.back(),l.default.log(1,t,"No Exit Intent campaign is eligible.")),a.label=4;case 4:return[3,6];case 5:return r=a.sent(),l.default.error(1,t,"Error occurred in triggering exit intent campaigns ",r),[3,6];case 6:return[2]}}))}))},this.messagingCampaigns=e,this.windowEventManager=new f.WindowEventManager}g.prototype.onTrigger=function(e){this.listener=e},g.prototype.startWatching=function(){return r(this,void 0,void 0,(function(){var e,t=this;return a(this,(function(n){switch(n.label){case 0:return e=this,[4,(0,c.filterAndSortCampaigns)(this.messagingCampaigns)];case 1:return e.messagingCampaigns=n.sent(),this.eventNameCampaignHash={},this.messagingCampaigns.forEach((function(e){var n=(0,s.getProp)(e,"triggerData.primary_condition.action_name",null);null!=n&&(null==t.eventNameCampaignHash[n]&&(t.eventNameCampaignHash[n]=[]),t.eventNameCampaignHash[n].push(e))})),this.historyManager&&(this.historyManager.getHistory().forEach(this.onEvent),this.historyManager.addEventListener(this.onEvent)),this.scrollCampaignTriggered=!1,this.scrollCampaigns=this.messagingCampaigns.filter((function(e){return"MOE_PAGE_SCROLL"===(0,s.getProp)(e,"triggerData.primary_condition.action_name",null)})),0<this.scrollCampaigns.length&&(this.scrollListenerCallback=this.windowEventManager.onScroll(this.onScroll)),this.exitCampaignTriggered=!1,this.exitIntentCampaigns=this.messagingCampaigns.filter((function(e){return"MOE_PAGE_EXIT"===(0,s.getProp)(e,"triggerData.primary_condition.action_name",null)})),0<this.exitIntentCampaigns.length&&this.windowEventManager.onExit(this.onExit),[2]}}))}))},g.prototype.setScrollListenerCallback=function(e){this.scrollListenerCallback=e},g.prototype.getScrollListenerCallback=function(){return this.scrollListenerCallback},g.prototype.getWindowEventManager=function(){return this.windowEventManager},g.prototype.trigger=function(e,t){null!=this.listener&&this.listener(e,t)},g.prototype.destory=function(){this.listener=null},g.baseLogTag="OnsiteTriggerManager",n=g,t.default=n},2702:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.WindowEventManager=void 0;var o=n(3358),s=n(8611),u=n(5601);function l(){this.isExitIntentShown=!1,this.isPopStateEventBound=!1}l.prototype.onScroll=function(e){var t=l.baseLogTag+".onScroll";null==e&&(e=function(){});var n=l.throttle((function(){o.default.log(1,t,"Scrolled percent:",l.getScrollPercent()),e(l.getScrollPercent())}),u.INAPP_CONSTANTS.SCROLL_CAMPAIGN_THROTTLING_TIME);return e(l.getScrollPercent()),window.addEventListener("scroll",n),n},l.prototype.onMobileTabChange=function(e){var t=this,n=l.baseLogTag+".onMobileTabChange";document.addEventListener("visibilitychange",(function(){t.isExitIntentShown||"hidden"!==document.visibilityState||(o.default.log(1,n,"TRIGGERED: MOBILE EXIT INTENT"),e(),t.isExitIntentShown=!0)}))},l.prototype.onMobileBackHit=function(e){var t=this,n=l.baseLogTag+".onMobileBackHit";setTimeout((function(){t.isPopStateEventBound=!0,window.addEventListener("popstate",(function(r){!t.isExitIntentShown&&r.state&&"exit_intent"===r.state.moeIntent&&(o.default.log(1,n,"TRIGGERED: MOBILE EXIT INTENT"),e("onBackClick"),t.isExitIntentShown=!0)}))}),1e3),this.setHistoryState()},l.prototype.setHistoryState=function(){window.history.state&&"no_intent"===window.history.state.moeIntent||(window.history.replaceState(r(r({},window.history.state),{moeIntent:"exit_intent"}),""),window.history.pushState(r(r({},window.history.state),{moeIntent:"no_intent"}),""))},l.prototype.onMobileScrollAndExit=function(e){var t=this,n=l.baseLogTag+".onMobileScrollAndExit",r=document.documentElement.offsetHeight,a=l.getScrollY(),i=null;0<r&&(i=window.setInterval((function(){var s=a-l.getScrollY();s<0&&(s=0,a=l.getScrollY()),l.getScrollPercent()>u.INAPP_CONSTANTS.EXIT_INTENT.CONFIG.SCROLL_DOWN_THRESHOLD&&s/r>u.INAPP_CONSTANTS.EXIT_INTENT.CONFIG.SCROLL_UP_THRESHOLD/100&&(clearInterval(i),i=null,t.isExitIntentShown||(o.default.log(1,n,"TRIGGERED: MOBILE EXIT INTENT"),e(),t.isExitIntentShown=!0))}),u.INAPP_CONSTANTS.EXIT_INTENT.CONFIG.SCROLL_INTERVAL))},l.prototype.mobileExitIntent=function(e){this.onMobileScrollAndExit(e),this.onMobileBackHit(e),this.onMobileTabChange(e)},l.prototype.onExit=function(e){var t=this,n=l.baseLogTag+".onExit";(0,s.isMobile)()?this.mobileExitIntent(e):document.addEventListener("mouseout",(function(r){return a(t,void 0,void 0,(function(){var t,a;return i(this,(function(i){return t=window.innerWidth,a=window.innerHeight,(r.clientY<0||r.clientX<0||r.clientY>=a||r.clientX>=t)&&(o.default.log(1,n,"TRIGGERED: EXIT INTENT"),e()),[2]}))}))}),!1)},l.getScrollPercent=function(){var e=window,t=(n=document).documentElement,n=n.getElementsByTagName("body")[0];return e=e.innerHeight||t.clientHeight||n.clientHeight,t=document.body,n=document.documentElement,e<(n=Math.max(t.scrollHeight,t.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight))?100*l.getScrollY()/(n-e):100},l.getScrollY=function(){var e=0;return"number"==typeof window.pageYOffset?e=window.pageYOffset:document.body&&document.body.scrollTop&&(e=document.body.scrollTop),e},l.throttle=function(e,t){var n;return function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];n=n||window.setTimeout((function(){n=null,e.apply(null,r)}),t)}},l.baseLogTag="WindowEventManager",n=l,t.WindowEventManager=n},6513:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1427),o=n(5601),s=n(7545),u=n(3358);function l(){}l.prototype.getIframe=function(){var e=this;return null==this.iFramePromise&&(this.iFramePromise=new Promise((function(t){var n=document.createElement("iframe");n.id="moengage-web-helper-frame",n.style.display="none",n.src=o.INAPP_CONSTANTS.WEB_HELPER_IFRAME_URL,document.body.appendChild(n),n.addEventListener("load",(function(){e.helper=new i.default(o.INAPP_CONSTANTS.IFRAME_CHANNEL,n),t(n)}))}))),this.iFramePromise},l.prototype.getDraftCampaignInfo=function(){return r(this,void 0,void 0,(function(){var e,t,n;return a(this,(function(r){switch(r.label){case 0:e="IframeHelper.getDraftCampaignInfo",r.label=1;case 1:return r.trys.push([1,4,,5]),u.default.log(1,e,"Loading helper frame"),[4,this.getIframe()];case 2:return r.sent(),u.default.log(1,e,"Helper frame loaded"),[4,this.helper.sendMessage(o.INAPP_CONSTANTS.IFRAME_TOPICS.COOKIE_STORAGE,{TYPE:"GET",KEY:o.INAPP_CONSTANTS.COOKIE_STORAGE.TEST_DRAFT_ID})];case 3:return n=r.sent(),u.default.log(1,e,"Data from iframe: ",n),t=n.message,u.default.log(1,e,"Raw test campaign",t),(n=null)!=t&&(s.default.isValidRawJson(t)?n=new s.default(t):u.default.error(1,e,"Data is not a valid test campaign")),[2,n];case 4:return r.sent(),[2,null];case 5:return[2]}}))}))},n=l,t.default=n},2253:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CAMPAIGN_POSITIONS=void 0,t.CAMPAIGN_POSITIONS={CENTER:{position:"absolute",top:"50%",left:"50%",bottom:"auto",right:"auto",transform:"translate(-50%, -50%)"},CENTER_LEFT:{position:"absolute",top:"50%",left:"10px",bottom:"auto",right:"auto",transform:"translate(0,-50%)"},CENTER_RIGHT:{position:"absolute",top:"50%",right:"10px",bottom:"auto",left:"auto",transform:"translate(0,-50%)"},TOP_LEFT:{position:"absolute",top:"10px",left:"10px",bottom:"auto",right:"auto"},TOP_CENTER:{position:"absolute",top:"0",left:"50%",bottom:"auto",right:"auto",transform:"translate(-50%, 0)"},TOP_RIGHT:{position:"absolute",top:"10px",right:"10px",bottom:"auto",left:"auto"},BOTTOM_LEFT:{position:"absolute",bottom:"10px",left:"10px",top:"auto",right:"auto"},BOTTOM_CENTER:{position:"absolute",left:"50%",bottom:"10px",top:"auto",right:"auto",transform:"translate(-50%, 0)"},BOTTOM_RIGHT:{position:"absolute",bottom:"10px",right:"10px",top:"auto",left:"auto"},TOP:{position:"absolute",top:"0",left:"50%",bottom:"auto",right:"auto",transform:"translate(-50%, 0)"},BOTTOM:{position:"absolute",bottom:"0",top:"auto",right:"auto",left:"50%",transform:"translate(-50%, 0)"},LEFT:{position:"absolute",left:"0",bottom:"auto",right:"auto",top:"auto"},RIGHT:{position:"absolute",right:"0",bottom:"auto",left:"auto",top:"auto"}}},9434:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8611);function a(e,t){var n=this;this.waitForDelay=null,this.iframe=null,this.onFrameLoad=new r.PromiseObject,this.active=!1,this.dismissInterval=null,this.isActive=function(){return n.active},this.campaignMeta=e,this.data=t;var a=(this.active=!1,r.getProp)(e,"triggerData.trigger_delay.delayInSeconds",0)||0;this.waitForDelay=new Promise((function(e){n.delayTimer=setTimeout((function(){e()}),1e3*a)}))}a.prototype.setIsActive=function(e){this.active=e},n=a,t.default=n},1151:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9483),o=n(5601),s=n(3358);function u(){}u.initialize=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){return null==u.ready&&(u.serviceMetaStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:o.INAPP_CONSTANTS.DATABASE_NAME,storeName:o.INAPP_CONSTANTS.STORES.SERVICE_META.NAME}),u.campaingsMetaStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:o.INAPP_CONSTANTS.DATABASE_NAME,storeName:o.INAPP_CONSTANTS.STORES.CAMPAIGNS_META.NAME}),u.campaingsTagsStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:o.INAPP_CONSTANTS.DATABASE_NAME,storeName:o.INAPP_CONSTANTS.STORES.CAMPAIGNS_TAGS.NAME}),u.campaingsStatsStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:o.INAPP_CONSTANTS.DATABASE_NAME,storeName:o.INAPP_CONSTANTS.STORES.CAMPAIGNS_STATS.NAME}),u.testCampaignStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:o.INAPP_CONSTANTS.DATABASE_NAME,storeName:o.INAPP_CONSTANTS.STORES.CAMPAIGNS_STATS.NAME}),u.exitIntentCampaignStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:o.INAPP_CONSTANTS.DATABASE_NAME,storeName:o.INAPP_CONSTANTS.STORES.EXIT_INTENT_CAMPAIGN_STORE.NAME}),e=[u.serviceMetaStore.ready(),u.campaingsMetaStore.ready(),u.campaingsTagsStore.ready(),u.campaingsStatsStore.ready(),u.testCampaignStore.ready(),u.exitIntentCampaignStore.ready()],u.ready=Promise.all(e)),[2,u.ready]}))}))},u.clear=function(){return r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:e=u.baseLogTag+".clear",n.label=1;case 1:return n.trys.push([1,4,,5]),[4,u.initialize()];case 2:return n.sent(),[4,Promise.all([u.serviceMetaStore.clear(),u.campaingsMetaStore.clear(),u.campaingsTagsStore.clear(),u.campaingsStatsStore.clear(),u.testCampaignStore.clear()])];case 3:return n.sent(),t=[u.serviceMetaStore.ready(),u.campaingsMetaStore.ready(),u.campaingsTagsStore.ready(),u.campaingsStatsStore.ready(),u.testCampaignStore.ready()],u.ready=Promise.all(t),[3,5];case 4:return t=n.sent(),s.default.error(1,e,"Error clearing onsite stores:",t),[3,5];case 5:return[2,u.ready]}}))}))},u.baseLogTag="MOE_ONSITE_STORES",n=u,t.default=n},7757:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerOperators=t.TriggerDataTypes=void 0;var r,a=n(9611);function i(e,t,n,r){this.dataType=e,this.availableOperations=t,this.event=n,this.filter=r}i.prototype.validate=function(){return!(this.availableOperations.indexOf(this.filter.operator)<0)},i.prototype.checkEq=function(){var e=this,t=!1;return this.event.attributes.forEach((function(n){var a=n.value,i=e.filter.value;e.dataType===r.STRING&&typeof a===r.STRING&&(a=e.removeSpecialChars(a),i=e.removeSpecialChars(i)),n.key===e.filter.name&&(e.dataType!==r.STRING||e.filter.case_sensitive?a===i&&(t=!0):a.toLowerCase()===i.toLowerCase()&&(t=!0))})),t},i.prototype.checkExists=function(){var e=this,t=!1;return this.event.attributes.forEach((function(n){n.key===e.filter.name&&(t=!0)})),t},i.prototype.removeSpecialChars=function(e){return e.replace(a.regex.REMOVE_TRAIL_CHARS,"")},n=i,t.default=n,(n=r=t.TriggerDataTypes||(t.TriggerDataTypes={})).BOOL="bool",n.STRING="string",n.DATE="datetime",n.NUMBER="double",n.LONG="long",(t=t.TriggerOperators||(t.TriggerOperators={})).EQ="is",t.LT="lessThan",t.GT="greaterThan",t.BETWEEN="between",t.IN="in",t.EXISTS="exists",t.CONTAINS="contains",t.STARTSWITH="startsWith",t.ENDSWITH="endsWith",t.INTHELAST="inTheLast",t.INTHENEXT="inTheNext",t.AFTER="after",t.BEFORE="before",t.ON="on",t.TODAY="today"},7850:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(7757),s=[o.TriggerOperators.EQ,o.TriggerOperators.EXISTS];function u(e,t){return i.call(this,o.TriggerDataTypes.BOOL,s,e,t)||this}a(u,i=o.default),u.prototype.evaluate=function(){var e=!1;switch(this.filter.operator){case o.TriggerOperators.EQ:e=this.checkEq();break;case o.TriggerOperators.EXISTS:e=this.checkExists()}return this.filter.negate?!e:e},u.baseLogTag="BooleanDataType",a=u,t.default=a},6575:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(7757),s=n(8611),u=n(5601),l=[o.TriggerOperators.EXISTS,o.TriggerOperators.ON,o.TriggerOperators.BETWEEN,o.TriggerOperators.BEFORE,o.TriggerOperators.AFTER,o.TriggerOperators.INTHELAST,o.TriggerOperators.INTHENEXT,o.TriggerOperators.TODAY];function c(e,t){return!s.validateDataType.isDate(t.value)&&s.validateDataType.isString(t.value)&&(t.value=new Date(t.value.split("Z").join(""))),!s.validateDataType.isDate(t.value2)&&s.validateDataType.isString(t.value2)&&null!=t.value2&&(t.value2=new Date(t.value2.split("Z").join(""))),!s.validateDataType.isDate(t.value1)&&s.validateDataType.isString(t.value1)&&null!=t.value1&&(t.value1=new Date(t.value1.split("Z").join(""))),i.call(this,o.TriggerDataTypes.DATE,l,e,t)||this}a(c,i=o.default),c.prototype.evaluate=function(){var e=this,t=!1,n=this.event.attributes.filter((function(t){return t.key===e.filter.name})),r=0<n.length?n[0]:null;if(null!=r)switch(r.value.setHours(0,0,0,0),this.filter.operator){case o.TriggerOperators.EQ:t=this.checkEq();break;case o.TriggerOperators.EXISTS:t=this.checkExists();break;case o.TriggerOperators.ON:t=this.checkOn(r);break;case o.TriggerOperators.BETWEEN:t=this.checkBetween(r);break;case o.TriggerOperators.BEFORE:t=this.checkBefore(r);break;case o.TriggerOperators.AFTER:t=this.checkAfter(r);break;case o.TriggerOperators.INTHELAST:t=this.checkLastX(r);break;case o.TriggerOperators.INTHENEXT:t=this.checkNextX(r);break;case o.TriggerOperators.TODAY:t=this.checkToday(r)}return this.filter.negate?!t:t},c.prototype.checkOn=function(e){return e.value.setHours(0,0,0,0)===this.filter.value.setHours(0,0,0,0)},c.prototype.checkBetween=function(e){return this.filter.value2?this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value2.getTime():this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value1.getTime()},c.prototype.checkBefore=function(e){var t=this.filter.value;return typeof t===u.DATA_TYPES.NUMBER?((new Date).setHours(0,0,0,0)-e.value.setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)<t.setHours(0,0,0,0)},c.prototype.checkAfter=function(e){var t=this.filter.value;return typeof t===u.DATA_TYPES.NUMBER?(e.value.setHours(0,0,0,0)-(new Date).setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)>t.setHours(0,0,0,0)},c.prototype.checkLastX=function(e){var t=(new Date).setHours(0,0,0,0);return 0<t-(e=e.value.setHours(0,0,0,0))&&(t-e)/864e5<=this.filter.value},c.prototype.checkNextX=function(e){var t=(new Date).setHours(0,0,0,0);return 0<(e=e.value.setHours(0,0,0,0))-t&&(e-t)/864e5<=this.filter.value},c.prototype.checkToday=function(e){return e.value.setHours(0,0,0,0)===(new Date).setHours(0,0,0,0)},c.baseLogTag="DateTimeDataType",a=c,t.default=a},5218:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(7757),s=[o.TriggerOperators.EQ,o.TriggerOperators.EXISTS,o.TriggerOperators.GT,o.TriggerOperators.LT,o.TriggerOperators.BETWEEN,o.TriggerOperators.IN];function u(e,t){return i.call(this,o.TriggerDataTypes.NUMBER,s,e,t)||this}a(u,i=o.default),u.prototype.evaluate=function(){var e=this,t=!1,n=this.event.attributes.filter((function(t){return t.key===e.filter.name})),r=0<n.length?n[0]:null;if(null!=r&&"number"==typeof r.value)switch(this.filter.operator){case o.TriggerOperators.EQ:t=this.checkEq();break;case o.TriggerOperators.EXISTS:t=this.checkExists();break;case o.TriggerOperators.GT:t=this.checkGreaterThan(r);break;case o.TriggerOperators.LT:t=this.checkLessThan(r);break;case o.TriggerOperators.BETWEEN:t=this.checkBetween(r);break;case o.TriggerOperators.IN:t=this.checkIn(r)}return this.filter.negate?!t:t},u.prototype.checkGreaterThan=function(e){return e.value>this.filter.value},u.prototype.checkLessThan=function(e){return e.value<this.filter.value},u.prototype.checkBetween=function(e){return this.filter.value2?this.filter.value&&this.filter.value2&&this.filter.value<=e.value&&e.value<this.filter.value2:this.filter.value&&this.filter.value1&&this.filter.value<=e.value&&e.value<this.filter.value1},u.prototype.checkIn=function(e){return Array.isArray(this.filter.value)&&0<=this.filter.value.indexOf(e.value)},u.baseLogTag="NumberDataType",a=u,t.default=a},4282:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(7757),s=n(8611),u=[o.TriggerOperators.EQ,o.TriggerOperators.EXISTS,o.TriggerOperators.CONTAINS,o.TriggerOperators.STARTSWITH,o.TriggerOperators.ENDSWITH,o.TriggerOperators.IN];function l(e,t){return i.call(this,o.TriggerDataTypes.STRING,u,e,t)||this}a(l,i=o.default),l.prototype.evaluate=function(){var e=this,t=!1,n=this.event.attributes.filter((function(t){return t.key===e.filter.name})),r=0<n.length?n[0]:null;if(null!=r&&s.validateDataType.isString(r.value))switch(this.filter.operator){case o.TriggerOperators.EQ:t=this.checkEq();break;case o.TriggerOperators.EXISTS:t=this.checkExists();break;case o.TriggerOperators.CONTAINS:t=this.checkContains(r);break;case o.TriggerOperators.STARTSWITH:t=this.checkStartsWith(r);break;case o.TriggerOperators.ENDSWITH:t=this.checkEndsWith(r);break;case o.TriggerOperators.IN:t=this.checkIn(r)}return this.filter.negate?!t:t},l.prototype.checkContains=function(e){return this.filter.case_sensitive?0<=e.value.indexOf(this.filter.value):0<=e.value.toLowerCase().indexOf(this.filter.value.toLowerCase())},l.prototype.checkStartsWith=function(e){function t(e,t){return e.substr(0,t.length)===t}return this.filter.case_sensitive?t(e.value,this.filter.value):t(e.value.toLowerCase(),this.filter.value.toLowerCase())},l.prototype.checkEndsWith=function(e){function t(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}if(this.filter.case_sensitive)return t(e.value,this.filter.value);var n=this.removeSpecialChars(e.value);return e=this.removeSpecialChars(this.filter.value),t(n.toLowerCase(),e.toLowerCase())},l.prototype.checkIn=function(e){var t=!1;if(Array.isArray(this.filter.value))for(var n=this.filter.value.length-1;0<=n;n--)if(this.filter.case_sensitive){if(this.filter.value[n]===e.value){t=!0;break}}else if(this.filter.value[n].toLowerCase()===e.value.toLowerCase()){t=!0;break}return t},l.baseLogTag="StringDataType",a=l,t.default=a},9339:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4282),a=n(7850),i=n(5218),o=n(6575),s=n(7757),u=n(1633),l=n(4039);function c(){}c.doesEventMatchFilters=function(e,t){var n=!1,u=null;switch(t.data_type){case s.TriggerDataTypes.BOOL:(u=new a.default(e,t)).validate()&&(n=u.evaluate());break;case s.TriggerDataTypes.STRING:(u=new r.default(e,t)).validate()&&(n=u.evaluate());break;case s.TriggerDataTypes.NUMBER:case s.TriggerDataTypes.LONG:(u=new i.default(e,t)).validate()&&(n=u.evaluate());break;case s.TriggerDataTypes.DATE:(u=new o.default(e,t)).validate()&&(n=u.evaluate())}return n},c.doesValueMatchFilter=function(e,t){return e=new l.default(t.name,e),e=new u.default("sample event",[e]),c.doesEventMatchFilters(e,t)},c.baseLogTag="TriggerEvaluator",n=c,t.default=n},1427:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8611),a=n(5877);function i(e,t){this.channel=e,this.target=t}i.prototype.sendMessage=function(e,t){var n=this;return new Promise((function(r,i){var o={id:(0,a.v4)(),channel:n.channel,topic:e,message:t};n.addToListener(o,r,i),n.target instanceof HTMLIFrameElement?n.target.contentWindow.postMessage(o,n.target.src):n.target.postMessage(o,"*")}))},i.listenToChannel=function(e,t,n){window.addEventListener("message",(function(r){r.data&&r.data.channel&&r.data.topic&&r.data.channel===e&&r.data.topic===t&&n(r.data,(function(n){n={id:r.data.id,channel:e,topic:t,message:n},r.source.postMessage(n,r.origin)}))}))},i.prototype.addToListener=function(e,t,n){var a=this;i.pendingPromises[e.id]={resolve:t,reject:n},window.addEventListener("message",(function(e){e.data&&(0,r.getProp)(e.data,"channel",null)===a.channel&&null!=i.pendingPromises[e.data.id]&&(i.pendingPromises[e.data.id].resolve(e.data),delete i.pendingPromises[e.data.id])}))},i.pendingPromises={},n=i,t.default=n},3571:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5601),a=n(8553);function i(){this.items=[]}i.enqueue=function(e,t){var n=i.getLocalStorageQName(e);e=new i,(e=a.default.get(n)?a.default.get(n):e).items.push(t),e.items=e.items.slice(Math.max(e.items.length-50,0)),a.default.set(n,e)},i.dequeue=function(e){var t=i.getLocalStorageQName(e),n=a.default.get(t);return e=null,n&&0<n.items.length&&(e=n.items[0],n.items.splice(0,1),a.default.set(t,n)),e},i.isEmpty=function(e){return e=i.getLocalStorageQName(e),!(a.default.get(e)&&0<a.default.get(e).items.length)},i.purge=function(e){var t=i.getLocalStorageQName(e);i.isEmpty(e)||a.default.remove(t)},i.getLocalStorageQName=function(e){return r.default.PERSISTENT_STORAGE.Q.PREFIX+"_"+e},n=i,t.default=n},3358:function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},a=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4622),o=n(5601),s="color: white; background: #41AE55; border-radius: 5px;",u="color: white; background: #48beab; border-radius: 5px;";function l(){}l.setLogLevel=function(e,t){var n=l.baseLogTag+".setLogLevel";null==i.default.get(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS)&&i.default.set(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,[]),null==e?l.logLevel=0:e in[0,1,2]?0<(l.logLevel=e)&&t&&l.releaseAllLogs():l.warn(0,n,"Value",e,"not supported for setDebugLevel(). Current log level is",l.logLevel,". Debug level can only be [0, 1, 2]")},l.log=function(e,t,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];e<=l.logLevel?console.log.apply(console,a(["%c "+l.logBrand+" %c %c info %c %c "+t+" ",s,"","color: white; background: #18a0bf; border-radius: 5px;","",u,n],r(i),!1)):l.cacheLog((function(){l.log.apply(l,a([e,t,n],r(i),!1))}))},l.error=function(e,t,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];e<=l.logLevel?console.error.apply(console,a(["%c "+l.logBrand+" %c %c error %c %c "+t+" ",s,"","color: white; background: #cc0a0a; border-radius: 5px;","",u,n],r(i),!1)):l.cacheLog((function(){l.error.apply(l,a([e,t,n],r(i),!1))}))},l.warn=function(e,t,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];e<=l.logLevel?console.warn.apply(console,a(["%c "+l.logBrand+" %c %c warn %c %c "+t+" ",s,"","color: white; background: #e8ab51; border-radius: 5px;","",u,n],r(i),!1)):l.cacheLog((function(){l.warn.apply(l,a([e,t,n],r(i),!1))}))},l.customLabel=function(e,t,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];e<=l.logLevel?console.log.apply(console,a(["%c "+l.logBrand+" %c %c "+t+" %c %c "+n+" %c ",s,"",u,"","color: white; background: #a400ff; border-radius: 5px;",""],r(i),!1)):l.cacheLog((function(){l.customLabel.apply(l,a([e,t,n],r(i),!1))}))},l.image=function(e,t){e<=l.logLevel?console.log("%c+","font-size: 1px; padding: 20px 80px; line-height: 45px; background: url("+t+"); background-size: 160px 90px; color: transparent;"):l.cacheLog((function(){l.image(e,t)}))},l.releaseAllLogs=function(){var e=i.default.get(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS),t=e.length,n=e;if(i.default.set(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,[]),0<t){l.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS BEGIN ----\x3e");for(var r=0;r<t;r++)n[r]();l.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS END ----\x3e")}},l.setLogBrand=function(e){l.logBrand=e},l.setBrandColor=function(e){s="color: white; background: "+e+"; border-radius: 5px;"},l.cacheLog=function(e){var t=i.default.get(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS);(t=null==t?[]:t).push(e),i.default.set(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,t)},l.baseLogTag="Logger",l.logBrand="MoEngage",l.logLevel=0,n=l,t.default=n},6756:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8611),a=(i.get=function(e,t){return i.makeNetworkCall(i.METHODS.GET,e,t)},i.post=function(e,t){return i.makeNetworkCall(i.METHODS.POST,e,t)},i.makeNetworkCall=function(e,t,n){return void 0===n&&(n={}),new Promise((function(a,o){var s=JSON.stringify((0,r.getProp)(n,"postData",null));t=i.constructFinalUrl(t,(0,r.getProp)(n,"queryParams",null));var u=new XMLHttpRequest;u.open(e,t,!0),i.addRequestHeaders(u,(0,r.getProp)(n,"headers",{})),u.onreadystatechange=function(){4===u.readyState&&200===u.status||4===u.readyState&&410===u.status?a({status:u.status,responseText:u.responseText}):4===u.readyState&&200!==u.status&&o({code:u.status,reason:u.responseText})},u.send(s)}))},i.addRequestHeaders=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n]);return e},i.constructFinalUrl=function(e,t){for(var n in e+="?",t)t.hasOwnProperty(n)&&null!=t[n]&&(e+=n+"="+encodeURIComponent(t[n])+"&");return e},i);function i(){}(n=(n=a=a||{}).METHODS||(n.METHODS={})).GET="GET",n.POST="POST",t.default=a},8611:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.isMigratedUser=t.debounce=t.deserializeQueryParams=t.convertDateToDateMonthYearFormat=t.deepCompareObjects=t.validateDataType=t.PromiseObject=t.getMoeWindowVar=t.asyncForEach=t.parseISOString=t.isMobile=t.getVapidPublicKey=t.isVapid=t.bufferToString=t.stringToBuffer=t.getCurrentProtocol=t.getProp=t.isObjectEmpty=void 0;var i=n(3358);t.isObjectEmpty=function(e){return 0===Object.keys(e).length&&e.constructor===Object},t.getProp=function e(t,n,r){return null==t?null:(t=t[(n=Array.isArray(n)?n:n.split("."))[0]])&&1<n.length?e(t,n.slice(1),r):void 0===t?r||null:t},t.getCurrentProtocol=function(){if(window)return"localhost"===window.location.hostname?"https":"http:"===window.location.protocol?"http":"https:"===window.location.protocol?"https":void 0},t.stringToBuffer=function(e){e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");for(var t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n},t.bufferToString=function(e){for(var t,n="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=new Uint8Array(e),i=a.byteLength,o=i-(e=i%3),s=0;s<o;s+=3)n+=r[(16515072&(t=a[s]<<16|a[s+1]<<8|a[s+2]))>>18]+r[(258048&t)>>12]+r[(4032&t)>>6]+r[63&t];return 1==e?n+=r[(252&(t=a[o]))>>2]+r[(3&t)<<4]+"==":2==e&&(n+=r[(64512&(t=a[o]<<8|a[1+o]))>>10]+r[(1008&t)>>4]+r[(15&t)<<2]+"="),n},t.isVapid=function(e,t){return t.isChrome()||t.isOpera()?"vapid"===e.chrome.subscriptionMode&&!!e.chrome.vapidPublicKey:!!t.isFirefox()&&"vapid"===e.firefox.subscriptionMode&&!!e.firefox.vapidPublicKey},t.getVapidPublicKey=function(e,t){return t.isChrome()||t.isOpera()?e.chrome.vapidPublicKey:t.isFirefox()?e.firefox.vapidPublicKey:""},t.isMobile=function(){var e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))},t.parseISOString=function(e){return new Date(Date.parse(e))},t.asyncForEach=function(e,t){return r(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:n=0,r.label=1;case 1:return n<e.length?[4,t(e[n],n,e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.getMoeWindowVar=function(){return window[window.moengage_object||"Moengage"]},t.PromiseObject=function(){var e=this;this.p=null,this.res=null,this.rej=null;try{this.p=new Promise((function(t,n){e.res=t,e.rej=n}))}catch(e){i.default.error(1,"Utils.PromiseObject","Promises not supported")}},t.validateDataType={isBoolean:function(e){return"boolean"==typeof e},isNumber:function(e){return"number"==typeof e},isString:function(e){return"string"==typeof e},isNumeric:function(e){return"number"==typeof e||"string"==typeof e&&Number(e).toString()===e},isDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)}},t.deepCompareObjects=function e(t,n){if(null==t||null==n)return t===n;if(t instanceof Function)return t===n;if(t instanceof RegExp)return t===n;if(t===n||t.valueOf()===n.valueOf())return!0;if(Array.isArray(t)&&t.length!==n.length)return!1;if(t instanceof Date)return!1;if(!(t instanceof Object))return!1;if(!(n instanceof Object))return!1;var r=Object.keys(t);return Object.keys(n).every((function(e){return-1!==r.indexOf(e)}))&&r.every((function(r){return e(t[r],n[r])}))},t.convertDateToDateMonthYearFormat=function(){var e=new Date;return"".concat(e.getDate(),":").concat(e.getMonth()+1,":").concat(e.getFullYear(),":").concat(e.getHours(),":").concat(e.getMinutes(),":").concat(e.getSeconds())},t.deserializeQueryParams=function(e){if(e){e=e.replace("?","").split("&");var t={};return e.forEach((function(e){e=(n=e.split("="))[0];var n=decodeURIComponent(n[1]||"");t[e]?"[object Array]"===Object.prototype.toString.call(t[e])?t[e].push(n):t[e]=[t[e],n]:t[e]=n})),JSON.parse(JSON.stringify(t))}return{}},t.debounce=function(e,t,n){var r=0;return function(){for(var a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];var o=this,s=n&&!r;clearTimeout(r),r=setTimeout((function(){r=null,n||e.apply(o,a)}),t),s&&e.apply(o,a)}},t.isMigratedUser=function(){return window.location.search.includes("moe_migration=true")}},8519:function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},a=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.initializeLaunchSequence=void 0;var i=n(5601),o=n(9483),s=n(85),u=n(3358),l=n(5511),c=n(7016),f=n(1879),d=n(8553),g=n(3546),p=n(464),S=n(2983),h=n(6801),E=n(7856),T=n(6679),m=n(4292),_=n(4340),v=n(1385),y=n(855),A=n(6708),I=n(1586),b=n(9611),O=function(){o.createInstance({driver:[o.INDEXEDDB,o.WEBSQL,o.LOCALSTORAGE],name:i.default.EVENTS.DATABASE_NAME,storeName:i.default.EVENTS.STORE_NAME}).clear()},N=function(){return new Promise((function(e){"complete"!==window.document.readyState?window.addEventListener("load",(function(){e(!0)})):e(!0)}))};window&&(window.moe=function(e){var n="Pre-Initialization";if(u.default.log(1,n,"Init data: ",e),"undefined"==typeof Promise)return u.default.error(1,n,"Promises not supported"),f.DummyMoengageObject;if(e.app_id||e.appId){var r=P();return r&&(e=Object.assign({},e,r)),h.default.save(e),N().then((function(){l.default.broadcastToWindow({topic:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.EVENT_NAMES.MOE_INIT,data:h.default.get()}),O(),u.default.setLogLevel(h.default.get().debugLevel),u.default.log(1,n,"Script loaded!"),u.default.customLabel(1,n,"SDK Version","2.8.27"),0<h.default.get().debugLevel&&(u.default.warn(1,n,"You are currently using MoEngage in debug environment. You'll find all the data captured in this environment in the TEST mode on the dashoard."),u.default.warn(1,n,"Please initialize with debugLevel as",0,"when using on your production environment.")),(0,t.initializeLaunchSequence)()})),e=window.moengage_object||"Moengage",window[e]=f.default,f.default}return u.default.error(1,n,"App Id not specified. Please check docs page to complete the integration - ",i.default.LINKS.WEBSDK_DOCS),f.DummyMoengageObject},window.moeBannerText="banner",window[i.WINDOW_OBJECTS.PageEventHistoryManager]=_.default);var P=function(){try{var e=localStorage.getItem(i.default.SEGMENT_CLUSTER),t=localStorage.getItem(i.default.SEGMENT_SW_PATH),n=localStorage.getItem(i.default.SEGMENT_SW_SCOPE),r={};return e&&(r.cluster=e),t&&(r.swPath=t),n&&(r.swScope=n),!!(e||t||n)&&(u.default.log(1,".isSegmentDataFound","Data found for segment initialisation",r),r)}catch(e){return!1}};t.initializeLaunchSequence=function(){var e="Initialization";return new Promise((function(t){c.default.getWebSDKSettings().then((function(n){n.isDomainLevelStorage&&(d.default.isSharedWithCookie=!0,d.default.copyKeysFromCookie()),"allowed"===n.s_e_b_e&&(v.default.initialize(),y.default.init(n)),p.default.get().then((function(r){if(m.default.get().deviceToLogout===r.deviceUuid)return u.default.log(1,e,"User was not able to logout last time. Completing the logout now and starting new session."),f.default.user.logout();r.deviceAdded&&c.default.onDeviceAdd.res(),n.isPushSubBilling&&u.default.warn(1,e,"You are under push subscriber based billing plan. We are only tracking users with an email, phone number or have subscribed to web push. All user attributes and events will be stored in a queue till we receive either of the properties.");var a=new I.default;(new A.default).onWindowVisibilityChange(a.handleBrowserInactivity),u.default.customLabel(1,e,"Device UUID",r.deviceUuid),u.default.customLabel(1,e,"Device Added",r.deviceAdded),l.default.broadcastToWindow({topic:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.EVENT_NAMES.SETTINGS_FETCHED,data:n}),n.isPushSubBilling||r.deviceAdded||c.default.deviceAdd(),f.default.track_page_view(),s.default.clear(i.default.PERSISTENT_STORAGE.Q.DEVICE),s.default.clear(i.default.PERSISTENT_STORAGE.Q.REPORT),h.default.get().enableSPA&&R(),g.default.getInstance().then((function(t){var r=new E.default(n,t);r.isWebPushEnabled()?0<=[S.OptInConfig.TYPE.ONE_CLICK,S.OptInConfig.TYPE.TWO_STEP].indexOf(n.optInConfig.type)?r.callWebPush():(u.default.log(1,e,"Self handled setting. Will show opt-in on manual invocation, if required."),r.getPermissionState().then((function(t){t===T.PERMISSION_STATE.GRANTED&&(u.default.log(1,e,"Notification permission already granted. Proceeding to subscribe the user"),r.callWebPush())})).catch((function(t){u.default.warn(1,e,"Cannot get permission state: ",t)}))):E.default.SUPPORTED_BROWSERS.indexOf(t.name)<0?u.default.warn(1,e,"Web push not supported on this browser. Supported browsers are:\n\t\t1. Google Chrome\n\t\t2. Mozilla Firefox\n\t\t3. Opera"):u.default.warn(1,e,"Web push feature not enabled for current environment"),h.default.get().disableOnsite?u.default.warn(1,e,"Onsite is disabled in this page since `disableOnsite: true` is passed during initialization."):c.default.onDeviceAdd.p.then((function(){(0,f.enableOnsiteApi)()})),w()})),t(!0)}))}))}))};var w=function(){var e="Moengage.clearWindowQ";N().then((function(){var t,n;try{var i=window.moengage_object||"Moengage";if(window[i]&&window.moengage_q){var o=window.moengage_q;if(window.moengage_q=[],o&&0<o.length&&window[i])for(var s=0;s<o.length;s++){u.default.log(1,e,"Method called before SDK downloaded:",[o[s].f],o[s].a);var l=o[s].f;"onsite.getData"===l?(t=f.default.onsite).getData.apply(t,a([],r(o[s].a),!1)):"onsite.registerCallback"===l?(n=f.default.onsite).registerCallback.apply(n,a([],r(o[s].a),!1)):null!=f.default[o[s].f]&&f.default[o[s].f].apply(null,o[s].a)}o=[]}}catch(t){u.default.error(1,e,t)}}))},R=function(){var e="startSpaUrlHandler",t=document.location.href;!function(){u.default.log(1,e,"Start listening to URL changes");var n=document.querySelector("body");new MutationObserver((function(n){n.forEach((function(n){t!==document.location.href&&(t=document.location.href,u.default.log(1,e,"URL Change detected",t),(0,b.dismissActiveOsm)(),f.default.track_page_view())}))})).observe(n,{childList:!0,subtree:!0})}()}},6708:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8611),a=n(4622);function i(){}i.prototype.onWindowVisibilityChange=function(e){a.default.set("isWindowActive",!0),document.addEventListener("focus",(function(){t(!0)}),!1),document.addEventListener("blur",(function(){t(!1)}),!1),window.addEventListener("focus",(function(){t(!0)}),!1),window.addEventListener("blur",(function(){"IFRAME"!==document.activeElement.tagName&&t(!1)}),!1);var t=function(e){return"boolean"==typeof e?n(e?"visible":"hidden"):document.hidden?n("hidden"):n("visible")},n=(0,r.debounce)((function(t){a.default.set("isWindowActive","visible"===t),e(t)}),250);window.addEventListener("visibilitychange",t,!1)},i.baseLogTag="WindowEventManager",n=i,t.default=n},855:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(7016),o=n(8032),s=n(3546),u=n(3358),l=n(8611),c=n(1050),f=n(5601);function d(){}d.spliceReports=function(e){return void 0===e&&(e=d.reports.length),this.reports.splice(0,e)},d.shouldCreateNewBatch=function(){return!d.lastbatchCreatedAt||(new Date).getTime()-d.lastbatchCreatedAt>=f.BATCH.CONFIG.TIME_BETWEEN_BATCHES},d.reactToTriggerEvents=function(){var e=d.baseLogTag+".reactToTriggerEvents";0<d.reports.length&&d.shouldCreateNewBatch()?(u.default.log(1,e,"Trigger Events: Created Batch of ".concat(d.reports.length," reports"),(0,l.convertDateToDateMonthYearFormat)()),d.createBatch()):u.default.log(2,e,"".concat((0,l.convertDateToDateMonthYearFormat)(),": No report's to sync for this event."))},d.periodicSync=function(e){var t=d.baseLogTag+".periodicSync";0<d.reports.length&&d.shouldCreateNewBatch()?(u.default.log(1,t,"Periodic sync: Created Batch of ".concat(d.reports.length," reports"),(0,l.convertDateToDateMonthYearFormat)()),d.createBatch()):u.default.log(2,t,"".concat((0,l.convertDateToDateMonthYearFormat)(),": No report's to sync at this interval. The next sync will attempt in ").concat(e," seconds"))},d.clearInterval=function(){clearInterval(d.periodicSyncInterval),d.lastbatchCreatedAt=null},d.init=function(e){s.default.getInstance().then((function(t){navigator.sendBeacon&&"allowed"===e.s_e_b_e&&t.name!==s.default.BROWSER_NAMES.SAFARI&&t.name!==s.default.BROWSER_NAMES.FIREFOX&&(d.periodicSyncInterval&&d.clearInterval(),0<d.reports.length&&(d.reports=[]),d.periodicSyncInterval=window.setInterval(d.periodicSync.bind(e.p_f_t),1e3*e.p_f_t),c.default.addListeners())}))},d.sendBatch=function(e){return r(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:t=d.baseLogTag+".sendBatch",r.label=1;case 1:return r.trys.push([1,3,,4]),[4,i.default.sendBatchOfReports(e).then((function(){d.lastbatchCreatedAt=(new Date).getTime()}))];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),u.default.error(1,t,"Error in sending batch",n),[3,4];case 4:return[2]}}))}))},d.createBatch=function(e){0<d.reports.length&&(e=d.spliceReports(e),d.sendBatch(e))},d.addReport=function(e,t){var n=d.baseLogTag+".addReport";e=new o.ReportView(e),d.reports.push(e),d.reports.length===t&&(u.default.log(1,n,"Created Batch of ".concat(t," reports"),(0,l.convertDateToDateMonthYearFormat)()),d.createBatch(t))},d.sendBeacon=function(){var e=d.baseLogTag+".sendBeacon";0<d.reports.length&&(i.default.sendBeacon(d.reports),u.default.log(1,e,"Window Unload: Created batch of ".concat(d.reports.length," reports"),(0,l.convertDateToDateMonthYearFormat)()))},d.flushReports=function(){return r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:e=d.baseLogTag+".flushReports",n.label=1;case 1:return n.trys.push([1,4,,5]),c.default.removeEventListeners(),0<d.reports.length?(u.default.log(1,e,"Flushed ".concat(d.reports.length," reports"),(0,l.convertDateToDateMonthYearFormat)()),[4,d.sendBatch(d.spliceReports())]):[3,3];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:return t=n.sent(),u.default.error(1,e,"Error in flushing reports",t),[3,5];case 5:return[2]}}))}))},d.baseLogTag="BatchManager",d.reports=[],d.lastbatchCreatedAt=null,n=d,t.default=n},1050:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(855);function a(){}a.visibilityChange=function(){"hidden"===document.visibilityState&&(a.windowClosed?r.default.sendBeacon():r.default.reactToTriggerEvents())},a.beforeUnload=function(){a.windowClosed=!0},a.removeEventListeners=function(){document.removeEventListener("visibilitychange",a.visibilityChange,!1),window.removeEventListener("beforeunload",a.beforeUnload,!1)},a.addListeners=function(){document.addEventListener("visibilitychange",a.visibilityChange,!1),window.addEventListener("beforeunload",a.beforeUnload,!1)},a.windowClosed=!1,n=a,t.default=n},2651:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(r.addCallback=function(e,t){null!=e&&null!=t&&(null==r.callbacks[e]&&(r.callbacks[e]=[]),r.callbacks[e].push(t))},r.getCallbacks=function(e){return r.callbacks[e]||[]},r.runCallbacks=function(e){r.getCallbacks(e).forEach((function(e){e()}))},r.callbacks={},r);function r(){}t.default=n},6679:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PERMISSION_STATE=void 0,(t=t.PERMISSION_STATE||(t.PERMISSION_STATE={})).PROMPT="prompt",t.GRANTED="granted",t.DENIED="denied",t.DISMISSED="dismissed"},2266:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5601),a=n(3072),i=n(1427),o=n(8553),s=n(6679),u=n(6801);function l(e){var t=this;this.sdkSettings=e,this.getIframe(),i.default.listenToChannel(r.default.HTML_COMM.CHANNEL.SUBD,r.default.HTML_COMM.TOPICS.CONFIG,(function(e,n){n(t.sdkSettings)}))}l.prototype.showHardAsk=function(){var e=this;return new Promise((function(t,n){e.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.EPHEMERAL_STORAGE,{requestType:"set",key:r.default.EPHEMERAL_STORAGE.INIT_DATA,value:u.default.get()}).then((function(a){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:r.default.PERSISTENT_STORAGE.INIT_DATA,value:u.default.get()}).then((function(a){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"get",key:r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}).then((function(a){null!=a.message?e.isTokenValid().then((function(i){var o;i?t({state:s.PERMISSION_STATE.GRANTED,subscriptionDetails:a.message}):(o=n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}),i=e.removeToken(),Promise.all([o,i]).then((function(){e.openNewTabForPermission(n).then((function(e){t(e)}))})))})):e.openNewTabForPermission(n).then((function(e){t(e)}))}))}))}))}))}))},l.prototype.openNewTabForPermission=function(e){var t=this;return new Promise((function(n){e.sendMessage(r.default.HTML_COMM.TOPICS.CONFIG,t.sdkSettings).then((function(e){i.default.listenToChannel(r.default.HTML_COMM.CHANNEL.SUBD,r.default.HTML_COMM.TOPICS.HARD_ASK_RESULT,(function(e,t){t("Ok"),e=e.message,n(e)})),window.open(t.sdkSettings.platformSettings.chrome.subdomainURL+"?startSubscription=true","_blank","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=400,height=400")}))}))},l.prototype.getCurrentPermissionState=function(){var e=this;return new Promise((function(t,n){e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERMISSION_STATE,{requestType:"get"}).then((function(e){t(e.message)}))}))}))},l.prototype.getPushTokenDetails=function(){var e=this;return new Promise((function(t){e.getOrSetInSubDomainStorage(r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS).then((function(e){t(e)}))}))},l.prototype.setInSubDomainStorage=function(e,t){var n=this;return new Promise((function(a){n.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:e,value:t}).then((function(e){a(!0)}))}))}))},l.prototype.logout=function(){var e=this;return new Promise((function(t){e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"logout"}).then((function(e){t(!0)}))}))}))},l.prototype.getInSubdomain=function(e){var t=this;return new Promise((function(n){t.getIframeCommunicator().then((function(t){t.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"get",key:e}).then((function(e){null==e.message?n(null):n(e.message)})).catch((function(e){n(null)}))})).catch((function(e){n(null)}))}))},l.prototype.setInSubdomain=function(e,t){var n=this;return new Promise((function(a,i){n.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:e,value:t}).then((function(e){a(!0)})).catch((function(e){i(e)}))})).catch((function(e){i(e)}))}))},l.prototype.getOrSetInSubDomainStorage=function(e,t){var n=this;return new Promise((function(r){n.getInSubdomain(e).then((function(a){null==a?n.setInSubdomain(e,t).then((function(){r(t)})).catch((function(e){r(t)})):r(a)}))}))},l.prototype.isTokenValid=function(){var e=this;return new Promise((function(t){e.getPushTokenDetails().then((function(n){n&&n.token?a.default.isTokenValid(n.token,e.sdkSettings.platformSettings.chrome.apiKey).then((function(n){n?t(n):e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}).then((function(){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS}).then((function(){t(n)}))}))}))})):t(!1)}))}))},l.prototype.removeToken=function(){var e=this;return new Promise((function(t){o.default.remove(r.default.PERSISTENT_STORAGE.PUSH_TOKEN),e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.PUSH_TOKEN}).then((function(e){t(!0)}))}))}))},l.prototype.getIframeCommunicator=function(){var e=this;return new Promise((function(t){l.iframeCommunicator?t(l.iframeCommunicator):e.getIframe().then((function(e){l.iframeCommunicator=new i.default(r.default.HTML_COMM.CHANNEL.MAIN,e),t(l.iframeCommunicator)}))}))},l.prototype.getIframe=function(){var e=this;return new Promise((function(t,n){var r;null==l.iframe?((r=document.createElement("iframe")).id="moengage-subd-iframe",r.style.display="none",r.src=e.sdkSettings.platformSettings.chrome.subdomainURL,document.body.appendChild(r),(l.iframe=r).addEventListener("load",(function(){l.iframeLoaded=!0,t(r)}))):l.iframeLoaded?t(l.iframe):setTimeout((function(){e.getIframe().then((function(e){t(e)}))}),500)}))},l.prototype.showNotification=function(e){var t=this;this.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.SHOW_NOTIF,{notification:e,config:t.sdkSettings})}))},l.baseLogTag="ChromeHTTPNotificationManager",l.iframeLoaded=!1,n=l,t.default=n},1376:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3072),a=n(5601),i=n(3358),o=n(3546),s=n(2983),u=n(8553),l=n(6679),c=n(6801),f=n(7016),d=n(8611),g=n(9483);function p(e){var t=this;this.swRegisterPromise=null,this.swActiveRetries=1;var n=p.baseLogTag+".constructor";this.sdkSettings=e,this.registerServiceWorker().then((function(e){t.sendDataToServiceWorker()})).catch((function(e){i.default.error(1,n,"Error registering serviceworker:",e)}))}p.prototype.showHardAsk=function(){var e=this,t=p.baseLogTag+".showHardAsk";return new Promise((function(n,r){p.isWebPushSupported().then((function(o){o?e.getCurrentPermissionState().then((function(o){e.registerServiceWorker().then((function(s){o!==l.PERMISSION_STATE.DENIED?(i.default.log(1,t,"Attempting to open hard ask"),e.showOverlay(),e.askPermission().then((function(r){e.hideOverlay(),i.default.log(2,t,"Permission state after hard ask:",r),r===l.PERMISSION_STATE.GRANTED?e.getPushTokenDetails().then((function(t){e.sendDataToServiceWorker(t.token),n({state:r,subscriptionDetails:t})})):(e.sendDataToServiceWorker(),n({state:r,subscriptionDetails:null}))})).catch((function(e){i.default.error(1,t,e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)}))):(i.default.log(1,t,"Hard ask not shown as permission state is",o),n({state:o,subscriptionDetails:null}))})).catch((function(e){i.default.error(1,t,"Error registering serviceworker:",e),r(e)}))})).catch((function(e){i.default.error(1,t,"Registering service worker failed:",e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)})):(i.default.warn(1,t,"Web push not supported in current browser environment"),r(a.default.ERRORS.WEB_PUSH_NOT_SUPPORTED))}))}))},p.prototype.sendDataToServiceWorker=function(e){var t=this;return new Promise((function(n){f.default.collectGetParams().then((function(n){e&&(n.push_id=e||u.default.get(a.default.PERSISTENT_STORAGE.PUSH_TOKEN)||void 0),n.isBatchingEnabled=u.default.get(a.default.PERSISTENT_STORAGE.WEB_SETTINGS).s_e_b_e;var r,i=c.default.get().swPath;i&&i.includes("tools/moengage")?(r=g.createInstance({driver:[g.INDEXEDDB],name:"moe_database",storeName:"moe_data"})).ready().then((function(){r.setItem("reportParams",{data:n})})):navigator.serviceWorker.ready.then((function(){t.sendDataToServiceWorkerOnControllerReady(n)}))}))}))},p.prototype.sendDataToServiceWorkerOnControllerReady=function(e){var t=this;navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({data:e}):this.swActiveRetries<3&&setTimeout((function(){t.swActiveRetries++,t.sendDataToServiceWorkerOnControllerReady(e)}),500)},p.prototype.getCurrentPermissionState=function(){return navigator.permissions?navigator.permissions.query({name:"notifications"}).then((function(e){return p.parsePermissionState(e.state)})).catch((function(e){})):new Promise((function(e){e(p.parsePermissionState(Notification.permission))}))},p.prototype.getPushTokenDetails=function(){var e=this,t=p.baseLogTag+".getPushTokenDetails";return new Promise((function(n,r){e.getCurrentPermissionState().then((function(r){r!==l.PERMISSION_STATE.GRANTED?n({token:null,raw:null}):o.default.getInstance().then((function(r){e.registerServiceWorker().then((function(a){var o=null,s={userVisibleOnly:!0};function u(){a.pushManager.subscribe(s).then((function(e){!function(e){var t=e.toJSON(),r=e.endpoint.substring(0,t.endpoint.lastIndexOf("/")+1),a=t.expirationTime,i=(e=t.endpoint.split("/")[t.endpoint.split("/").length-1],{});if(t.keys)for(var o in t.keys)t.keys.hasOwnProperty(o)&&(i[o]=t.keys[o]);n({token:e,endpoint:r,keys:i,expirationTime:a,raw:t})}(e)})).catch((function(e){i.default.error(1,t,"Error in subscribtion: ",e),n({token:null,raw:null})}))}(0,d.isVapid)(e.sdkSettings.platformSettings,r)&&(o=(0,d.getVapidPublicKey)(e.sdkSettings.platformSettings,r),s.applicationServerKey=(0,d.stringToBuffer)(o)),a.pushManager.getSubscription().then((function(t){var n;t&&"vapid"===e.sdkSettings.platformSettings.chrome.subscriptionMode&&t.options&&t.options.applicationServerKey?(n=(0,d.bufferToString)(t.options.applicationServerKey),[o,o+"=",o+"==",(0,d.bufferToString)((0,d.stringToBuffer)(o))].indexOf(n)<0?t.unsubscribe().then((function(){u()})):u()):u()}))})).catch((function(e){i.default.error(1,t,"Error in getting push token: ",e),n({token:null,raw:null})}))}))}))}))},p.prototype.isTokenValid=function(){var e=this;return this.getPushTokenDetails().then((function(t){return r.default.isTokenValid(t.token,e.sdkSettings.platformSettings.chrome.apiKey)}))},p.prototype.removeToken=function(){return u.default.remove(a.default.PERSISTENT_STORAGE.PUSH_TOKEN),Promise.resolve()},p.prototype.askPermission=function(){return new Promise((function(e,t){Notification.requestPermission().then((function(t){e(p.parsePermissionState(t))})).catch((function(e){t(a.default.ERRORS.PERMISSION_DISMISSED_TOO_MANY_TIMES)}))}))},p.prototype.registerServiceWorker=function(){var e=this,t=p.baseLogTag+".registerServiceWorker";return null!=this.swRegisterPromise||(this.swRegisterPromise=new Promise((function(n,r){var o,u,l;p.registeredServiceWorker?n(p.registeredServiceWorker):"serviceWorker"in navigator?(o=void 0,u=!1,u=c.default.get()&&null!=c.default.get().swPath?(o=c.default.get().swPath,!0):(o=e.sdkSettings.platformSettings.chrome.serviceWorkerFilename,!1),(o="/"===o[0]||o.startsWith("http")?o:"/"+o).includes("tools/moengage")?(i.default.log(1,t,"Removing scope in case of shopify."),s.default.isFeatureEnabled(e.sdkSettings,a.default.SDK_FEATURES.WEB_PUSH)?navigator.serviceWorker.register(o).then((function(e){i.default.log(2,t,"Serviceworker registered"),navigator.serviceWorker.getRegistrations().then((function(e){e.forEach((function(e){e.active&&e.active.scriptURL.match(/moengage/)&&(i.default.log(2,t,"Serviceworker ready"),p.registeredServiceWorker=e,c.default.get()&&c.default.get().forceSwUpdate&&e.update(),n(e))}))})).catch((function(e){i.default.error(1,t,"Service worker register failed:",e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)}))})).catch((function(e){i.default.error(1,t,"Service worker register failed:",e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)})):i.default.log(1,t,"Not registering serviceworker as web push is not enabled in current environment")):(l="/",c.default.get()&&null!=c.default.get().swScope?l=c.default.get().swScope:e.sdkSettings.platformSettings.chrome.isServiceWorkerRoot?u&&(i.default.log(1,t,"Using user defined path to serviceworker:",o),l=o.substr(0,o.lastIndexOf("/")+1),p.canSwBeRegisteredWithScope(l)||(i.default.error(1,t,"Service worker can only be registered from same directory or child directory."),r(a.default.ERRORS.SERVICE_WORKER_NOT_IN_CORRECT_SCOPE))):l=(u=window.location.pathname).substring(0,u.lastIndexOf("/")+1),i.default.log(1,t,"Scope for serviceworker:",l),s.default.isFeatureEnabled(e.sdkSettings,a.default.SDK_FEATURES.WEB_PUSH)?navigator.serviceWorker.register(o,{scope:l}).then((function(e){i.default.log(2,t,"Serviceworker registered"),navigator.serviceWorker.ready.then((function(e){i.default.log(2,t,"Serviceworker ready"),p.registeredServiceWorker=e,c.default.get()&&c.default.get().forceSwUpdate&&e.update(),n(e)})).catch((function(e){i.default.error(1,t,"Service worker register failed:",e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)}))})).catch((function(e){i.default.error(1,t,"Service worker register failed:",e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)})):i.default.log(1,t,"Not registering serviceworker as web push is not enabled in current environment"))):(i.default.error(1,t,"Service worker not supported"),r("Service worker not supported"))}))),this.swRegisterPromise},p.canSwBeRegisteredWithScope=function(e){var t=window.location.pathname;return e=e,!((t=t).indexOf(e)<0)&&0<=t.substring(t.indexOf(e)).length},p.isWebPushSupported=function(){return new Promise((function(e){o.default.getInstance().then((function(t){!t.isIncognito&&"serviceWorker"in navigator&&"PushManager"in window&&t.isChromeLike()?e(!0):e(!1)}))}))},p.parsePermissionState=function(e){return"prompt"===e?l.PERMISSION_STATE.PROMPT:"granted"===e?l.PERMISSION_STATE.GRANTED:"denied"===e?l.PERMISSION_STATE.DENIED:"default"===e?l.PERMISSION_STATE.DISMISSED:null},p.prototype.showNotification=function(e){var t=p.baseLogTag+".showNotification";this.registerServiceWorker().then((function(n){e?e.title?e.body?(null==e.requireInteraction&&(e.requireInteraction=!0),n.showNotification(e.title,e)):i.default.error(1,t,"Notification body can not be blank"):i.default.error(1,t,"Notification title can not be blank"):i.default.error(1,t,"Notification object can not be blank")})).catch((function(e){i.default.error(1,t,"Error registering serviceworker:",e)}))},p.prototype.showOverlay=function(){var e,t=this;this.sdkSettings.optInConfig.showOverlay&&((e=document.createElement("div")).id="moe-push-div",e.style.display="none",e.className="moe-push-class",o.default.getInstance().then((function(n){n.isMobile?e.innerHTML=t.sdkSettings.optInConfig.softAskConfig.mobile.customHTML:e.innerHTML=t.sdkSettings.optInConfig.softAskConfig.desktop.customHTML;var r,a=document.body.firstChild;if(a.parentNode.insertBefore(e,a),(n=n.name)===o.default.BROWSER_NAMES.CHROME||n===o.default.BROWSER_NAMES.OPERA_NEON?r=document.getElementsByClassName("moe_chrome"):n===o.default.BROWSER_NAMES.FIREFOX?r=document.getElementsByClassName("moe_firefox"):n!==o.default.BROWSER_NAMES.OPERA&&n!==o.default.BROWSER_NAMES.SAFARI||(r=document.getElementsByClassName("moe_opera")),0===r.length)document.getElementById("moe-push-div").style.display="none";else for(var i=r.length-1;0<=i;i--)r[i].style.display="block";t.overlayTimer=window.setTimeout((function(){""===e.style.opacity&&(e.style.display="block")}),1500),e.onclick=function(){t.hideOverlay()}})))},p.prototype.hideOverlay=function(){clearTimeout(this.overlayTimer);var e=document.getElementById("moe-push-div");null!=e&&(e.style.visibility="none",e.style.opacity="0",e.parentNode.removeChild(e))},p.baseLogTag="HTTPS-NotificationManager",n=p,t.default=n},9417:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5601),a=n(3358),i=n(8611),o=n(5511),s=n(3546),u=n(2983),l=n(8553),c=n(7621),f=n(2266),d=n(1376),g=n(6679),p=n(2651),S="Web push settings not configured on MoEngage dashboard: "+r.default.PUSH_SETTINGS_PAGE_LINK;function h(e,t){this.currentManager=null;var n=h.baseLogTag+".constructor";this.config=e,(this.browser=t).isIncognito?(this.currentManager=null,a.default.warn(1,n,"Web push not supported in incognito mode")):this.browser.isChromeLike()&&e.platformSettings.chrome?(e.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.HTTPS?"http"===(0,i.getCurrentProtocol)()?a.default.error(1,n,"Domain configured as a HTTPS site and this is a HTTP site. Please update correct settings at",r.default.PUSH_SETTINGS_PAGE_LINK):this.currentManager=new d.default(e):e.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.HTTP?this.currentManager=new f.default(e):e.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.MUTLI&&("https"===(0,i.getCurrentProtocol)()?this.currentManager=new d.default(e):this.currentManager=new f.default(e)),!1===e.platformSettings.chrome.enabled&&a.default.warn(1,n,"Web push settings not configured. Please configure at ",r.default.PUSH_SETTINGS_PAGE_LINK)):this.browser.name===s.default.BROWSER_NAMES.SAFARI&&e.platformSettings.safari&&"safari"in window&&"pushNotification"in window.safari&&(this.currentManager=null,a.default.warn(1,n,"Web push support for Safari will be coming soon. Please try on Chrome, Opera or Firefox."))}h.prototype.showHardAsk=function(){var e=this,t=h.baseLogTag+".showHardAsk";return new Promise((function(n,i){e.getCurrentPermissionState().then((function(s){null!=e.currentManager?s===g.PERMISSION_STATE.PROMPT?(l.default.set(r.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,Date.now()),c.default.track(r.default.EVENT_NAMES.OPT_IN_SHOWN),o.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_SHOWN}),o.default.deprecatedSdkCallback("opt_in_shown"),p.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_SHOWN),e.currentManager.showHardAsk().then((function(e){e.state===g.PERMISSION_STATE.DISMISSED?(c.default.track(r.default.EVENT_NAMES.OPT_IN_DISMISSED),o.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DISMISSED}),o.default.deprecatedSdkCallback("opt_in_dismissed"),p.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DISMISSED),a.default.log(1,t,"Hard ask was dismissed")):e.state===g.PERMISSION_STATE.GRANTED?(c.default.track(r.default.EVENT_NAMES.OPT_IN_ALLOWED),o.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_ALLOWED,data:e.subscriptionDetails}),o.default.deprecatedSdkCallback("opt_in_allowed"),p.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_ALLOWED),a.default.log(1,t,"Push permission was granted"),a.default.customLabel(1,t,"token",e.subscriptionDetails.token)):e.state===g.PERMISSION_STATE.DENIED&&(c.default.track(r.default.EVENT_NAMES.OPT_IN_BLOCKED),c.default.track("Web Push Opt-in Denied"),o.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DENIED}),o.default.deprecatedSdkCallback("opt_in_blocked"),p.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DENIED),a.default.log(1,t,"Notification permission was denied")),n(e)})).catch((function(e){a.default.error(1,t,"Error showing hard ask:",e),n({state:s,subscriptionDetails:null})}))):(a.default.log(1,t,"Not showing Hard Ask as current permission state is",s),e.getPushTokenDetails().then((function(e){a.default.customLabel(1,t,"token",e.token),n({state:s,subscriptionDetails:e})})).catch((function(e){a.default.warn(1,t,"Could not get push token details"),n({state:s,subscriptionDetails:null})}))):(a.default.log(1,t,"MoEngage web push settings not configured. Please configure at",r.default.PUSH_SETTINGS_PAGE_LINK),i(r.default.ERRORS.WEB_PUSH_NOT_CONFIGURED))})).catch((function(e){i(e)}))}))},h.prototype.getCurrentPermissionState=function(){return null!=this.currentManager?this.currentManager.getCurrentPermissionState():Promise.reject(S)},h.prototype.getPushTokenDetails=function(){return null!=this.currentManager?this.currentManager.getPushTokenDetails():Promise.reject(S)},h.prototype.isTokenValid=function(){return null!=this.currentManager?this.currentManager.isTokenValid():Promise.reject(S)},h.prototype.removeToken=function(){return null!=this.currentManager?this.currentManager.removeToken():Promise.reject(S)},h.prototype.showNotification=function(e){var t=h.baseLogTag+".showNotification";if(null!=this.currentManager)return this.currentManager.showNotification(e);a.default.warn(1,t,S)},h.baseLogTag="NotificationManager",n=h,t.default=n},4340:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(r.addEvent=function(e){r.history.push(e),r.listeners.forEach((function(t){t(e)}))},r.getHistory=function(){return r.history},r.addEventListener=function(e){r.listeners.push(e)},r.clear=function(){r.history=[]},r.history=[],r.listeners=[],r);function r(){}t.default=n},85:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3358),a=n(3571),i=n(5601),o=n(9967),s=n(7016),u=n(8611),l=i.default.PERSISTENT_STORAGE.Q;function c(){}c.clear=function(e){for(var t=c.baseLogTag+".clear",n=[];!a.default.isEmpty(e);)!function(){switch(e){case l.REPORT:var i=a.default.dequeue(l.REPORT);n.push((function(e){s.default.reportAdd(i).then((function(){e()}))}));break;case l.DEVICE:a.default.dequeue(l.DEVICE)&&n.push((function(e){s.default.deviceAdd().then((function(){e()}))}));break;default:r.default.error(1,t,"Do not know how to handle queue with name:",e)}}();setTimeout((function(){c.processing[e]=!0,o(n,5,(function(t,n){c.processing[e]=!1}))}),0)},c.startPeriodicClear=function(e){var t=c.baseLogTag+".startPeriodicCleanQ";function n(){a.default.isEmpty(e)?(r.default.log(1,t,"If you see multiple event tracks with same, they were captured over multiple visits or page refreshes."),(0,u.getProp)(c.processing,e,!1)||c.clearInterval(e)):(c.clear(e),r.default.log(1,t,"Starting periodic queue clear for",e))}c.clearInterval(e),n(),c.intervals[e]=setInterval(n,6e3)},c.clearInterval=function(e){null!=c.intervals[e]&&(clearInterval(c.intervals[e]),c.intervals[e]=null)},c.baseLogTag="QManager",c.intervals={},c.processing={},i=c,t.default=i},602:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SoftAskState=void 0;var r,a=n(5601),i=n(3358),o=n(3546),s=n(2983),u=n(5511),l=n(8553),c=n(7621),f=n(6801),d=n(8611),g=n(2651);function p(e){this.mainDivs=[],this.config=e}p.prototype.showSoftAsk=function(){var e=this,t=p.baseLogTag+".showSoftAsk";return new Promise((function(n,f){var p=e.config.optInConfig.loadTime;(p=e.config.optInConfig.type===s.OptInConfig.TYPE.SELF_HANDLED?0:p)&&i.default.log(1,t,"Delay of",p," second(s) requested before opt-in flow"),setTimeout((function(){o.default.getInstance().then((function(o){o.isChromeLike()&&"https"===(0,d.getCurrentProtocol)()&&e.config.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.MUTLI||e.config.optInConfig.type!==s.OptInConfig.TYPE.TWO_STEP&&e.config.optInConfig.type!==s.OptInConfig.TYPE.SELF_HANDLED?(l.default.set(a.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.NOT_SHOWN),n({showHardAsk:!0,softAskState:r.NOT_SHOWN})):e.showOptIn((function(){i.default.log(1,t,"Soft ask was shown"),l.default.set(a.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,Date.now()),l.default.set(a.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.SHOWN),u.default.broadcastToWindow({topic:a.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_SHOWN}),u.default.deprecatedSdkCallback("soft_ask_shown"),g.default.runCallbacks(a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_SHOWN)}),(function(){c.default.track(a.default.EVENT_NAMES.WEB_OPTIN_ACCEPTED),e.hideOptIn(),i.default.log(1,t,"Soft ask was allowed"),l.default.set(a.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.ALLOWED),n({showHardAsk:!0,softAskState:r.ALLOWED}),u.default.broadcastToWindow({topic:a.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_ALLOWED}),u.default.deprecatedSdkCallback("soft_ask_allowed"),g.default.runCallbacks(a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_ALLOWED)}),(function(){e.hideOptIn(),c.default.track(a.default.EVENT_NAMES.WEB_OPTIN_CLOSED),i.default.log(1,t,"Soft ask was dismissed"),l.default.set(a.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.DISMISSED),n({showHardAsk:!1,softAskState:r.DISMISSED}),u.default.broadcastToWindow({topic:a.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_DISMISSED}),u.default.deprecatedSdkCallback("soft_ask_closed"),g.default.runCallbacks(a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_DISMISSED)}),(function(t){t=!!t,e.hideOptIn(),n({showHardAsk:t,softAskState:r.NOT_SHOWN})}))}))}),1e3*p)}))},p.prototype.showOptIn=function(e,t,n,r){var u=this,l=p.baseLogTag+".showOptIn";if(this.config.optInConfig.type===s.OptInConfig.TYPE.TWO_STEP){var g=document.getElementById("moe-push-div");null==g&&((g=document.createElement("div")).id="moe-push-div",g.className="moe-push-class"),o.default.getInstance().then((function(o){var s=null;null!=(s=(o.isMobile?u.config.optInConfig.softAskConfig.mobile:u.config.optInConfig.softAskConfig.desktop).customHTML)?(g.innerHTML=s,(o=document.body.firstChild).parentNode.insertBefore(g,o),u.moeDiv=g,s=document.getElementById("optInText")||document.getElementById("optInTextConventional"),o=document.getElementById("moe-dontallow_button"),null==s?(i.default.error(1,l,"Error showing soft ask. Allow button id is missing"),r()):(e(),c.default.track(a.default.EVENT_NAMES.WEB_OPTIN_BANNER_LOAD),s.onclick=function(){t()},o?o.onclick=function(){n()}:window.moeRemoveBanner=function(){n()})):(i.default.error(1,l,"Error displaying soft ask"),r())}))}else if(this.config.optInConfig.type===s.OptInConfig.TYPE.SELF_HANDLED){var S=f.default.get();if(S.customSoftAsk){var h=document.getElementsByClassName(S.customSoftAsk.mainClass),E=document.getElementsByClassName(S.customSoftAsk.allowClass),T=document.getElementsByClassName(S.customSoftAsk.dismissClass);if(h.length<1)i.default.error(1,l,"Could not find main class for the soft ask. Class name given:",S.customSoftAsk.mainClass),o.default.getInstance().then((function(e){(e.isChromeLike()&&u.config.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.HTTPS||u.config.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.MUTLI&&"https"===(0,d.getCurrentProtocol)()||e.name===o.default.BROWSER_NAMES.SAFARI)&&(i.default.warn(1,l,"Proceeding to hard ask directly"),r(!0))}));else{e(),E.length<1&&(i.default.warn(1,l,"Could not find any element for allow button. Class name given:",S.customSoftAsk.allowClass),i.default.warn(1,l,"Docs for self-handled opt in available here - ",a.default.LINKS.SELF_HANDLED_DOCS)),T.length<1&&i.default.warn(1,l,"Could not find any element for dismiss button. Class name given:",S.customSoftAsk.dismissClass);for(var m=h.length-1;0<=m;m--){var _=h[m];this.mainDivs.push(_),_.style.display="block"}for(m=E.length-1;0<=m;m--)(_=E[m]).onclick=function(){t()};for(m=T.length-1;0<=m;m--)(_=T[m]).onclick=function(){n()}}}else o.default.getInstance().then((function(e){e.isChromeLike()&&u.config.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.HTTPS||u.config.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.MUTLI&&"https"===(0,d.getCurrentProtocol)()||e.name===o.default.BROWSER_NAMES.SAFARI?(i.default.warn(1,l,"No soft ask configured. Proceeding to hard ask directly. \n\nYou can ignore this message if you do not want any soft ask."),r(!0)):(i.default.error(1,l,"Soft ask needs to be present in case of http implementation. Can not show hard ask otherwise."),r())}))}},p.prototype.hideOptIn=function(){null!=this.moeDiv&&(this.moeDiv.style.display="none"),0<this.mainDivs.length&&this.mainDivs.map((function(e){e.style.display="none"}))},p.baseLogTag="SoftAskManager",n=p,t.default=n,(t=r=t.SoftAskState||(t.SoftAskState={})).SHOWN="shown",t.NOT_SHOWN="not shown",t.ALLOWED="allowed",t.DISMISSED="dismissed"},1385:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(5601),o=n(9483);function s(){}s.initStore=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return null==s.ready&&(s.offlineDataStore=o.createInstance({driver:[o.INDEXEDDB],name:i.OFFLINE.DATABASE_NAME,storeName:i.OFFLINE.STORES.OFFLINE_DATA.NAME}),s.ready=Promise.resolve(s.offlineDataStore.ready())),[4,s.ready];case 1:return[2,e.sent()]}}))}))},s.initialize=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,s.initStore()];case 1:return e.sent(),[2]}}))}))},n=s,t.default=n},7856:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5601),a=n(3358),i=n(8553),o=n(2983),s=n(3546),u=n(464),l=n(7016),c=n(9417),f=n(6679),d=n(602),g=n(7621),p=n(4418),S=n(8611),h=n(6928);function E(e,t){this.notificationManager=null,this.softAskManager=null,this.sdkSettings=e,this.browser=t,this.softAskManager=new d.default(this.sdkSettings),this.notificationManager=new c.default(this.sdkSettings,t)}E.prototype.callWebPush=function(){var e=this,t=E.baseLogTag+".callWebPush";this.isWebPushEnabled()&&this.notificationManager.getCurrentPermissionState().then((function(n){function o(){u.default.get().then((function(o){var s=!1,u=o.getAttribute("email"),l=o.getAttribute("mobile");o.deviceAdded=s=null!==u||null!==l||s,o.save().then((function(){e.notificationManager.removeToken().then((function(){n===f.PERMISSION_STATE.DENIED?a.default.log(1,t,"Not asking for permission as current state is denied."):(i.default.remove(r.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME),e.startPushSubscription())}))}))}))}var l=i.default.get(r.default.PERSISTENT_STORAGE.PUSH_TOKEN);null==l&&n!==f.PERMISSION_STATE.DENIED?e.startPushSubscription():null!=l&&n===f.PERMISSION_STATE.DENIED?(a.default.log(1,t,"User has removed the permission"),a.default.image(1,r.default.GIFS.SAD),g.default.track(r.default.EVENT_NAMES.UNSUBSCRIBED,{Source:"Website"}).then((function(){o()}))):n===f.PERMISSION_STATE.DENIED?a.default.warn(1,t,"Not proceeding with push subscription as current state is denied"):null!=l&&n===f.PERMISSION_STATE.GRANTED?e.browser.name===s.default.BROWSER_NAMES.CHROME?(0,S.isVapid)(e.sdkSettings.platformSettings,e.browser)?e.startPushSubscription():e.notificationManager.isTokenValid().then((function(n){n?(e.startPushSubscription(),a.default.log(1,t,"Push token is valid"),e.notificationManager.getPushTokenDetails().then((function(e){a.default.customLabel(1,t,"token",e.token)}))):(a.default.warn(1,t,"Push token has expired. Trying to get a new token. This is a Chrome only feature."),o())})):(e.startPushSubscription(),e.notificationManager.getPushTokenDetails().then((function(e){a.default.customLabel(1,t,"token",e.token)}))):e.sdkSettings.isDomainLevelStorage?"granted"===p.default.get(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS)?(l=p.default.get(r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS).domain)&&l===window.location.origin?(a.default.log(1,t,"It seems that the user has unsubscribed manually. Starting push subscription.."),o()):a.default.log(1,t,"Not showing opt-in as user subscribed to sub-domain"):e.startPushSubscription():o()})).catch((function(e){a.default.error(1,t,"Error in getting current state:",e)}))},E.prototype.startPushSubscription=function(){function e(){i.default.set(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS,f.PERMISSION_STATE.PROMPT);var e=i.default.get(r.default.PERSISTENT_STORAGE.PUSH_TOKEN);t.notificationManager.showHardAsk().then((function(o){i.default.set(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS,o.state),o.state===f.PERMISSION_STATE.GRANTED?null!=o.subscriptionDetails.token?(i.default.set(r.default.PERSISTENT_STORAGE.PUSH_TOKEN,o.subscriptionDetails.token),o.subscriptionDetails.domain=window.location.origin,i.default.set(r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,o.subscriptionDetails),o.subscriptionDetails.token&&e!==o.subscriptionDetails.token&&l.default.deviceAdd().then((function(){a.default.image(1,r.default.GIFS.AMAZED),u.default.getSync().subscribedToOldSdk?a.default.log(1,n,"User subscribed from older sdk, hence not sending subscription event"):(null!=e?h.default.addAttribute("Web Migrated User","true"):(h.default.addAttribute("Web Push Preference","granted"),h.default.addAttribute("Web Subscription URL",location.href)),(0,S.isMigratedUser)(),g.default.track(r.default.EVENT_NAMES.USER_SUBSCRIBED,{MOE_WEB_PUSH_TOKEN:o.subscriptionDetails.token,migrated_user:!!(0,S.isMigratedUser)()||void 0}))})),t.sdkSettings.isDomainLevelStorage&&(p.default.set(r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,{domain:o.subscriptionDetails.domain,token:o.subscriptionDetails.token,endpoint:o.subscriptionDetails.endpoint,keys:o.subscriptionDetails.keys}),p.default.set(r.default.PERSISTENT_STORAGE.PUSH_TOKEN,o.subscriptionDetails.token))):(a.default.error(1,n,"Push token was received as null."),a.default.error(1,n,"Please contact MoEngage support if this troubleshooting does not solve the issue.")):o.state===f.PERMISSION_STATE.DENIED&&a.default.image(1,r.default.GIFS.SAD)})).catch((function(e){a.default.warn(1,n,e)}))}var t=this,n=E.baseLogTag+".startPushSubscription";this.notificationManager.getCurrentPermissionState().then((function(s){var u,l,c;s===f.PERMISSION_STATE.GRANTED?(t.sdkSettings.optInConfig.type!==o.OptInConfig.TYPE.ONE_CLICK&&a.default.log(1,n,"Skipping soft ask as browser permission is set to allow all notifications"),e()):(u=parseInt(i.default.get(r.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME)),i.default.get(r.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS),i.default.get(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS),l=(Date.now()-u)/36e5,!u||l>t.sdkSettings.optInConfig.reappearTime?t.softAskManager?t.softAskManager.showSoftAsk().then((function(t){t.showHardAsk&&e()})):a.default.log(1,n,"SoftAskManager not set."):(s=c=void 0,s=l<1?(c=Math.floor(60*l),"minute(s)"):(c=Math.floor(100*l)/100,"hour(s)"),a.default.log(1,n,"Not showing opt in as last it was shown",c,s,"back on",new Date(u),". Reappear time is set to",t.sdkSettings.optInConfig.reappearTime,"hours."),a.default.log(1,n,"You can clear localstorage to get opt-in again.")))}))},E.prototype.isWebPushEnabled=function(){return o.default.isFeatureEnabled(this.sdkSettings,r.default.SDK_FEATURES.WEB_PUSH)&&!this.browser.isIncognito&&0<=E.SUPPORTED_BROWSERS.indexOf(this.browser.name)},E.prototype.getPermissionState=function(){return this.notificationManager.getCurrentPermissionState()},E.prototype.showNotification=function(e){this.notificationManager&&this.notificationManager.showNotification(e)},E.baseLogTag="WebPushManager",E.SUPPORTED_BROWSERS=[s.default.BROWSER_NAMES.CHROME,s.default.BROWSER_NAMES.FIREFOX,s.default.BROWSER_NAMES.OPERA],n=E,t.default=n},8032:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReportView=void 0;var r=n(8611);function a(e){this.EVENT_ACTION=e.event.name,this.EVENT_ATTRS=i(e.event.attributes),this.EVENT_G_TIME=(new Date).getTime().toString(),this.EVENT_L_TIME=(0,r.convertDateToDateMonthYearFormat)(),this.EVENT_ATTRS_CUST=e.postData.c,this.N_I_E=e.postData.nie}a.baseLogTag="ReportAddViewEvent",n=a,t.ReportView=n;var i=function(e){var t={};return e.forEach((function(e){t[e.key]=e.value})),t}},1520:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8611);t.default=function(e){this.templateType=(0,r.getProp)(e,"template_type",null),this.payloadType=(0,r.getProp)(e,"payload_type",null),this.payload=(0,r.getProp)(e,"payload",null),this.position=(0,r.getProp)(e,"position",null),this.campaignContext=(0,r.getProp)(e,"campaign_context",null),this.updatedTime=(0,r.parseISOString)((0,r.getProp)(e,"updated_time")+"Z")}},1481:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TEMPLATE_TYPE=t.DisplaySettings=t.DisplayFilter=t.CampaignFCModel=t.FILTER_OPERATORS=t.OnsiteCampaignStatus=t.TriggerAttributes=void 0;var r=n(8611),a=n(3358),i=n(9339),o=n(1633);function s(e){var t=s.baseLogTag+".constructor";this.campaignId=(0,r.getProp)(e,"campaign_id",null),this.campaignName=(0,r.getProp)(e,"campaign_name",null),this.templateType=(0,r.getProp)(e,"template_type",null),this.campaignContext=(0,r.getProp)(e,"campaign_context",null);var n=(0,r.getProp)(e,"status",null),i=[S.ACTIVE,S.EXPIRED,S.PAUSED];i.indexOf(n)<0?this.status=S.ACTIVE:this.status=i[i.indexOf(n)],this.tag=(0,r.getProp)(e,"tag",null),this.triggerData=null,u.validate((0,r.getProp)(e,"trigger"))?this.triggerData=new u((0,r.getProp)(e,"trigger")):a.default.log(2,t,"Rejecting trigger data for :",e),this.expiryTime=(0,r.parseISOString)((0,r.getProp)(e,"expiry_time")+"Z"),this.updatedTime=(0,r.parseISOString)((0,r.getProp)(e,"updated_time")+"Z"),this.delivery=new m((0,r.getProp)(e,"delivery")),this.userInSegment=(0,r.getProp)(e,"user_in_segment",!0),t=(this.display=null,r.getProp)(e,"display",null),e=(0,r.getProp)(e,"display_filter",null),this.templateType!==y.SELF_HANDLED&&(null!=e?this.display=new A({rules:{uri_filters:e}},this.templateType):null!=t&&(this.display=new A(t,this.templateType)))}s.isValidMetaJSON=function(e){for(var t=!0,n=["campaign_id","campaign_name","template_type","status","expiry_time","updated_time","delivery","user_in_segment"],r=0;r<n.length;r++)if(null==e[n[r]]){t=!1;break}return t},s.getFilters=function(e){return(0,r.getProp)(e,"triggerData.primary_condition.attributes.filters",[])},s.getSecondaryFilters=function(e){return(0,r.getProp)(e,"triggerData.secondary_condition.attributes.filters",[])},s.getFilterResult=function(e,t){var n=s.getFilters(t),a=s.getSecondaryFilters(t);if(null==n&&null==a)return!0;var o=!0;if(n&&0<n.length)for(var u=(0,r.getProp)(t,"triggerData.primary_condition.attributes.filterOperator","and"),l=n.map((function(t){return i.default.doesEventMatchFilters(e,t)})),c=(o=l[0],1);c<l.length;c++)if(u===h.AND){if(!1===(o=o&&l[c]))break}else if(u===h.OR&&!0===(o=o||l[c]))break;return!1!==o&&(t=s.getURLFilterResult(t),o&&t)},s.getURLFilterResult=function(e){var t=s.getSecondaryFilters(e),n=!0;if(t&&0<t.length)for(var r=new o.default(e.triggerData.secondary_condition.action_name,[]),a=e.triggerData.secondary_condition.attributes.filterOperator,u=t.map((function(e){return i.default.doesEventMatchFilters(r,e)})),l=(n=u[0],0);l<u.length;l++)if(a===h.AND){if(!1===(n=n&&u[l]))break}else if(a===h.OR&&!0===(n=n||u[l]))break;return n},s.baseLogTag="OnsiteCampaignMeta",n=s,t.default=n;var u=(l.validate=function(e){var t=!1;return["primary_condition"].forEach((function(n){null!=(0,r.getProp)(e,n,null)&&(t=!0)})),t},l);function l(e){this.cs_id=e.cs_id,this._id=e._id,this.references=e.references,f.validate(e.primary_condition)?this.primary_condition=new f(e.primary_condition):this.primary_condition=null,0<(0,r.getProp)(e,"secondary_condition.filters",[]).length&&(this.secondary_condition=new g(e.secondary_condition.filters[0])),this.description=e.description,null!=e.trigger_delay?this.trigger_delay=new c(e.trigger_delay):this.trigger_delay=null}var c=function(e){this.delay=(0,r.getProp)(e,"delay",0),this.unit=(0,r.getProp)(e,"unit","seconds"),this.delay_type=(0,r.getProp)(e,"delay_type",""),this.attribute=(0,r.getProp)(e,"attribute",""),(0,r.getProp)(e,"delay",null)&&(0,r.getProp)(e,"unit",null)?(e=this.delay,"minutes"!==this.unit&&"hours"!==this.unit&&"days"!==this.unit||(e*=60),"hours"!==this.unit&&"days"!==this.unit||(e*=60),"days"===this.unit&&(e*=24),this.delayInSeconds=e):this.delayInSeconds=0},f=(d.validate=function(e){return!(!e||null==e.action_name)||!1},d);function d(e){this.action_name=null,this.attributes=null,this.action_name=(0,r.getProp)(e,"action_name",null),e=(0,r.getProp)(e,"attributes",null),E.validateJson(e)&&(this.attributes=new E(e))}var g=(p.validate=function(e){return!(!e||null==e.action_name)||!1},p);function p(e){this.action_name=null,this.attributes=null,this.action_name=(0,r.getProp)(e,"action_name",null),e=(0,r.getProp)(e,"attributes",null),E.validateJson(e)&&(this.attributes=new E(e))}var S,h,E=(T.validateJson=function(e){if(null==e)return!1;for(var t=["filters"],n=0;n<t.length;n++)if(null==e[t[n]])return!1;return!0},T);function T(e){this.filters=[],this.filterOperator=(0,r.getProp)(e,"filter_operator",h.AND),this.filters=(0,r.getProp)(e,"filters",[])}t.TriggerAttributes=E,(n=S=t.OnsiteCampaignStatus||(t.OnsiteCampaignStatus={})).ACTIVE="ACTIVE",n.PAUSED="PAUSED",n.EXPIRED="EXPIRED",(n=h=t.FILTER_OPERATORS||(t.FILTER_OPERATORS={})).AND="and",n.OR="or";var m=function(e){this.priority=(0,r.getProp)(e,"priority",0),this.dismiss_interval=(0,r.getProp)(e,"dismiss_interval",0),this.fc_meta=new _((0,r.getProp)(e,"fc_meta",null))},_=function(e){this.count=0,this.delay=0,this.ignore_global_delay=!1,null!=e&&(this.count=(0,r.getProp)(e,"count",0),this.delay=(0,r.getProp)(e,"delay",0),this.ignore_global_delay=(0,r.getProp)(e,"ignore_global_delay",!1))};t.CampaignFCModel=_;var v=function(e){this.aggregations=[],this.filters=[],this.aggregations=(0,r.getProp)(e,"aggregations",[]),this.filter_operator=(0,r.getProp)(e,"filter_operator",h.AND),this.filters=(0,r.getProp)(e,"filters",[])};t.DisplayFilter=v;var y,A=(I.getDefaultValue=function(e,t){return{blocking:{POP_UP:!0,BANNER:!1},push_page:{POP_UP:!1,BANNER:!0},sticky:{POP_UP:!1,BANNER:!0},scrollable:{POP_UP:!1,BANNER:!0},show_over_campaigns:{POP_UP:!1,BANNER:!1}}[e][t]},I);function I(e,t){this.config={blocking:(0,r.getProp)(e,"config.blocking",I.getDefaultValue("blocking",t)),pushPage:(0,r.getProp)(e,"config.push_page",I.getDefaultValue("push_page",t)),sticky:(0,r.getProp)(e,"config.sticky",I.getDefaultValue("sticky",t)),scrollable:(0,r.getProp)(e,"config.scrollable",I.getDefaultValue("scrollable",t)),showOverOtherCampaigns:(0,r.getProp)(e,"config.show_over_campaigns",I.getDefaultValue("show_over_campaigns",t))},this.rules={uriFilters:new v((0,r.getProp)(e,"rules.uri_filters",{}))}}t.DisplaySettings=A,(t=y=t.TEMPLATE_TYPE||(t.TEMPLATE_TYPE={})).SELF_HANDLED="SELF_HANDLED",t.POP_UP="POP_UP",t.BANNER="BANNER"},7545:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1481),a=n(8611);function i(e){this.draftId=(0,a.getProp)(e,"draft_id",null),this.draftType=(0,a.getProp)(e,"draft_type",null),this.templateType=(0,a.getProp)(e,"template_type",null),this.action=(0,a.getProp)(e,"action",null);var t=(0,a.getProp)(e,"campaign_meta",{});this.locale=(0,a.getProp)(e,"locale",null),this.variation=(0,a.getProp)(e,"variation",null),this.displaySettings=new r.DisplaySettings({config:t},this.templateType)}i.isValidRawJson=function(e){var t=e.draft_id;return e=e.draft_tag,null!=t&&null!=e},n=i,t.default=n},4039:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(r.equal=function(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)},r);function r(e,t){this.key=e,this.value=t}t.default=n},3546:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(5601),o=n(4622),s=n(8611),u=n(8553),l=(c.getInstance=function(){return r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return null!=o.default.get(i.default.EPHEMERAL_STORAGE.BROWSER_DETAILS)?[3,2]:[4,c.isIncognito(window)];case 1:return t=n.sent(),e=new c(navigator,document,t),o.default.set(i.default.EPHEMERAL_STORAGE.BROWSER_DETAILS,e),(t=u.default.get(i.default.PERSISTENT_STORAGE.BROWSER_DETAILS))&&c.isBrowserUpdated(t,e)||u.default.set(i.default.EPHEMERAL_STORAGE.BROWSER_DETAILS,e),[2,e];case 2:return[2,o.default.get(i.default.EPHEMERAL_STORAGE.BROWSER_DETAILS)]}}))}))},c.isIncognito=function(e){var t=e.RequestFileSystem||e.webkitRequestFileSystem;return new Promise((function(n){t?t(e.TEMPORARY,100,(function(){n(!1)}),(function(){n(!0)})):n(!1)}))},c.getBrowserName=function(e,t){return-1!==e.indexOf("MSIE")||1==t.documentMode?c.BROWSER_NAMES.INTERNET_EXPLORER:-1<e.indexOf("Edg")?c.BROWSER_NAMES.EDGE:-1<e.indexOf("OPR")||-1<e.indexOf("Opera")?c.BROWSER_NAMES.OPERA:-1<e.indexOf("Chrome")?-1<e.indexOf("MMS")?c.BROWSER_NAMES.OPERA_NEON:c.BROWSER_NAMES.CHROME:-1<e.indexOf("Safari")?c.BROWSER_NAMES.SAFARI:-1<e.indexOf("Firefox")?c.BROWSER_NAMES.FIREFOX:c.BROWSER_NAMES.OTHERS},c.isBrowserUpdated=function(e,t){return(0,s.deepCompareObjects)(e,t)},c.prototype.isChromeLike=function(){return this.isChrome()||this.isFirefox()||this.isOpera()},c.prototype.isChrome=function(){return this.name===c.BROWSER_NAMES.CHROME},c.prototype.isFirefox=function(){return this.name===c.BROWSER_NAMES.FIREFOX},c.prototype.isOpera=function(){return this.name===c.BROWSER_NAMES.OPERA||this.name===c.BROWSER_NAMES.OPERA_NEON},c.prototype.isSafari=function(){return this.name===c.BROWSER_NAMES.SAFARI},c);function c(e,t,n){this.os="web",this.osPlatform=e.userAgent,this.isMobile=(0,s.isMobile)(),this.os=(0,s.isMobile)()?"mweb":"web",this.name=c.getBrowserName(e.userAgent,t),this.isIncognito=n}(n=(n=l=l||{}).BROWSER_NAMES||(n.BROWSER_NAMES={})).CHROME="Google Chrome",n.FIREFOX="Mozilla Firefox",n.OPERA="Opera",n.OPERA_NEON="Opera Neon",n.SAFARI="Apple Safari",n.INTERNET_EXPLORER="Internet Explorer",n.EDGE="Edge",n.OTHERS="Others",t.default=l},1633:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4039),o=n(5601),s=n(464),u=n(3358),l=n(1586);function c(e,t,n){void 0===n&&(n=!0),this.name=e,this.attributes=t,n&&this.attributes.push(new i.default(o.default.EVENT_ATTRIBUTES_NAMES.URL,location.href))}c.createUserAttributeEvent=function(e){return new Promise((function(t,n){var r=[],a=e.key;switch(e.key){case"id":e.key=o.default.ATTRIBUTE_NAMES.ID;break;case"email":e.key=o.default.ATTRIBUTE_NAMES.EMAIL;break;case"name":e.key=o.default.ATTRIBUTE_NAMES.NAME;break;case"first_name":e.key=o.default.ATTRIBUTE_NAMES.FIRST_NAME;break;case"last_name":e.key=o.default.ATTRIBUTE_NAMES.LAST_NAME;break;case"mobile":e.key=o.default.ATTRIBUTE_NAMES.MOBILE;break;case"gender":e.key=o.default.ATTRIBUTE_NAMES.GENDER;break;case"birthday":e.key=o.default.ATTRIBUTE_NAMES.BDAY}r.push(e),s.default.get().then((function(n){var s=n.indexOfAttribute("oldUniqueIds");-1<s&&null!=n.attributes[s].value&&0<n.attributes[s].value.length&&r.push(new i.default(o.default.ATTRIBUTE_NAMES.ID_MODIFIED,n.attributes[s].value[n.attributes[s].value.length-1])),e.key!==a&&u.default.log(2,"Event.createUserAttributeEvent","Key changed to MoE reserved keyname: ",e.key),t(new c(o.default.EVENT_NAMES.USER_ATTRIBUTE,r,!1))}))}))},c.createEvent=function(e,t,n){var f=this;return new Promise((function(d,g){s.default.get().then((function(s){return r(f,void 0,void 0,(function(){var r,f,g;return a(this,(function(a){try{r=new i.default(o.default.EVENT_ATTRIBUTES_NAMES.LOGGED_IN_STATUS,!!s.getAttribute("id")),f=new l.default,g=new i.default(o.default.EVENT_ATTRIBUTES_NAMES.FIRST_VISIT,f.getNumberOfSessions()<=o.PAGE_LIFE_CYCLE.FIRST_SEEN_SESSIONS),t.push(r,g),d(new c(e,t,n))}catch(a){u.default.error(1,"Event.createEvent","Error occurred in create events ",a)}return[2]}))}))}))}))},n=c,t.default=n},4292:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8553),a=n(5601),i=n(8611);function o(e){this.deviceToLogout=(0,i.getProp)(e,"deviceToLogout",null)}o.get=function(){return new o(r.default.get(a.default.PERSISTENT_STORAGE.GRACEFUL_DATA))},o.prototype.save=function(){r.default.set(a.default.PERSISTENT_STORAGE.GRACEFUL_DATA,this)},n=o,t.default=n},6801:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(5601),i=n(8611),o=n(4622),s=n(3358),u=n(8553);function l(e){this.debugLevel=0,this.cluster=null,this.environment=null,this.baseDomainName="https://sdk-01.moengage.com/",this.inapp=null,this.customSoftAsk=null;var t=l.baseLogTag+".constructor";null!=(0,i.getProp)(e,"app_id",null)?(this.appId=(0,i.getProp)(e,"app_id",null),this.integrationType=r.OLD_SDK):null!=(0,i.getProp)(e,"appId",null)?(this.appId=(0,i.getProp)(e,"appId",null),this.integrationType=r.NEW_SDK):(s.default.error(1,t,"App Id not specified. Please check docs page to complete the integration - ",a.default.LINKS.WEBSDK_DOCS),this.integrationType=null),null!=(0,i.getProp)(e,"debug_logs",null)?this.debugLevel=(0,i.getProp)(e,"debug_logs",0):null!=(0,i.getProp)(e,"debugLevel",null)?this.debugLevel=(0,i.getProp)(e,"debugLevel",0):(s.default.log(2,t,"No log level config found. Using default value of",0),this.debugLevel=0),this.appId&&(this.baseDomainName="https://sdk-01.moengage.com/",this.forceSwUpdate=(0,i.getProp)(e,"forceSwUpdate",!1),this.cluster=(0,i.getProp)(e,"cluster",null),this.cluster&&null!=a.default.CLUSTER_ENVIRONMENT_MAP[this.cluster]&&(this.environment=a.default.CLUSTER_ENVIRONMENT_MAP[this.cluster]),(0,i.getProp)(e,"environment",null)&&(this.environment=e.environment),this.environment&&(this.baseDomainName="https://"+this.environment+"/"),0<this.debugLevel&&this.appId.indexOf("_DEBUG")<0?this.appId=this.appId+"_DEBUG":0===this.debugLevel&&0<=this.appId.indexOf("_DEBUG")&&(this.appId=this.appId.substr(0,this.appId.indexOf("_DEBUG"))),this.swPath=(0,i.getProp)(e,"swPath",null),null!=e.customSoftAsk?this.customSoftAsk={mainClass:(0,i.getProp)(e,"customSoftAsk.mainClass",null),allowClass:(0,i.getProp)(e,"customSoftAsk.allowClass",null),dismissClass:(0,i.getProp)(e,"customSoftAsk.dismissClass",null)}:this.customSoftAsk={mainClass:(0,i.getProp)(e,"main_class",null),allowClass:(0,i.getProp)(e,"allow_class",null),dismissClass:(0,i.getProp)(e,"block_class",null)},null!=(0,i.getProp)(e,"inapp.host",null)&&(this.inapp={host:(0,i.getProp)(e,"inapp.host",null)}),null!=(0,i.getProp)(e,"swScope",null)&&(this.swScope=(0,i.getProp)(e,"swScope",null)),null!=(0,i.getProp)(e,"disable_onsite",null)&&(this.disableOnsite=(0,i.getProp)(e,"disable_onsite",!1)),null!=(0,i.getProp)(e,"enableSPA",null)&&(this.enableSPA=(0,i.getProp)(e,"enableSPA",!1)))}l.save=function(e){o.default.set(a.default.EPHEMERAL_STORAGE.INIT_DATA,new l(e)),u.default.set(a.default.PERSISTENT_STORAGE.INIT_DATA,new l(e))},l.get=function(){return o.default.get(a.default.EPHEMERAL_STORAGE.INIT_DATA)},l.setSoftAskConfig=function(e){var t=l.get();e={appId:t.appId,debugLevel:t.debugLevel,cluster:t.cluster,environment:t.environment,swPath:t.swPath,customSoftAsk:{mainClass:(0,i.getProp)(e,"main_class",(0,i.getProp)(e,"mainClass",null)),allowClass:(0,i.getProp)(e,"allow_class",(0,i.getProp)(e,"allowClass",null)),dismissClass:(0,i.getProp)(e,"block_class",(0,i.getProp)(e,"dismissClass",null))}},l.save(e)},l.baseLogTag="InitData",n=l,t.default=n,(n=r=r||{}).OLD_SDK="OLD_SDK",n.NEW_SDK="NEW_SDK"},4846:function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(3358),i=n(5877),o=n(464),s=n(8611),u=(l.baseLogTag="ReportPostData",l);function l(){var e=l.baseLogTag+".constructor",t=(t=o.default.getSync().getAttribute("id"))?t.toString():void 0,n=window.analytics,r=void 0,s=void 0;if(n){s=n._VERSIONS;try{r=n.user().anonymousId()}catch(t){a.default.error(1,e,"Error getting anonymous id from segment api",t)}}this.c=void 0,this.h="",this.identifiers=void 0,(t||r)&&(this.identifiers={moe_user_id:t,segment_id:r}),this.meta={bid:(0,i.v4)(),segmentSdkData:n?s:void 0}}var c,f=(d.baseLogTag="ReportClass",d);function d(e,t,n){var a,i;this.type=e,this.getParams=t,this.event=n,this.postData=new u;var o={},l={};try{for(var c=r(n.attributes),f=c.next();!f.done;f=c.next()){var g,p=f.value;p&&null!=p.key&&(this.status=d.STATUS.VALID,null!=p.value&&("function"==typeof p.value.getMonth?((g={})[p.key]=Math.round(p.value.getTime()-6e4*p.value.getTimezoneOffset()),null==l.timestamp&&(l.timestamp=[]),l.timestamp.push(g)):o[p.key]=p.value))}}catch(e){a={error:e}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}this.postData.e=n.name,this.postData.a=o,this.postData.c=(0,s.isObjectEmpty)(l)?void 0:l,window&&window.location&&null!=window.location.href&&(this.postData.url=window.location.href)}(n=(c=f=f||{}).STATUS||(c.STATUS={}))[n.INVALID=0]="INVALID",n[n.VALID=1]="VALID",(c=c.REPORT_ADD_TYPE||(c.REPORT_ADD_TYPE={}))[c.USER_ATTRIBUTE=0]="USER_ATTRIBUTE",c[c.EVENT=1]="EVENT",t.default=f},2983:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SafariConfig=t.ChromeConfig=t.OptInConfig=t.PushPlatformSettings=void 0;var r=n(8611),a=n(3358),i=n(5601),o=(s.parseOldSettings=function(e){var t,n=s.baseLogTag+".parseOldSettings",i=new s;return(i.oldWebData=e).webData&&!(0,r.isObjectEmpty)(e.webData)?(i.isConfigured=!0,t=e.webData,(e=(0,r.getProp)(t,"domain_type",null))&&("http"===e.toLowerCase()?i.platformSettings.chrome.domainType=d.DOMAIN_TYPE.HTTP:"https"===e.toLowerCase()?i.platformSettings.chrome.domainType=d.DOMAIN_TYPE.HTTPS:"multi"===e.toLowerCase()?i.platformSettings.chrome.domainType=d.DOMAIN_TYPE.MUTLI:i.platformSettings.chrome.domainType=d.DOMAIN_TYPE.NA),i.platformSettings.chrome.subdomainURL=(0,r.getProp)(t,"subdomainUrl",null),"false"===(0,r.getProp)(t,"domain_level_storage",!1)?i.isDomainLevelStorage=!1:i.isDomainLevelStorage=!(!(0,r.getProp)(t,"domain_level_storage",!1)&&"true"!==(0,r.getProp)(t,"domain_level_storage",!1)),"false"===(e=(0,r.getProp)(t,"PushSubBilling",!1))?e=!1:"true"===e&&(e=!0),r.validateDataType.isBoolean(e)||(e=!1),i.isPushSubBilling=e,i.platformSettings.chrome.domainType!==d.DOMAIN_TYPE.HTTP&&i.platformSettings.chrome.domainType!==d.DOMAIN_TYPE.MUTLI||i.platformSettings.chrome.subdomainURL||a.default.warn(1,n,"No sub domain defined for HTTP site"),i.platformSettings.chrome.enabled=!0,i.platformSettings.chrome.apiKey=(0,r.getProp)(t,"webPushPlatformData.chrome.api_key",""),i.platformSettings.chrome.projectNumber=(0,r.getProp)(t,"webPushPlatformData.chrome.project_number",null),i.platformSettings.chrome.subscriptionMode=(0,r.getProp)(t,"webPushPlatformData.chrome.subscriptionMode","normal"),i.platformSettings.chrome.vapidPublicKey=(0,r.getProp)(t,"webPushPlatformData.chrome.vapidPublicKey",null),i.platformSettings.firefox.enabled=!0,i.platformSettings.firefox.apiKey=(0,r.getProp)(t,"webPushPlatformData.chrome.api_key",""),i.platformSettings.firefox.projectNumber=(0,r.getProp)(t,"webPushPlatformData.chrome.project_number",null),i.platformSettings.firefox.subscriptionMode=(0,r.getProp)(t,"webPushPlatformData.firefox.subscriptionMode","normal"),i.platformSettings.firefox.vapidPublicKey=(0,r.getProp)(t,"webPushPlatformData.firefox.vapidPublicKey",null),i.platformSettings.safari.websitePushId=(0,r.getProp)(t,"webPushPlatformData.safari.websitePushId",null),null==i.platformSettings.safari.websitePushId?i.platformSettings.safari.enabled=!1:i.platformSettings.safari.enabled=!0,i.optInConfig.reappearTime=parseInt((0,r.getProp)(t,"promptAgain",24)),(0,r.getProp)(t,"call_push_moengage",!0)?(0,r.getProp)(t,"banner.banner_flag",null)?i.optInConfig.type=u.TYPE.TWO_STEP:i.optInConfig.type=u.TYPE.ONE_CLICK:(i.optInConfig.type=u.TYPE.SELF_HANDLED,i.optInConfig.reappearTime=0),i.optInConfig.showOverlay=(0,r.getProp)(t,"show_overlay",!1),i.optInConfig.loadTime=(0,r.getProp)(t,"load_time",0),i.optInConfig.softAskConfig.desktop.customHTML=(0,r.getProp)(t,"bannerHtml.web",null),i.optInConfig.softAskConfig.mobile.customHTML=(0,r.getProp)(t,"bannerHtml.mweb",null),i.platformSettings.chrome.isServiceWorkerRoot=!(0,r.getProp)(t,"is_service_worker_not_root",!1),i.platformSettings.chrome.serviceWorkerFilename=(0,r.getProp)(t,"serviceworker_file","serviceworker.js"),""===i.platformSettings.chrome.serviceWorkerFilename&&(i.platformSettings.chrome.serviceWorkerFilename="serviceworker.js"),i.featureAvailabilityMatrix=new f,i.featureAvailabilityMatrix=(0,r.getProp)(t,"featureAvailabilityMatrix",null),i.s_i_d=(0,r.getProp)(t,"s_i_d",1800),i.s_s_s=(0,r.getProp)(t,"s_s_s","allowed"),i.src_ext=(0,r.getProp)(t,"src_ext",[]),i.s_e_b_e=(0,r.getProp)(t,"s_e_b_e","blocked"),i.e_b_c=(0,r.getProp)(t,"e_b_c",10),i.p_f_t=(0,r.getProp)(t,"p_f_t",60)):i.isConfigured=!1,i},s.isFeatureEnabled=function(e,t){return!(t===i.default.SDK_FEATURES.WEB_PUSH&&(e=(0,r.getProp)(e,"featureAvailabilityMatrix.webPush",null))&&0<=(e=e.domains).values.indexOf(window.location.hostname)!=("whitelist"===e.type))},s.baseLogTag="SdkSettings",s);function s(){this.isDomainLevelStorage=!1,this.isConfigured=!1,this.isPushSubBilling=!1,this.platformSettings=new g,this.optInConfig=new u,this.s_i_d=1800}var u=function e(){this.type=e.TYPE.NA,this.reappearTime=24,this.softAskConfig={desktop:new l,mobile:new l}};t.OptInConfig=u;var l=function(){this.customHTML=null};(n=(n=u=u||{}).TYPE||(n.TYPE={})).NA="NA",n.ONE_CLICK="ONE_CLICK",n.TWO_STEP="TWO_STEP",n.SELF_HANDLED="SELF_HANDLED",t.OptInConfig=u;var c=function(){this.enabled=!1,this.websitePushId=null};t.SafariConfig=c;var f=function(){this.webPush=null},d=function e(){this.enabled=!1,this.domainType=e.DOMAIN_TYPE.NA,this.isServiceWorkerRoot=!0,this.serviceWorkerFilename="serviceworker.js",this.apiKey="",this.subscriptionMode="normal",this.vapidPublicKey=null};t.ChromeConfig=d,(n=(n=d=d||{}).DOMAIN_TYPE||(n.DOMAIN_TYPE={})).NA="NA",n.HTTP="http",n.HTTPS="https",n.MUTLI="multi",t.ChromeConfig=d;var g=function(){this.safari=new c,this.chrome=new d,this.firefox=new d};t.PushPlatformSettings=g,t.default=o},464:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4039),a=n(3358),i=n(7016),o=n(5601),s=n(8553),u=n(4418),l=n(3546),c=n(2266),f=n(2983),d=n(8611),g=n(5877),p=null,S=null;function h(e){this.attributes=[],this.subscribedToOldSdk=!1,null==e?(this.deviceUuid=(0,g.v4)(),this.attributes=[],this.deviceAdded=!1):(this.deviceUuid=(0,d.getProp)(e,"deviceUuid",(0,g.v4)()),this.attributes=(0,d.getProp)(e,"attributes",[]),this.deviceAdded=(0,d.getProp)(e,"deviceAdded",!1))}h.prototype.addAttribute=function(e){var t=this,n=h.baseLogTag+".addAttribute";return new Promise((function(r){e.key=h.getMorphedKey(e.key);for(var i=-1,o=t.attributes.length-1;0<=o;o--)e.key===t.attributes[o].key&&(i=o);a.default.log(2,n,"Adding attribute:",e),0<=i?(t.attributes[i].value,e.value,t.attributes[i].value=e.value):t.attributes.push(e),t.save().then((function(){r(!0)}))}))},h.getLocalUser=function(){var e=h.baseLogTag+".getLocalUser";return new Promise((function(t){s.default.get(o.default.PERSISTENT_STORAGE.USER_DATA)?(a.default.log(2,e,"Found user in localstorage"),t(new h(s.default.get(o.default.PERSISTENT_STORAGE.USER_DATA)))):t(null)}))},h.getCookieUser=function(){return new Promise((function(e){var t=h.baseLogTag+".getLocalUser";u.default.get(o.default.PERSISTENT_STORAGE.USER_DATA)?(a.default.log(2,t,"Found user in cookie"),e(new h(u.default.get(o.default.PERSISTENT_STORAGE.USER_DATA)))):e(null)}))},h.getSubdomainUser=function(){return new Promise((function(e){i.default.getWebSDKSettings().then((function(t){(p=new c.default(t)).getInSubdomain(o.default.PERSISTENT_STORAGE.USER_DATA).then((function(t){e(t?new h(t):null)}))}))}))},h.getMigrationUser=function(){var e=h.baseLogTag+".getLocalUser";return new Promise((function(t){var n=localStorage.getItem(o.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA);if(n)try{var i=JSON.parse(n);if(i.is_new_sdk_migrated)t(null);else{var s,u=new h({deviceAdded:(0,d.getProp)(i,"device_add",!1),deviceUuid:(0,d.getProp)(i,"uuid",(0,g.v4)())}),l=(0,d.getProp)(i,"user_attrs",{});for(s in l)l.hasOwnProperty(s)&&u.attributes.push(new r.default(s,l[s]));var c=localStorage.getItem(o.default.PERSISTENT_STORAGE.OLD_SDK.PUSH_TOKEN);null!=c&&"NA"!==c&&"null"!==c&&(u.subscribedToOldSdk=!0),t(u)}}catch(n){a.default.error(1,e,"Error getting the migration user. Resolving as a new user."),a.default.error(1,e,n),t(null)}else t(null)}))},h.getSync=function(){return h.instance},h.get=function(){var e=h.baseLogTag+".get";return null!=S?S:S=new Promise((function(t){l.default.getInstance().then((function(n){i.default.getWebSDKSettings().then((function(r){r.isDomainLevelStorage;var i="https";n.isChromeLike()&&(r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.HTTP||r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.MUTLI&&"http"===(0,d.getCurrentProtocol)())&&(i="http");var s=h.getLocalUser(),u=r.isDomainLevelStorage?h.getCookieUser():"resolved",l="http"===i?h.getSubdomainUser():"resolved";i=h.getMigrationUser(),Promise.all([s,u,l,i]).then((function(i){var s=i[0],u=i[1],l=i[2];(i=i[3])?i.save().then((function(n){var r=localStorage.getItem(o.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA);r&&((r=JSON.parse(r)).is_new_sdk_migrated=!0,localStorage.setItem(o.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA,JSON.stringify(r))),a.default.log(1,e,"User resolved from older SDK: ",n),t(n)})):n.isChromeLike()&&(r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.HTTP||r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.MUTLI&&"http"===(0,d.getCurrentProtocol)())&&l&&"resolved"!==l?(a.default.log(1,e,"User resolved from subdomain: ",l),l.save().then((function(e){t(e)}))):u&&"resolved"!==u?(a.default.log(1,e,"User resolved from cookie: ",u),u.save().then((function(e){t(e)}))):(a.default.log(1,e,"Local user: ",s),new h(s).save().then((function(e){t(e)})))}))}))}))}))},h.logout=function(){var e=this;return new Promise((function(t){S=null,(e.instance=null)!=p?p.logout().then((function(){t(!0)})):t(!0)}))},h.prototype.save=function(){var e=this,t=h.baseLogTag+".save";return h.isAmpEnabled()&&(this.deviceUuid=u.default.get("moe_uuid")),h.instance=this,new Promise((function(n){s.default.set(o.default.PERSISTENT_STORAGE.USER_DATA,e),u.default.setRaw(o.default.AMP.UUID,h.instance.deviceUuid),null!=p?p.setInSubDomainStorage(o.default.PERSISTENT_STORAGE.USER_DATA,e).then((function(){n(e)})).catch((function(r){a.default.error(1,t,"Error storing value in subdomain"),n(e)})):n(e)}))},h.isAmpEnabled=function(){var e=u.default.get(o.default.AMP.UUID);return e&&e.includes("amp")},h.prototype.getAttribute=function(e){var t=null;return e=h.getMorphedKey(e),this.attributes.map((function(n){n.key===e&&(t=n.value)})),t},h.prototype.indexOfAttribute=function(e){var t=-1;return e=h.getMorphedKey(e),this.attributes.map((function(n,r){n.key===e&&(t=r)})),t},h.getMorphedKey=function(e){switch(e){case"id":e=o.default.ATTRIBUTE_NAMES.ID;break;case"email":e=o.default.ATTRIBUTE_NAMES.EMAIL;break;case"name":e=o.default.ATTRIBUTE_NAMES.NAME;break;case"first_name":e=o.default.ATTRIBUTE_NAMES.FIRST_NAME;break;case"last_name":e=o.default.ATTRIBUTE_NAMES.LAST_NAME;break;case"mobile":e=o.default.ATTRIBUTE_NAMES.MOBILE;break;case"gender":e=o.default.ATTRIBUTE_NAMES.GENDER;break;case"birthday":e=o.default.ATTRIBUTE_NAMES.BDAY}return e},h.baseLogTag="UserModel",h.isResolved=!1,h.instance=null,n=h,t.default=n},1775:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5601),a=n(3546),i=n(8553),o=n(7016),s=n(7856);function u(){}u.getUuid=function(){return i.default.get(r.default.PERSISTENT_STORAGE.USER_DATA).deviceUuid},u.getPushToken=function(){return i.default.get(r.default.PERSISTENT_STORAGE.PUSH_TOKEN)},u.getPermissionState=function(e){return new Promise((function(t,n){o.default.getWebSDKSettings().then((function(r){a.default.getInstance().then((function(a){new s.default(r,a).getPermissionState().then((function(n){t(n),e&&e(null,n)})).catch((function(t){n(t),e&&e(t,null)}))}))}))}))},n=u,t.default=n},7621:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3358),o=n(5601),s=n(7016),u=n(4039),l=n(1633),c=n(4846),f=n(4340),d=n(1586);function g(){}g.track=function(e,t,n){var g=this,p="MoEngage.event.trackEvent";return new Promise((function(S,h){return r(g,void 0,void 0,(function(){var g,h,E,T,m,_=this;return a(this,(function(v){switch(v.label){case 0:return n=!!n,"string"==typeof e&&e?[3,1]:(i.default.log(1,p,"Event name not a string or null or empty string:",e),S({error:5001,message:"Event name can not be null"}),[3,7]);case 1:if(v.trys.push([1,6,,7]),g=[],null!=t&&(null===t||t!==Object(t)||"[object Object]"!==Object.prototype.toString.call(t)))return[3,4];for(h in t=null==t?{}:t)t.hasOwnProperty(h)&&g.push(new u.default(h,t[h]));return[4,(E=new d.default).initiateSessionAndSource()];case 2:return v.sent(),[4,l.default.createEvent(e,g)];case 3:return T=v.sent(),f.default.addEvent(T),s.default.collectGetParams().then((function(t){e===o.default.EVENT_NAMES.UNSUBSCRIBED&&delete t.push_id;var i=new c.default(c.default.REPORT_ADD_TYPE.EVENT,t,T);s.default.getWebSDKSettings().then((function(e){return r(_,void 0,void 0,(function(){var t,r,u;return a(this,(function(a){return t={session_id:E.getSessionKey(),start_time:E.getSessionStartTime(),background_initiated:0},r=[],(u=E.getActiveSource())&&(E.setCurrentSource(u),r.push(u)),i.postData.meta.session=t,r.length&&(i.postData.meta.source=r),E.isNonEventInteractive(T)&&(i.postData.nie=1),s.default.reportAdd(i,n).then((function(){e.s_s_s!==o.SESSION_SOURCE_STATUS.ALLOWED||E.isNonEventInteractive(T)||E.extendSession(),S(!0)})),[2]}))}))}))})),[3,5];case 4:i.default.error(1,p,"Event attributes were not passed a key-value pair object for event: ",e),S({error:5002,message:"Event value needs to be a key-value pair object"}),v.label=5;case 5:return[3,7];case 6:return m=v.sent(),i.default.error(1,p,"Error occurred in tracking events ",m),[3,7];case 7:return[2]}}))}))}))},n=g,t.default=n},1879:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.disableOnsiteApi=t.enableOnsiteApi=t.DummyMoengageObject=void 0;var i=n(5601),o=n(3358),s=n(8553),u=n(7016),l=n(3546),c=n(2983),f=n(1775),d=n(6928),g=n(7621),p=n(7016),S=n(7856),h=n(2651),E=n(464),T=n(6801),m=n(8611),_=n(4126),v=(n=n(855),"MoEngage"),y=new m.PromiseObject,A={getData:function(e,t){p.default.getWebSDKSettings().then((function(n){y.p.then((function(n){n.getData(e,t)}))}))},registerCallback:function(e,t){p.default.getWebSDKSettings().then((function(n){y.p.then((function(n){n.registerCallback(e,t)}))}))}},I=(b.callWebPush=function(e){var t=v+".callWebPush";u.default.getWebSDKSettings().then((function(n){var r,a,s,u,f,d,g;n.isConfigured?c.default.isFeatureEnabled(n,i.default.SDK_FEATURES.WEB_PUSH)?n.optInConfig.type===c.OptInConfig.TYPE.SELF_HANDLED?(o.default.log(1,t,"Starting web push functions"),null!=e&&(T.default.setSoftAskConfig(e),r=(0,m.getProp)(e,"soft_ask_display_callback",null),a=(0,m.getProp)(e,"soft_ask_allow_callback",null),s=(0,m.getProp)(e,"soft_ask_block_callback",null),u=(0,m.getProp)(e,"hard_ask_allow_callback",null),f=(0,m.getProp)(e,"hard_ask_dismiss_callback",null),d=(0,m.getProp)(e,"hard_ask_block_callback",null),g=i.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES,h.default.addCallback(g.SOFT_ASK_SHOWN,r),h.default.addCallback(g.SOFT_ASK_ALLOWED,a),h.default.addCallback(g.SOFT_ASK_DISMISSED,s),h.default.addCallback(g.HARD_ASK_ALLOWED,u),h.default.addCallback(g.HARD_ASK_DISMISSED,f),h.default.addCallback(g.HARD_ASK_DENIED,d)),l.default.getInstance().then((function(e){new S.default(n,e).callWebPush()}))):o.default.warn(1,t,"This feature can only be used when you have chosed self-handled approach in the dashboard. You can check dashboard here:",i.default.PUSH_SETTINGS_PAGE_LINK):o.default.warn(1,t,"Web push feature not enabled for current environment."):o.default.log(1,t,"Web push settings not configured on dashboard yet. To start web push subscriptions, please configure the settings on dashboard.")}))},b.showNotification=function(e){p.default.getWebSDKSettings().then((function(t){l.default.getInstance().then((function(n){new S.default(t,n).showNotification(e)}))}))},b.getSdkVersion=function(){return"2.8.27"},b.setDebugLevel=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(t){try{"number"==typeof e&&(!T.default.get().disableOnsite&&b.onsite.setLogLevel&&b.onsite.setLogLevel(e),o.default.setLogLevel(e,!0))}catch(t){o.default.error(0,"MoEngage.setDebugLevel","Error changing log level:",t)}return[2]}))}))},b.vitals=function(){var e=E.default.getSync();return{deviceUuid:e.deviceUuid,userDetails:e,pushToken:s.default.get(i.default.PERSISTENT_STORAGE.PUSH_TOKEN),softAskStatus:s.default.get(i.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS),hardAskStatus:s.default.get(i.default.PERSISTENT_STORAGE.HARD_ASK_STATUS)}},b.help=function(){var e,t=v+".help";for(e in o.default.log(0,t,"Moengage Dashboard - ",i.default.LINKS.MOE_DASHBOARD),i.default.LINKS)i.default.LINKS.hasOwnProperty(e)&&o.default.log(0,t,e,"-",i.default.LINKS[e])},b.track_event=function(e,t){return g.default.track(e,t)},b.add_unique_user_id=function(e){return d.default.login(e)},b.update_unique_user_id=function(e){return d.default.updateUniqueId(e)},b.add_user_attribute=function(e,t){return d.default.addAttribute(e,t)},b.add_first_name=function(e){return d.default.addAttribute("first_name",e)},b.add_last_name=function(e){return d.default.addAttribute("last_name",e)},b.add_email=function(e){return d.default.addAttribute("email",e)},b.add_mobile=function(e){return d.default.addAttribute("mobile",e)},b.add_user_name=function(e){return d.default.addAttribute("name",e)},b.add_gender=function(e){return d.default.addAttribute("gender",e)},b.add_birthday=function(e){return d.default.addAttribute("birthday",e)},b.destroy_session=function(){return b.user.logout()},b.call_web_push=function(e){b.callWebPush(e)},b.getBranch=function(){return i.default.BRANCH},b.track_page_view=function(){return g.default.track(i.default.EVENT_NAMES.WEB_SESSION_START,{timestamp:Number(Date.now())}),g.default.track(i.default.EVENT_NAMES.PAGE_VIEWED,{timestamp:Number(Date.now())})},b.user=d.default,b.event=g.default,b.device=f.default,b.onsite=A,b.reports=n.default.reports,b);function b(){}function O(){}t.default=I,t.DummyMoengageObject={track_event:O,add_user_attribute:O,add_first_name:O,add_last_name:O,add_email:O,add_mobile:O,add_user_name:O,add_gender:O,add_birthday:O,destroy_session:O,add_unique_user_id:O,moe_events:O,location_type_attribute:O,call_web_push:O},t.enableOnsiteApi=function(){var e=T.default.get();I.onsite=new _.MoeOnsite(e),y.res(I.onsite),I.onsite.initialize()},t.disableOnsiteApi=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return I.onsite.appId?(o.default.log(1,"Moengage.disableOnsiteApi","logging out from inapp module"),[4,I.onsite.logout()]):[3,2];case 1:e.sent(),y=new m.PromiseObject,I.onsite=A,e.label=2;case 2:return[2]}}))}))}},1586:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(5877),i=n(8553),o=n(5601),s=n(8611),u=n(7016),l=n(8611),c=n(4622);function f(){}f.prototype.initiateSessionAndSource=function(){var e=this;return new Promise((function(t,n){setTimeout((function(){e.isSessionRunning()&&e.isCurrentSourceSameAsPreviousSource()||e.startNewSession(),t(!0)}),250)}))},f.prototype.isSessionRunning=function(){return this.getSessionKey()&&!this.isSessionExpired()},f.prototype.isSessionExpired=function(){var e=this.getSessionExpiryTime(),t=c.default.get("wasBrowserInactive");return!(!t&&null!==t)&&(this.isWindowActive()&&c.default.set("wasBrowserInactive",!1),(new Date).getTime()>e)},f.prototype.isNonEventInteractive=function(e){return f.NON_INTERACTIVE_EVENTS.includes(e.name)||0<e.attributes.filter((function(e){return"moe_non_interactive"===e.key&&1===e.value})).length},f.prototype.getCurrentSource=function(){var e=(0,s.deserializeQueryParams)(window.location.search),t="",n={};if(Object.keys(e).includes("utm_source")){t="utm_",this.geCustomIdentifiersToTrack().forEach((function(t){e[t]&&(n[t]=e[t])}));var r={source_url:window.location.href};return e[t+"source"]&&(r.source=e[t+"source"]),e[t+"medium"]&&(r.medium=e[t+"medium"]),e[t+"term"]&&(r.term=e[t+"term"]),e[t+"campaign"]&&(r.campaign_name=e[t+"campaign"]),e[t+"content"]&&(r.content=e[t+"content"]),e.utm_id&&(r.campaign_id=e.utm_id),Object.keys(n).length&&(r.extra=n),r}},f.prototype.getActiveSource=function(){return this.getSavedSource()||this.getCurrentSource()},f.prototype.isSourceOrganic=function(){var e=(0,s.deserializeQueryParams)(window.location.search),t=Object.keys(e),n=!1;return this.geCustomIdentifiersToTrack().forEach((function(t){e[t]&&(n=!0)})),!t.includes("utm_source")&&!t.includes("source")&&!n},f.prototype.setCurrentSource=function(e){var t=this.getSession();t.currentSource=e,i.default.set(o.default.SESSION_SOURCE.SESSION,t)},f.prototype.removeCurrentSource=function(){var e=this.getSession();e&&(e.currentSource=void 0,i.default.set(o.default.SESSION_SOURCE.SESSION,e))},f.prototype.getSavedSource=function(){var e=(0,l.getProp)(this.getSession(),o.default.SESSION_SOURCE.CURRENT_SOURCE,void 0);if(e)return e},f.prototype.isCurrentSourceSameAsPreviousSource=function(){if(this.isSourceOrganic())return!0;var e=r({},this.getCurrentSource());delete e.source_url;var t=r({},this.getSavedSource());return delete t.source_url,(0,s.deepCompareObjects)(e,t)},f.prototype.getSessionKey=function(){return(0,l.getProp)(this.getSession(),o.default.SESSION_SOURCE.SESSION_KEY,null)},f.prototype.getSessionStartTime=function(){return(0,l.getProp)(this.getSession(),o.default.SESSION_SOURCE.SESSION_START_TIME,null)},f.prototype.getSessionExpiryTime=function(){return(0,l.getProp)(this.getSession(),o.default.SESSION_SOURCE.SESSION_EXPIRY_TIME,null)},f.prototype.getSessionMaxTime=function(){return(0,l.getProp)(this.getSession(),o.default.SESSION_SOURCE.SESSION_MAX_TIME,null)},f.prototype.getSession=function(){return i.default.get(o.default.SESSION_SOURCE.SESSION)},f.prototype.geCustomIdentifiersToTrack=function(){return(0,l.getProp)(this.getSession(),o.default.SESSION_SOURCE.CUSTOM_IDENTIFIERS_TO_TRACK,[])||[]},f.prototype.generateSessionKey=function(){return(0,a.v4)()},f.prototype.startNewSession=function(){var e=this;this.removeCurrentSource(),u.default.getWebSDKSettings().then((function(t){var n=e.getNumberOfSessions();n={sessionKey:e.generateSessionKey(),sessionStartTime:(new Date).toISOString(),sessionMaxTime:t.s_i_d,sessionEnabled:t.s_s_s,customIdentifiersToTrack:t.src_ext,sessionExpiryTime:(new Date).getTime()+1e3*t.s_i_d,numberOfSessions:++n},i.default.set(o.default.SESSION_SOURCE.SESSION,n)}))},f.prototype.extendSession=function(){var e=this.getSession();e&&(e.sessionExpiryTime=(new Date).getTime()+1e3*e.sessionMaxTime,i.default.set(o.default.SESSION_SOURCE.SESSION,e))},f.prototype.handleBrowserInactivity=function(e){"hidden"===e&&c.default.set("wasBrowserInactive",!0)},f.prototype.isWindowActive=function(){return!!c.default.get("isWindowActive")},f.prototype.getNumberOfSessions=function(){return(0,l.getProp)(i.default.get(o.default.SESSION_SOURCE.SESSION),o.default.SESSION_SOURCE.NUMBER_OF_SESSIONS)||0},f.NON_INTERACTIVE_EVENTS=[o.default.EVENT_NAMES.WEB_OPTIN_BANNER_LOAD,o.default.EVENT_NAMES.OPT_IN_SHOWN,o.default.EVENT_NAMES.WEB_OPTIN_BANNER_LOAD,o.default.EVENT_NAMES.LOGOUT],n=f,t.default=n},6928:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,(o=a?[2&o[0],a.value]:o)[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(5601),o=n(3358),s=n(8553),u=n(8519),l=n(7016),c=n(4039),f=n(1633),d=n(4846),g=n(464),p=n(4418),S=n(7621),h=n(4292),E=n(4340),T=n(1879),m=n(855),_=n(8611),v="MoEngage.user";function y(){}y.addAttribute=function(e,t){var n=v+".addUserAttribute";return new Promise((function(r,a){var i,s;"string"!=typeof e||null==e?(o.default.error(1,n,"Attribute name needs to be a string"),r({error:5e3,message:"Attribute name needs to be a string. Type provided was "+typeof e})):""===e?(o.default.error(1,n,"Attribute name can not be an empty string"),r({error:5001,message:"Attribute name can not be an empty string"})):null==t?(o.default.error(1,n,"Attribute value null"),r({error:5003,message:"Attribute value was empty"})):"string"==typeof t&&""===t?r({error:5004,message:"Attribute value needs to be non-empty string, non-empty array or date object"}):"object"!=typeof t||Array.isArray(t)||"function"==typeof t.getMonth?"object"==typeof t&&Array.isArray(t)&&0===t.length?(o.default.error(1,n,"Value cannot be empty, non-string, non-array or non-date object"),r({error:5006,message:"Attribute value needs to be non-empty string, non-empty array or date object"})):"object"==typeof t&&Array.isArray(t)&&void 0!==t.find((function(e){return"object"==typeof e&&"function"!=typeof e.getMonth}))?(o.default.error(1,n,"Elements of the attribute value-array cannot be non-Date objects"),r({error:5007,message:"Attribute value-array cannot have non-Date objects as its elements"})):(i=new c.default(e,t),s=function(){g.default.get().then((function(e){e.addAttribute(i).then((function(e){e?("id"===i.key&&o.default.log(1,n,"Logging in the user with id: ",i.value),f.default.createUserAttributeEvent(i).then((function(e){o.default.log(2,n,"Event to be converted to report:",e),E.default.addEvent(e),l.default.collectGetParams().then((function(t){t=new d.default(d.default.REPORT_ADD_TYPE.USER_ATTRIBUTE,t,e),l.default.reportAdd(t).then((function(){r(!0)}))}))}))):(o.default.log(1,n,"Attribute already present/queued. Not adding again."),r({error:5005,message:"Attribute already present/queued. Not adding again."}))}))}))},"id"===e?g.default.get().then((function(e){var a=e.indexOfAttribute("id");-1<a?t===e.attributes[a].value?(o.default.log(1,n,"User already logged in with id:",t),r(!0)):(o.default.log(1,n,"Logging out previous user with id:",e.attributes[a].value),y.logout(!0,t).then((function(){s()}))):s()})):s()):(o.default.error(1,n,"Value cannot be empty, non-string, non-array or non-date object"),r({error:5005,message:"Attribute value needs to be non-empty string, non-empty array or date object"}))}))},y.login=function(e){return y.addAttribute("id",e)},y.logout=function(e,t){var n=this,c=e?{type:"forced",new_uid:t}:null;return t=h.default.get(),null!=g.default.getSync()&&(t.deviceToLogout=g.default.getSync().deviceUuid,t.save()),new Promise((function(e){S.default.track(i.default.EVENT_NAMES.LOGOUT,c).then((function(){return r(n,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return o.default.log(1,"MoEngage.user.logout","Logging out now!"),[4,m.default.flushReports()];case 1:return n.sent(),l.default.getWebSDKSettings().then((function(n){return r(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return n.isDomainLevelStorage&&p.default.remove(i.default.PERSISTENT_STORAGE.USER_DATA),E.default.clear(),[4,(0,T.disableOnsiteApi)(n)];case 1:return t.sent(),s.default.logout(),[4,g.default.logout()];case 2:return t.sent(),s.default.remove(i.default.PERSISTENT_STORAGE.GRACEFUL_DATA),l.default.onDeviceAdd=new _.PromiseObject,[4,(0,u.initializeLaunchSequence)()];case 3:return t.sent(),e(!0),[2]}}))}))})),[2]}}))}))}))}))},y.updateUniqueId=function(e){var t=v+".updateUniqueId";return new Promise((function(n){g.default.get().then((function(r){var a=r.indexOfAttribute(i.default.ATTRIBUTE_NAMES.ID),s=r.indexOfAttribute("oldUniqueIds");if(!(-1<a))return o.default.log(2,t,"Logging in as no id found"),y.login(e);var u=r.attributes[a].value;e!==u?(o.default.log(2,t,"Different ids found"),-1<s?(r.attributes[s].value.push(u),r.attributes.splice(a,1)):(r.attributes.splice(a,1),r.addAttribute(new c.default("oldUniqueIds",[u]))),r.save().then((function(){y.login(e).then((function(){n(!0)}))}))):(o.default.warn(1,t,"New id and old id are the same. Not updating the id."),n(!0))}))}))},y.getAttributes=function(){var e=g.default.getSync().attributes,t={};return e.map((function(e){t[e.key]=e.value})),t},n=y,t.default=n},5511:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8611);function a(){}a.getListeners=function(){return this.listeners},a.getTopicListeners=function(e){return(0,r.getProp)(a.topicListeners,e,[])},a.addListener=function(e){a.listeners.push(e)},a.addTopicListener=function(e,t){a.topicListeners[e]=a.getTopicListeners(e),a.topicListeners[e].push(t)},a.broadcast=function(e){a.listeners.map((function(t){t(e)})),(0,r.getProp)(a.topicListeners,e.topic,[]).map((function(t){t(e)}))},a.broadcastToWindow=function(e){window&&window.dispatchEvent(new CustomEvent(e.topic,{detail:{name:e.name,data:e.data||null}}))},a.deprecatedSdkCallback=function(e){window.dispatchEvent(new CustomEvent("MOE_OPT_IN",{detail:e}))},a.resetAllListeners=function(){a.listeners=[],a.topicListeners={}},a.listeners=[],a.topicListeners={},n=a,t.default=n},4418:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3358),a=n(5601),i=n(8611);function o(){}o.set=function(e,t){var n=o.baseTag+".set";null==t?o.remove(e):(t="boolean"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"boolean"}):"string"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"string"}):JSON.stringify(t),r.default.log(3,n,"Setting ",e,":",t),n=Date.now(),n=";expires="+new Date(n+31536e6*a.default.COOKIE_STORAGE.SESSION_COOKIE.EXPIRY_YEARS).toUTCString(),document.cookie=e+"="+encodeURIComponent(t)+n+";domain="+o.getOrigin()+";path=/;SameSite=None; Secure")},o.get=function(e){for(var t=o.baseTag+".get",n=e+"=",a=decodeURIComponent(document.cookie).split(";"),s=a.length-1;0<=s;s--){for(var u=a[s];" "===u.charAt(0);)u=u.substring(1);if(0===u.indexOf(n)){var l=u.substring(n.length,u.length);try{l=JSON.parse(l),"string"===(0,i.getProp)(l,"MOE_DATA_TYPE",null)?l=(l=(0,i.getProp)(l,"actualValue",null))?String(l):null:"boolean"===(0,i.getProp)(l,"MOE_DATA_TYPE",null)&&(l=(0,i.getProp)(l,"actualValue",null))}catch(e){}return r.default.log(3,t,"Got ",e,":",l),l}}return null},o.remove=function(e){var t=o.baseTag+".remove";document.cookie=e+"=;domain="+o.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;",r.default.log(3,t,"Removed ",e)},o.setRaw=function(e,t,n){var a=o.baseTag+".setRaw";null==t?o.remove(e):(r.default.log(3,a,"Setting ",e,":",t),a="",null!=n&&(a=";expires="+n.toISOString()),document.cookie=e+"="+encodeURIComponent(t)+a+";domain="+o.getOrigin()+";path=/;")},o.getOrigin=function(){var e=o.baseTag+".getOrigin",t=(t=window.location.origin).indexOf(".")!==t.lastIndexOf(".")?t.substring(t.indexOf(".")):"."+t.substring(t.lastIndexOf("/")+1);return"localhost"===window.location.hostname&&(r.default.warn(1,e,"Cross domain user persitence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),t=""),t},o.baseTag="CookieStorage",n=o,t.default=n},4622:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8611);function a(){}a.set=function(e,t){window&&(window.moeInternals?window.moeInternals.ephemeral||(window.moeInternals.ephemeral={}):(window.moeInternals={},window.moeInternals.ephemeral={}),window.moeInternals.ephemeral[e]=t)},a.get=function(e){return(0,r.getProp)(window,"moeInternals.ephemeral."+e,null)},a.baseLogTag="EphemeralStorage",n=a,t.default=n},8553:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},i=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3358),s=n(8611),u=n(5601),l=n(3571),c=n(4418),f="MOE_DATA";function d(){}d.setPrefix=function(e){d.prefix=e+"_"},d.set=function(e,t){e=d.prefix+e,localStorage&&((n=d.getMoeData())[e]=t,localStorage.setItem(f,JSON.stringify(n)));var n,a=d.KEYS_SHARED_WITH_COOKIE.indexOf(e);d.isSharedWithCookie&&0<=a&&(n="object"!=typeof t||Array.isArray(t)?t:r({},t),0===a&&Array.isArray(n.attributes)&&(n.attributes=n.attributes.filter((function(e){switch(e.key){case u.default.ATTRIBUTE_NAMES.ID:case u.default.ATTRIBUTE_NAMES.ID_MODIFIED:case u.default.ATTRIBUTE_NAMES.EMAIL:case u.default.ATTRIBUTE_NAMES.MOBILE:return!0;default:return!1}}))),e===u.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS&&(n.domain=t.domain,n.token=t.token,n.endpoint=t.endpoint,n.keys=t.keys),c.default.set(e,n))},d.get=function(e){if(e=d.prefix+e,localStorage){var t=d.getMoeData();return(0,s.getProp)(t,e,null)}return null},d.remove=function(e){var t,n=d.baseLogTag+".remove",r=d.prefix+e;localStorage&&null!=d.get(e)&&(delete(t=d.getMoeData())[r],localStorage.setItem(f,JSON.stringify(t)),o.default.log(2,n,"Key",e,"removed.")),d.isSharedWithCookie&&0<=d.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&c.default.remove(e)},d.logout=function(){var e,t,n=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA"];for(e in u.default.PERSISTENT_STORAGE)n.indexOf(e)<0&&d.remove(u.default.PERSISTENT_STORAGE[e]);for(t in u.default.PERSISTENT_STORAGE.Q)l.default.purge(t)},d.getString=function(e){if(e=d.prefix+e,localStorage)return"string"==typeof(e=d.get(e))||e instanceof String?e:JSON.stringify(e)},d.removePrefix=function(){d.prefix=""},d.copyKeysFromCookie=function(){for(var e=0;e<d.KEYS_SHARED_WITH_COOKIE.length;e++)!function(e){var t,n=d.KEYS_SHARED_WITH_COOKIE[e],o=c.default.get(n);null!=o&&(e="object"!=typeof o||Array.isArray(o)?o:r({},o),n===u.default.PERSISTENT_STORAGE.USER_DATA&&(o=d.get(n)&&d.get(n).attributes,Array.isArray(e.attributes)&&Array.isArray(o)&&0<o.length&&(t=i([],a(o),!1),e.attributes.forEach((function(e){var n=t.findIndex((function(t){return t.key===e.key}));0<=n&&(t[n]=e)})),e.attributes=t)),d.set(n,e))}(e)},d.getMoeData=function(){var e=d.baseLogTag+".getMoeData",t=localStorage.getItem(f);if(null==t)return{};try{return JSON.parse(t)}catch(t){return o.default.error(1,e,t),{}}},d.baseLogTag="PersistentStorage",d.prefix="",d.isSharedWithCookie=!1,d.KEYS_SHARED_WITH_COOKIE=[u.default.PERSISTENT_STORAGE.USER_DATA,u.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,u.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,u.default.PERSISTENT_STORAGE.SETUP_TIME,u.default.PERSISTENT_STORAGE.PUSH_TOKEN,u.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,u.default.PERSISTENT_STORAGE.HARD_ASK_STATUS],n=d,t.default=n},5877:(e,t,n)=>{var r=n(3570),a=n(1171);(n=a).v1=r,n.v4=a,e.exports=n},5327:e=>{for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,n){var r=n||0;return[(n=t)[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[+r]]].join("")}},5217:e=>{var t,n,r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);r?(t=new Uint8Array(16),e.exports=function(){return r(t),t}):(n=new Array(16),e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n})},3570:(e,t,n)=>{var r,a,i=n(5217),o=n(5327),s=0,u=0;e.exports=function(e,t,n){var l=t&&n||0,c=t||[],f=(e=e||{}).node||r,d=void 0!==e.clockseq?e.clockseq:a;null!=f&&null!=d||(p=i(),null==f&&(f=r=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==d&&(d=a=16383&(p[6]<<8|p[7])));var g=void 0!==e.msecs?e.msecs:(new Date).getTime(),p=(n=void 0!==e.nsecs?e.nsecs:u+1,g-s+(n-u)/1e4);if(p<0&&void 0===e.clockseq&&(d=d+1&16383),1e4<=(n=(p<0||s<g)&&void 0===e.nsecs?0:n))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=g,a=d,n=(1e4*(268435455&(g+=122192928e5))+(u=n))%4294967296,c[l++]=n>>>24&255,c[l++]=n>>>16&255,c[l++]=n>>>8&255,c[l++]=255&n,g=g/4294967296*1e4&268435455,c[l++]=g>>>8&255,c[l++]=255&g,c[l++]=g>>>24&15|16,c[l++]=g>>>16&255,c[l++]=d>>>8|128,c[l++]=255&d;for(var S=0;S<6;++S)c[l+S]=f[S];return t||o(c)}},1171:(e,t,n)=>{var r=n(5217),a=n(5327);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[i+s]=o[s];return t||a(o)}}},t={};function n(r){var a=t[r];return void 0!==a||(a=t[r]={exports:{}},e[r].call(a.exports,a,a.exports,n)),a.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n(8519)})();